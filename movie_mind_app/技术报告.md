# MovieMind é¡¹ç›®æŠ€æœ¯æŠ¥å‘Š

**é¡¹ç›®åç§°**ï¼šMovieMind - æ™ºèƒ½ç”µå½±æ¢ç´¢ä¸ç®¡ç†å¹³å°  
**å¼€å‘æ¡†æ¶**ï¼šFlutter 3.x (Dart)  
**æŠ¥å‘Šæ—¥æœŸ**ï¼š2026-01-05  
**å½“å‰ç‰ˆæœ¬**ï¼š1.0.0+1  
**ç»´æŠ¤å›¢é˜Ÿ**ï¼šå®‹è‰¾è½©ã€å¼ ä½³å½¤  
**æŠ¥å‘Šæäº¤æ—¶é—´**ï¼š2026.1.5

---

## 1. é¡¹ç›®æ¦‚è¿° (Overview)

### 1.1 é¡¹ç›®èƒŒæ™¯ä¸å®šä½

**MovieMind** æ˜¯ä¸€æ¬¾é¢å‘ç”µå½±çˆ±å¥½è€…çš„è·¨å¹³å°ç§»åŠ¨åº”ç”¨ï¼Œå®šä½äºæ‰“é€ ä¸€ä¸ªé›†æˆåŒ–çš„ç”µå½±ä¿¡æ¯æ£€ç´¢ä¸ä¸ªäººè§‚å½±ç®¡ç†ç”Ÿæ€ç³»ç»Ÿã€‚åœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œç”¨æˆ·é¢ä¸´ç€æµ·é‡ç”µå½±èµ„æºå´éš¾ä»¥é«˜æ•ˆæ£€ç´¢ã€ç®¡ç†è§‚å½±è®°å½•åˆ†æ•£ï¼Œæ•´åˆæ€§ä¸å¼ºã€å¯¹äºæƒ³çœ‹çš„ç”µå½±éœ€è¦åˆ‡æ¢å¤šå¹³å°äº†è§£ç­‰ç—›ç‚¹ã€‚MovieMind é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›è§£å†³è¿™äº›é—®é¢˜ï¼š

- ğŸ¬ **å››ç»´åº¦æ™ºèƒ½æœç´¢**ï¼šç”µå½±ã€å½±äººã€å¥–é¡¹ã€å°è¯å…¨æ–¹ä½æ£€ç´¢å’Œæ¨¡å—åŒ–é€‰é¡¹ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„æŸ¥è¯¢éœ€æ±‚å¹¶å¸®åŠ©ç”¨æˆ·æ‹“å±•å…´è¶£
- ğŸ“Š **å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šä»æƒ³çœ‹ã€åœ¨çœ‹åˆ°çœ‹è¿‡ï¼Œå®Œæ•´è®°å½•ç”¨æˆ·è§‚å½±å†ç¨‹ï¼Œå¹¶ç”Ÿæˆç›¸å…³çš„UIè®¾è®¡åœ¨ç”¨æˆ·ä¸»é¡µï¼Œå¯ä»¥æŸ¥çœ‹å¯¼å‡º
- ğŸ¯ **åŸºäºåå¥½çš„æ¨è**ï¼šæ ¹æ®ç”¨æˆ·è§‚å½±ä¹ æƒ¯å’Œç±»å‹åå¥½æä¾›ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ç”¨æˆ·æ‹“å±•å…´è¶£
- ğŸ† **æƒå¨å¥–é¡¹æ•°æ®åº“**ï¼šé›†æˆå…­å¤§ç”µå½±èŠ‚è·å¥–æ•°æ®ï¼Œå¸®åŠ©ç”¨æˆ·å‘ç°é«˜è´¨é‡ä½œå“
- ğŸ’¬ **å°è¯æ£€ç´¢å¼•æ“**ï¼šç‹¬åˆ›çš„å‰§æœ¬çº§å°è¯æœç´¢ï¼Œè®©ç”¨æˆ·é€šè¿‡åªè¨€ç‰‡è¯­æ‰¾åˆ°å¿ƒä»ªç”µå½±

### 1.2 æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

#### 1.2.1 å››ç±»ä¸»è¦åŠŸèƒ½çš„æœç´¢ç³»ç»Ÿ
- **ç”µå½±æœç´¢**ï¼šæ”¯æŒæŒ‰ç›¸å…³åº¦ã€è¯„åˆ†ã€ä¸Šæ˜ æ—¶é—´æ’åºï¼Œå¿«é€Ÿå®æ—¶å±•ç¤º TMDb æ•°æ®åº“æ•°ç™¾ä¸‡éƒ¨ç”µå½±
- **å½±äººæœç´¢**ï¼šæ¼”å‘˜ã€å¯¼æ¼”ä¿¡æ¯æŸ¥è¯¢ï¼Œå…³è”ä½œå“å±•ç¤º
- **å¥–é¡¹æœç´¢**ï¼šæ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼ˆå¦‚"ç¬¬95å±Šå¥¥æ–¯å¡"ã€"2024æŸæ—ç”µå½±èŠ‚"ï¼‰ï¼ŒåŒæ—¶æä¾›æ¨¡å—åŒ–çš„ç”µå½±å¥–é¡¹é€‰æ‹©ï¼Œåˆ—ä¸¾äºŒåå¹´å›½å†…å¤–çŸ¥åç”µå½±å¥–é¡¹çš„è·å¥–åŠæåä½œå“
- **å°è¯æœç´¢**ï¼šåŒå¼•æ“æ¶æ„ï¼Œç²¾é€‰å­—å¹• + å®Œæ•´å‰§æœ¬ï¼Œæ”¯æŒä¸­è‹±æ–‡æ£€ç´¢

#### 1.2.2 è§‚å½±ç®¡ç†
- **ä¸‰æ€çŠ¶æ€ç®¡ç†**ï¼šæƒ³çœ‹(Wishlist)ã€åœ¨çœ‹(Watching)ã€çœ‹è¿‡(Watched)
- **è§‚çœ‹è¿›åº¦è¿½è¸ª**ï¼šåœ¨çœ‹çŠ¶æ€ä¸‹æ”¯æŒæ»‘åŠ¨æ¡è®°å½•ç™¾åˆ†æ¯”è¿›åº¦
- **æ”¶è—ç³»ç»Ÿ**ï¼šä¸€é”®æ”¶è—å–œçˆ±ç”µå½±ï¼Œæœ¬åœ°æŒä¹…åŒ–å­˜å‚¨
- **è‡ªå®šä¹‰ç‰‡å•**ï¼šç”¨æˆ·å¯åˆ›å»ºå¤šä¸ªä¸»é¢˜ç‰‡å•ï¼Œå¦‚"å¥¥æ–¯å¡æœ€ä½³"ã€"å‘¨æœ«å¿…çœ‹"ç­‰
- **å½±è¯„ç¬”è®°**ï¼šä¸ºæ¯éƒ¨ç”µå½±æ’°å†™ä¸ªäººè§‚åæ„Ÿï¼Œæ”¯æŒé•¿æ–‡æœ¬å­˜å‚¨

#### 1.2.3 ä¸ªæ€§åŒ–ä½“éªŒ
- **è§‚å½±çƒ­åº¦å›¾**ï¼šGitHub é£æ ¼çš„å¹´åº¦è§‚å½±æ—¥å†ï¼Œå¯è§†åŒ–å±•ç¤ºè§‚å½±é¢‘ç‡
- **ç±»å‹åå¥½åˆ†æ**ï¼šåŸºäºç”¨æˆ·è§‚å½±å†å²æ¨èåŒç±»å‹é«˜åˆ†ç”µå½±
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šæ³¨å†Œ/ç™»å½•ï¼Œæ•°æ®äº‘ç«¯åŒæ­¥ï¼ˆå½“å‰ç‰ˆæœ¬ä¸ºæœ¬åœ°å­˜å‚¨ï¼‰
- **ä¸»é¢˜å®šåˆ¶**ï¼šå¤šç§ç”µå½±ç±»å‹é…å¤‡ç‹¬ç‰¹å­—ä½“å’ŒèƒŒæ™¯å›¾

### 1.3 æŠ€æœ¯åˆ›æ–°ç‚¹

1. **é«˜æ€§èƒ½å¤§æ–‡ä»¶æ£€ç´¢**
   - é‡‡ç”¨ Flutter Isolate æŠ€æœ¯ï¼Œå°†å¤§é‡å®Œæ•´å‰§æœ¬æ•°æ®çš„æœç´¢ä»»åŠ¡æ”¾å…¥åå°çº¿ç¨‹
   - åŒå¼•æ“æœç´¢ç­–ç•¥ï¼šä¼˜å…ˆå¿«é€Ÿæ£€ç´¢ç²¾é€‰æ•°æ®ï¼Œå†æ·±åº¦æœç´¢å®Œæ•´æ•°æ®
   - å®ç°ä¸»çº¿ç¨‹ 60fps æµç•…è¿è¡Œï¼Œæ£€ç´¢å»¶è¿Ÿ < 2s

2. **æ²‰æµ¸å¼ UI è®¾è®¡**
   - åŠ¨æ€ AppBar é€æ˜åº¦ï¼šæ ¹æ®æ»šåŠ¨ä½ç½®å®æ—¶è®¡ç®—é€æ˜åº¦ `(offset/200).clamp(0.0, 1.0)`
   - æ¯›ç»ç’ƒæ•ˆæœ(Backdrop Filter)ï¼šåº•éƒ¨å¯¼èˆªæ å’Œè¯¦æƒ…é¡µé‡‡ç”¨æ¨¡ç³Šæ•ˆæœ
   - Hero åŠ¨ç”»ï¼šé¡µé¢åˆ‡æ¢æ—¶æµ·æŠ¥å¹³æ»‘è¿‡æ¸¡
   - å…³é”®è¯é«˜äº®ç®—æ³•ï¼šå°è¯æœç´¢ç»“æœè‡ªåŠ¨æ ‡çº¢åŒ¹é…å…³é”®è¯

3. **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**
   - å›¾ç‰‡ä¸‰çº§ç¼“å­˜ï¼šå†…å­˜(Memory Cache) â†’ ç£ç›˜(Disk Cache) â†’ ç½‘ç»œ(Network)
   - ç”µå½±ä¿¡æ¯ç¼“å­˜æ± ï¼šæœ¬åœ°ç»´æŠ¤å·²è®¿é—®ç”µå½±çš„å®Œæ•´ä¿¡æ¯ï¼Œå‡å°‘é‡å¤è¯·æ±‚
   - é¢„åŠ è½½æœºåˆ¶ï¼šé¦–é¡µæ¨èæ•°æ®å¹¶è¡ŒåŠ è½½ï¼Œä½¿ç”¨ `Future.wait()` ä¼˜åŒ–

4. **è·¨å¹³å°ä¸€è‡´æ€§**
   - ç»Ÿä¸€ Material Design 3 è®¾è®¡è¯­è¨€
   - San Francisco ç³»ç»Ÿå­—ä½“é€‚é…
   - å“åº”å¼å¸ƒå±€ï¼šæ”¯æŒä¸åŒå±å¹•å°ºå¯¸è‡ªé€‚åº”è¿‘

---

## 2. æŠ€æœ¯æ ˆæ¶æ„ (Tech Stack)

### 2.1 æ ¸å¿ƒæ¡†æ¶
- **Flutter & Dart**: é‡‡ç”¨ Google çš„ Flutter æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œå®ç°ä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼ˆiOS, Android, Web, Desktopï¼‰ã€‚
- **æ¶æ„æ¨¡å¼**: é‡‡ç”¨åˆ†å±‚æ¶æ„ (Layered Architecture)ï¼Œä¸»è¦åˆ†ç¦»ä¸ºï¼š
  - **UI Layer (Presentation)**: é¡µé¢ (`pages/`) ä¸é€šç”¨ç»„ä»¶ (`widgets/`)ã€‚
  - **Service Layer (Business Logic)**: ä¸šåŠ¡é€»è¾‘å¤„ç† (`services/`)ã€‚
  - **Model Layer (Data)**: æ•°æ®å®ä½“å®šä¹‰ (`models/`)ã€‚

### 2.2 å…³é”®ä¾èµ–åº“è¯¦è§£ (Dependencies)

#### ç½‘ç»œä¸æ•°æ®å±‚
| ä¾èµ–åº“ | ç‰ˆæœ¬ | ç”¨é€” | æ ¸å¿ƒåŠŸèƒ½ |
|--------|------|------|----------|
| `dio` | ^5.3.0 | HTTP å®¢æˆ·ç«¯ | ç»Ÿä¸€ API è¯·æ±‚ç®¡ç†ã€æ‹¦æˆªå™¨ã€é”™è¯¯å¤„ç† |
| `cached_network_image` | ^3.3.0 | å›¾ç‰‡ç¼“å­˜ | ä¸‰çº§ç¼“å­˜ã€æ¸è¿›å¼åŠ è½½ã€å ä½ç¬¦ |
| `shared_preferences` | ^2.2.2 | æœ¬åœ°é”®å€¼å­˜å‚¨ | ç”¨æˆ·æ•°æ®ã€è§‚å½±çŠ¶æ€ã€æ”¶è—è®°å½•æŒä¹…åŒ– |
| `intl` | ^0.19.0 | å›½é™…åŒ– | æ—¥æœŸæ ¼å¼åŒ–ã€å¤šè¯­è¨€æ”¯æŒ |

**Dio é…ç½®è¯¦è§£**ï¼š
```dart
TMDbService() {
  _dio = Dio(BaseOptions(
    baseUrl: 'https://api.themoviedb.org/3',
    connectTimeout: const Duration(seconds: 5),
    receiveTimeout: const Duration(seconds: 5),
    queryParameters: {
      'api_key': apiKey,
      'language': 'zh-CN',
    },
  ));
  _dio.interceptors.add(LogInterceptor(
    request: true, 
    responseBody: false, 
    error: true
  ));
}
```
- **å…¨å±€é…ç½®**ï¼šæ‰€æœ‰è¯·æ±‚è‡ªåŠ¨æºå¸¦ API Key å’Œè¯­è¨€å‚æ•°
- **è¶…æ—¶æ§åˆ¶**ï¼š5ç§’è¶…æ—¶é¿å…é•¿æ—¶é—´ç­‰å¾…ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **æ—¥å¿—æ‹¦æˆª**ï¼šå¼€å‘ç¯å¢ƒä¸‹è®°å½•è¯·æ±‚è¯¦æƒ…ï¼Œä¾¿äºè°ƒè¯•
- **é”™è¯¯é™çº§**ï¼šç½‘ç»œå¼‚å¸¸æ—¶è¿”å› Mock Dataï¼Œä¿è¯åº”ç”¨å¯ç”¨æ€§

#### UI ç»„ä»¶ä¸äº¤äº’
| ä¾èµ–åº“ | ç‰ˆæœ¬ | ç”¨é€” | åº”ç”¨åœºæ™¯ |
|--------|------|------|----------|
| `carousel_slider` | ^5.0.0 | è½®æ’­å›¾ | é¦–é¡µçƒ­é—¨ç”µå½± Banner |
| `flutter_rating_bar` | ^4.0.1 | è¯„åˆ†ç»„ä»¶ | ç”µå½±è¯„åˆ†å¯è§†åŒ–å±•ç¤º |
| `google_fonts` | ^6.1.0 | å­—ä½“åº“ | 19ç§ç”µå½±ç±»å‹ç‰¹è‰²å­—ä½“ã€å¤šè¯­è¨€å°è¯å±•ç¤º |
| `cupertino_icons` | ^1.0.2 | iOS å›¾æ ‡ | ä¿æŒè·¨å¹³å°è§†è§‰ä¸€è‡´æ€§ |

**Google Fonts åˆ›æ–°åº”ç”¨**ï¼š
```dart
// Logo æ··æ­è®¾è®¡
Text.rich(TextSpan(children: [
  TextSpan(text: 'Movie', style: GoogleFonts.fascinate(fontSize: 28)),
  TextSpan(text: 'Mind', style: GoogleFonts.peralta(fontSize: 28)),
]))

// ç”µå½±ç±»å‹ç‰¹è‰²å­—ä½“æ˜ å°„
final genreFonts = {
  28: GoogleFonts.blackOpsOne(),    // åŠ¨ä½œç‰‡
  27: GoogleFonts.rubikGlitch(),    // ææ€–ç‰‡
  878: GoogleFonts.orbitron(),      // ç§‘å¹»ç‰‡
  10749: GoogleFonts.greatVibes(),  // çˆ±æƒ…ç‰‡
  // ... å…±19ç§ç±»å‹
};
```

#### å¤šåª’ä½“æ’­æ”¾
| ä¾èµ–åº“ | ç‰ˆæœ¬ | ç”¨é€” | æŠ€æœ¯ç‰¹ç‚¹ |
|--------|------|------|----------|
| `video_player` | ^2.10.1 | è§†é¢‘æ’­æ”¾å¼•æ“ | åŸç”Ÿæ€§èƒ½ã€ä½å»¶è¿Ÿ |
| `chewie` | ^1.13.0 | æ’­æ”¾å™¨ UI | å°è£…å®Œæ•´æ§åˆ¶ç•Œé¢ |
| `youtube_player_iframe` | ^5.2.2 | YouTube æ’­æ”¾ | åµŒå…¥å¼æ’­æ”¾ã€API é›†æˆ |
| `image_picker` | ^1.0.7 | å›¾ç‰‡é€‰æ‹© | ç”¨æˆ·å¤´åƒä¸Šä¼  |

**YouTube æœåŠ¡é›†æˆ**ï¼š
```dart
class YouTubeService {
  static const String apiKey = 'AIzaSy...';
  
  Future<String?> searchVideo(String query) async {
    final response = await _dio.get('$baseUrl/search', 
      queryParameters: {
        'part': 'snippet',
        'q': query,
        'type': 'video',
        'maxResults': 1,
        'key': apiKey,
      },
    );
    return response.data['items'][0]['id']['videoId'];
  }
}
```
ç”¨æˆ·å¯ç›´è¿åˆ°YouTubeç½‘ç«™ï¼Œæ’­æ”¾è¯¥éƒ¨ç”µå½±æˆ–ä¸ä¹‹ç›¸å…³çš„è§†é¢‘ï¼Œæ¯”å¦‚é¢„å‘Šç‰‡ã€å½±è¯„ã€äºŒåˆ›ç­‰è§†é¢‘ã€‚å‡å°‘ç”¨æˆ·çš„è·¨å¹³å°çš„ç—›ç‚¹é—®é¢˜ã€‚

#### å¼‚æ­¥è®¡ç®—ä¸å¹¶å‘
- **Flutter Isolate**ï¼šåå°çº¿ç¨‹å¤„ç†ï¼Œä¸é˜»å¡ UI
- **Compute å‡½æ•°**ï¼šç®€åŒ– Isolate ä½¿ç”¨ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
- **RootIsolateToken**ï¼šç¡®ä¿ Isolate ä¸­èƒ½è®¿é—® Flutter èµ„æºï¼ˆå¦‚ AssetBundleï¼‰

```dart
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final token = RootIsolateToken.instance;
  return await compute(_parseAndSearchScripts, {
    'query': query, 
    'token': token
  });
}

// åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œ
static Future<List<QuoteMatch>> _parseAndSearchScripts(
  Map<String, dynamic> params
) async {
  final token = params['token'] as RootIsolateToken?;
  if (token != null) {
    BackgroundIsolateBinaryMessenger.ensureInitialized(token);
  }
  
  // åŠ è½½å¹¶è§£æ 308MB æ•°æ®
  final String jsonString = await rootBundle.loadString(
    'assets/scripts/movie_scripts_with_tmdb.json'
  );
  final List<dynamic> data = jsonDecode(jsonString);
  // æ‰§è¡Œæœç´¢...
}
```

### 2.3 æ•°æ®æºä¸ API æ¶æ„

#### 2.3.1 TMDb API é›†æˆ

**åŸºç¡€ä¿¡æ¯**ï¼š
- **å®˜æ–¹æ–‡æ¡£**ï¼šhttps://developers.themoviedb.org/3
- **API ç‰ˆæœ¬**ï¼šv3
- **è®¤è¯æ–¹å¼**ï¼šAPI Key (Query Parameter)
- **è¯·æ±‚é™åˆ¶**ï¼š40 è¯·æ±‚/10ç§’
- **æ•°æ®è¦†ç›–**ï¼š87ä¸‡+ ç”µå½±ï¼Œ200ä¸‡+ å½±äºº

**ä¸»è¦ç«¯ç‚¹åˆ†ç±»**ï¼š

1. **ç”µå½±åˆ—è¡¨ç±»**
   ```
   GET /movie/popular         # çƒ­é—¨ç”µå½±ï¼ˆåŸºäºè§‚çœ‹æ¬¡æ•°ï¼‰
   GET /movie/top_rated       # é«˜åˆ†ç”µå½±ï¼ˆè¯„åˆ†â‰¥7.0ï¼‰
   GET /movie/now_playing     # æ­£åœ¨çƒ­æ˜ ï¼ˆå½“å‰æ¡£æœŸï¼‰
   GET /movie/upcoming        # å³å°†ä¸Šæ˜ ï¼ˆæœªæ¥æ¡£æœŸï¼‰
   ```

2. **ç”µå½±è¯¦æƒ…ç±»**
   ```
   GET /movie/{id}                    # åŸºç¡€ä¿¡æ¯
   GET /movie/{id}/credits            # æ¼”èŒäººå‘˜ï¼ˆå‰10åï¼‰
   GET /movie/{id}/recommendations    # æ¨èç”µå½±ï¼ˆç®—æ³•ç”Ÿæˆï¼‰
   GET /movie/{id}/images             # å‰§ç…§é›†ï¼ˆå‰6å¼ ï¼‰
   GET /movie/{id}/reviews            # ç”¨æˆ·è¯„è®ºï¼ˆè‹±æ–‡ï¼‰
   GET /movie/{id}/videos             # é¢„å‘Šç‰‡ï¼ˆYouTube Keyï¼‰
   ```

3. **æœç´¢ä¸å‘ç°**
   ```
   GET /search/movie          # å…³é”®è¯æœç´¢
   GET /search/person         # å½±äººæœç´¢
   GET /discover/movie        # é«˜çº§ç­›é€‰ï¼ˆç±»å‹+åœ°åŒº+æ’åºï¼‰
   GET /genre/movie/list      # è·å–æ‰€æœ‰ç±»å‹
   ```

4. **å½±äººç›¸å…³**
   ```
   GET /person/popular             # çƒ­é—¨å½±äºº
   GET /person/{id}                # å½±äººè¯¦æƒ…
   GET /person/{id}/movie_credits # ä½œå“åˆ—è¡¨
   GET /person/{id}/tagged_images # å‰§ç…§åˆé›†
   ```

**æ•°æ®æ¨¡å‹è®¾è®¡**ï¼š
```dart
class Movie {
  final int id;                    // TMDb ID
  final String title;              // ä¸­æ–‡æ ‡é¢˜
  final String originalTitle;      // åŸå§‹æ ‡é¢˜
  final String posterPath;         // æµ·æŠ¥è·¯å¾„
  final String backdropPath;       // æ¨ªç‰ˆæµ·æŠ¥
  final double voteAverage;        // è¯„åˆ† 0-10
  final String releaseDate;        // ä¸Šæ˜ æ—¥æœŸ
  final String overview;           // å‰§æƒ…ç®€ä»‹
  final List<int> genreIds;        // ç±»å‹ ID åˆ—è¡¨
  final String tagline;            // å®£ä¼ è¯­
  final List<String> genres;       // ç±»å‹åç§°åˆ—è¡¨
  final List<String> countries;    // åˆ¶ç‰‡å›½å®¶
  final String director;           // å¯¼æ¼”å
  final int runtime;               // æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  
  // å·¥å‚æ–¹æ³•æ”¯æŒå¤šæ•°æ®æº
  factory Movie.fromJson(Map<String, dynamic> json) { }
  factory Movie.fromLocalJson(Map<String, dynamic> json) { }
}
```

#### 2.3.2 æœ¬åœ°æ•°æ®èµ„äº§

**å¥–é¡¹æ•°æ®**ï¼š
```
assets/awards/
â”œâ”€â”€ å¥¥æ–¯å¡_output_winner_nominees.json    # 95å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ æˆ›çº³_output_winner_nominees.json      # 76å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ æŸæ—_output_winner_nominees.json      # 73å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ é‡‘é¸¡å¥–_output_winner_nominees.json    # 36å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ é‡‘çˆµå¥–_output_winner_nominees.json    # 26å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ é‡‘åƒå¥–_output_winner_nominees.json    # 42å±Šå®Œæ•´æ•°æ®    
â””â”€â”€ â€¦â€¦
```

**æ•°æ®ç»“æ„**ï¼š
```json
{
  "award_name": "å¥¥æ–¯å¡",
  "year": 2024,
  "session": 95,
  "movies": [
    {
      "tmdb_id": 438631,
      "title": "Dune",
      "category": "æœ€ä½³å½±ç‰‡",
      "is_winner": true
    }
  ]
}
```

**å°è¯æ•°æ®**ï¼ˆåŒå±‚æ¶æ„ï¼‰ï¼š
1. **ç²¾é€‰å­—å¹•æ•°æ®**ï¼ˆ3.6MBï¼‰ï¼š33éƒ¨ç»å…¸ç”µå½±çš„ç²¾é€‰å°è¯
   ```json
   {
     "data": {
       "love": [
         {
           "subtitle_content": "I love you",
           "subtitle_content_zh": "æˆ‘çˆ±ä½ ",
           "start_time": "01:23:45",
           "end_time": "01:23:47",
           "tmdb": { "id": 550, "title": "Fight Club" }
         }
       ]
     }
   }
   ```

2. **å®Œæ•´å‰§æœ¬æ•°æ®**ï¼ˆ308MBï¼‰ï¼š300+ éƒ¨ç”µå½±çš„å®Œæ•´å‰§æœ¬
   ```json
   [
     {
       "script": "å®Œæ•´å‰§æœ¬æ–‡æœ¬...",
       "tmdb": { "id": 550, "title": "..." }
     }
   ]
   ```

**é™æ€èµ„æº**ï¼š
```
assets/images/
â”œâ”€â”€ genres/              # 19ç§ç”µå½±ç±»å‹èƒŒæ™¯å›¾
â”‚   â”œâ”€â”€ Action.jpg
â”‚   â”œâ”€â”€ Comedy.jpg
â”‚   â””â”€â”€ ...
â””â”€â”€ actors/              # å½±äººåˆ†ç±»å›¾
    â”œâ”€â”€ ç”·æ¼”å‘˜.jpg
    â”œâ”€â”€ å¥³æ¼”å‘˜.jpg
    â””â”€â”€ å¯¼æ¼”.jpg
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (Core Modules)

### 3.1 å››ç»´æœç´¢ç³»ç»Ÿ (`SearchPage`)

#### 3.1.1 æ¶æ„è®¾è®¡

**çŠ¶æ€ç®¡ç†**ï¼š
```dart
enum SearchType { movie, person, awards, quote }
enum SortOption { relevance, rating, date }

class _SearchPageState extends State<SearchPage> {
  SearchType _searchType = SearchType.movie;
  SortOption _sortOption = SortOption.relevance;
  
  List<Movie> _movies = [];
  List<Person> _people = [];
  List<QuoteMatch> _quoteMatches = [];
  Set<int> _winnerIds = {};  // è·å¥–ç”µå½±æ ‡è®°
}
```

**é¡µé¢ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppBar (æœç´¢æ¡† + ç±»å‹åˆ‡æ¢)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœªæœç´¢çŠ¶æ€ï¼š                         â”‚
â”‚  â”œâ”€ ç”µå½±ï¼šç±»å‹åˆ†ç±» + åœ°åŒºåˆ†ç±»         â”‚
â”‚  â”œâ”€ å½±äººï¼šç”·æ¼”å‘˜/å¥³æ¼”å‘˜/å¯¼æ¼”          â”‚
â”‚  â”œâ”€ å¥–é¡¹ï¼šå…­å¤§ç”µå½±èŠ‚å¡ç‰‡              â”‚
â”‚  â””â”€ å°è¯ï¼šå¤šè¯­è¨€æ°”æ³¡å±•ç¤º              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœç´¢ç»“æœçŠ¶æ€ï¼š                       â”‚
â”‚  â”œâ”€ ç”µå½±ï¼šç½‘æ ¼å±•ç¤º + æ’åºé€‰é¡¹         â”‚
â”‚  â”œâ”€ å½±äººï¼šåˆ—è¡¨ + å¤´åƒ                â”‚
â”‚  â”œâ”€ å¥–é¡¹ï¼šè·å¥–æ ‡è®° + ç”µå½±å¡ç‰‡         â”‚
â”‚  â””â”€ å°è¯ï¼šåŒè¯­æ˜¾ç¤º + æ—¶é—´è½´ + é«˜äº®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.2 ç”µå½±æœç´¢

**æ ¸å¿ƒé€»è¾‘**ï¼š
```dart
Future<void> _performSearch() async {
  final query = _controller.text.trim();
  if (query.isEmpty) return;
  
  setState(() => _isLoading = true);
  
  if (_searchType == SearchType.movie) {
    final results = await _tmdbService.searchMovies(query);
    setState(() => _movies = results);
    
    if (_sortOption != SortOption.relevance) {
      _applySort();  // äºŒæ¬¡æ’åº
    }
  }
}
```

**æ’åºç®—æ³•**ï¼š
```dart
void _applySort() {
  setState(() {
    switch (_sortOption) {
      case SortOption.rating:
        _movies.sort((a, b) => b.voteAverage.compareTo(a.voteAverage));
        break;
      case SortOption.date:
        _movies.sort((a, b) {
          if (a.releaseDate.isEmpty) return 1;
          if (b.releaseDate.isEmpty) return -1;
          return b.releaseDate.compareTo(a.releaseDate);
        });
        break;
      case SortOption.relevance:
        break;  // ä¿æŒ API è¿”å›çš„ç›¸å…³åº¦æ’åº
    }
  });
}
```

**åˆ†ç±»æµè§ˆ**ï¼ˆæœªæœç´¢çŠ¶æ€ï¼‰ï¼š
- **19ç§ç”µå½±ç±»å‹**ï¼šæ¯ç§é…å¤‡ç‰¹è‰²å­—ä½“å’ŒèƒŒæ™¯å›¾
- **6ä¸ªåœ°åŒº**ï¼šä¸­å›½ã€ç¾å›½ã€éŸ©å›½ã€æ—¥æœ¬ã€è‹±å›½ã€æ³•å›½ï¼Œå¸¦å›½æ——èƒŒæ™¯
- **ç‚¹å‡»è·³è½¬**ï¼šè°ƒç”¨ `discoverMovies(genreId: ?, region: ?)` è·å–ç­›é€‰ç»“æœ

#### 3.1.3 å½±äººæœç´¢

**æ•°æ®è·å–**ï¼š
```dart
Future<List<Person>> searchPeople(String query) async {
  final response = await _dio.get('/search/person', 
    queryParameters: {'query': query}
  );
  final results = response.data['results'] as List;
  return results.map((e) => Person.fromJson(e)).toList();
}
```

**çƒ­é—¨å¯¼æ¼”è·å–**ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰ï¼š
```dart
Future<List<Person>> getPopularDirectors() async {
  List<Person> directors = [];
  // æ‰«æå‰5é¡µçƒ­é—¨å½±äºº
  for (int i = 1; i <= 5; i++) {
    final people = await getPopularPeople(page: i);
    directors.addAll(
      people.where((p) => p.knownForDepartment == 'Directing')
    );
    if (directors.length >= 20) break;
  }
  return directors;
}
```

**UI å±•ç¤º**ï¼š
- åœ†å½¢å¤´åƒ + å§“å
- ç‚¹å‡»è·³è½¬è‡³å½±äººè¯¦æƒ…é¡µ
- é»˜è®¤é¡µå±•ç¤ºä¸‰ä¸ªåˆ†ç±»å¡ç‰‡ï¼šç”·æ¼”å‘˜(gender=2)ã€å¥³æ¼”å‘˜(gender=1)ã€å¯¼æ¼”(department=Directing)

#### 3.1.4 å¥–é¡¹æœç´¢ï¼ˆæœ¬åœ°æ•°æ®ï¼‰

**è‡ªç„¶è¯­è¨€è§£æ**ï¼š
```dart
Future<List<Award>> searchAwards(String query) async {
  // æ­£åˆ™åŒ¹é…ï¼š"ç¬¬77å±Šå¥¥æ–¯å¡"ã€"2024å¹´æŸæ—"ç­‰
  final sessionPattern = RegExp(
    r'(?:ç¬¬)?(\d+)(?:å±Š)?\s*([^\d\s]+)|([^\d\s]+)\s*(?:ç¬¬)?(\d+)(?:å±Š)?'
  );
  final yearPattern = RegExp(
    r'(\d{4})(?:å¹´)?\s*([^\d\s]+)|([^\d\s]+)\s*(\d{4})(?:å¹´)?'
  );
  
  String? awardName;
  int? session;
  int? year;
  
  // è§£ææŸ¥è¯¢è¯...
  final sessionMatch = sessionPattern.firstMatch(query);
  if (sessionMatch != null) {
    session = int.tryParse(sessionMatch.group(1) ?? '');
    awardName = _normalizeAwardName(sessionMatch.group(2) ?? '');
  }
  
  // åŠ è½½å¯¹åº”å¥–é¡¹æ•°æ®å¹¶ç­›é€‰
  final allYears = await getAwards(awardName);
  return session != null 
    ? allYears.where((a) => a.session == session).toList()
    : allYears.where((a) => a.year == year).toList();
}
```

**å¥–é¡¹åç§°æ ‡å‡†åŒ–**ï¼š
```dart
String? _normalizeAwardName(String input) {
  if (input.contains('å¥¥æ–¯å¡')) return 'å¥¥æ–¯å¡';
  if (input.contains('æŸæ—')) return 'æŸæ—ç”µå½±èŠ‚';
  if (input.contains('æˆ›çº³') || input.contains('åº·åŸ')) return 'æˆ›çº³ç”µå½±èŠ‚';
  if (input.contains('é‡‘é¸¡')) return 'é‡‘é¸¡å¥–';
  if (input.contains('é‡‘çˆµ')) return 'ä¸Šæµ·é‡‘çˆµå¥–';
  if (input.contains('é‡‘åƒ')) return 'é¦™æ¸¯é‡‘åƒå¥–';
  return null;
}
```

**è·å¥–æ ‡è®°**ï¼š
```dart
Set<int> _winnerIds = {};  // å­˜å‚¨è·å¥–ç”µå½±çš„ TMDb ID

// æœç´¢ç»“æœä¸­ï¼Œè·å¥–ç”µå½±å³ä¸Šè§’æ˜¾ç¤ºé‡‘è‰²å¥–æ¯å›¾æ ‡
if (_winnerIds.contains(movie.id))
  Positioned(
    top: 8, right: 8,
    child: Container(
      decoration: BoxDecoration(
        color: Colors.amber,
        shape: BoxShape.circle,
      ),
      child: Icon(Icons.emoji_events, color: Colors.white),
    ),
  )
```

#### 3.1.5 å°è¯æœç´¢ï¼ˆæ ¸å¿ƒäº®ç‚¹ï¼‰

**åŒå¼•æ“æ¶æ„**ï¼š

```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥å…³é”®è¯] --> B{å­—ç¬¦é•¿åº¦>=2?}
    B -->|æ˜¯| C[å¼•æ“1: ç²¾é€‰å­—å¹•æœç´¢]
    B -->|æ˜¯| D[å¼•æ“2: å‰§æœ¬æ·±åº¦æœç´¢]
    C --> E[åˆå¹¶ç»“æœ]
    D --> E
    E --> F[å»é‡æ’åº]
    F --> G[UIæ¸²æŸ“]
    B -->|å¦| C
```

**å¼•æ“1ï¼šç²¾é€‰å­—å¹•æœç´¢**ï¼ˆä¸»çº¿ç¨‹ï¼Œ<50msï¼‰
```dart
Future<List<QuoteMatch>> searchQuotes(String query) async {
  List<QuoteMatch> results = [];
  final lowerQuery = query.toLowerCase().trim();
  
  // éå†ç²¾é€‰æ•°æ®ï¼ˆ3.6MBï¼Œç»“æ„åŒ–ç´¢å¼•ï¼‰
  _subtitleData!.forEach((keyword, matches) {
    bool keywordMatches = keyword.toLowerCase().contains(lowerQuery);
    
    for (var item in matches) {
      String content = item['subtitle_content'] ?? '';
      String contentZh = item['subtitle_content_zh'] ?? '';
      
      if (keywordMatches || 
          content.toLowerCase().contains(lowerQuery) || 
          contentZh.contains(lowerQuery)) {
        results.add(QuoteMatch(
          movie: Movie.fromLocalJson(item['tmdb']),
          contentEn: content,
          contentZh: contentZh,
          startTime: item['start_time'],
          endTime: item['end_time'],
          keyword: keyword,
          source: 'subtitle',
        ));
      }
    }
  });
  
  return results;
}
```

**å¼•æ“2ï¼šå‰§æœ¬æ·±åº¦æœç´¢**ï¼ˆIsolate çº¿ç¨‹ï¼Œ1-2sï¼‰
```dart
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final token = RootIsolateToken.instance;
  return await compute(_parseAndSearchScripts, {
    'query': query, 
    'token': token
  });
}

static Future<List<QuoteMatch>> _parseAndSearchScripts(
  Map<String, dynamic> params
) async {
  // 1. åˆå§‹åŒ– Isolate æ¶ˆæ¯é€šé“
  final token = params['token'] as RootIsolateToken?;
  if (token != null) {
    BackgroundIsolateBinaryMessenger.ensureInitialized(token);
  }
  
  // 2. åŠ è½½å¤§æ–‡ä»¶ï¼ˆ308MBï¼‰
  final String jsonString = await rootBundle.loadString(
    'assets/scripts/movie_scripts_with_tmdb.json'
  );
  
  // 3. è§£æå¹¶æœç´¢
  final List<dynamic> data = jsonDecode(jsonString);
  final List<QuoteMatch> results = [];
  final lowerQuery = params['query'].toLowerCase();
  
  for (var item in data) {
    final script = (item['script'] as String).toLowerCase();
    if (script.contains(lowerQuery)) {
      // æå–ä¸Šä¸‹æ–‡ç‰‡æ®µï¼ˆå‰å50å­—ç¬¦ï¼‰
      final index = script.indexOf(lowerQuery);
      int start = (index - 50).clamp(0, script.length);
      int end = (index + lowerQuery.length + 50).clamp(0, script.length);
      String snippet = '...' + item['script'].substring(start, end) + '...';
      
      results.add(QuoteMatch(
        movie: Movie.fromLocalJson(item['tmdb']),
        matchedContent: snippet,
        keyword: params['query'],
        source: 'script'
      ));
    }
  }
  return results;
}
```

**å…³é”®è¯é«˜äº®ç®—æ³•**ï¼š
```dart
Widget _buildHighlightText(String text, String query, TextStyle style) {
  final lowerText = text.toLowerCase();
  final lowerQuery = query.toLowerCase();
  
  if (!lowerText.contains(lowerQuery)) {
    return Text(text, style: style);
  }
  
  final List<TextSpan> spans = [];
  int start = 0;
  int indexOfHighlight;
  
  // éå†æ‰€æœ‰åŒ¹é…ä½ç½®
  while ((indexOfHighlight = lowerText.indexOf(lowerQuery, start)) != -1) {
    // æ·»åŠ é«˜äº®å‰çš„æ™®é€šæ–‡æœ¬
    if (indexOfHighlight > start) {
      spans.add(TextSpan(
        text: text.substring(start, indexOfHighlight), 
        style: style
      ));
    }
    
    // æ·»åŠ é«˜äº®æ–‡æœ¬ï¼ˆçº¢è‰²åŠ ç²—ï¼‰
    spans.add(TextSpan(
      text: text.substring(
        indexOfHighlight, 
        indexOfHighlight + query.length
      ),
      style: style.copyWith(
        color: Colors.redAccent, 
        fontWeight: FontWeight.bold
      ),
    ));
    
    start = indexOfHighlight + query.length;
  }
  
  // æ·»åŠ å‰©ä½™æ–‡æœ¬
  if (start < text.length) {
    spans.add(TextSpan(text: text.substring(start), style: style));
  }
  
  return RichText(text: TextSpan(children: spans));
}
```

**æœç´¢ç»“æœå±•ç¤º**ï¼š
```dart
// å­—å¹•æ¥æºï¼šåŒè¯­ + æ—¶é—´è½´
if (match.source == 'subtitle') {
  Column(
    children: [
      // è‹±æ–‡å°è¯ï¼ˆæ–œä½“è¡¬çº¿å­—ä½“ï¼‰
      _buildHighlightText(
        match.contentEn, 
        query,
        GoogleFonts.notoSerif(fontSize: 15, fontStyle: FontStyle.italic)
      ),
      SizedBox(height: 8),
      // ä¸­æ–‡å°è¯
      _buildHighlightText(
        match.contentZh, 
        query,
        TextStyle(fontSize: 16, fontWeight: FontWeight.w500)
      ),
      // æ—¶é—´è½´æ ‡ç­¾
      Container(
        padding: EdgeInsets.symmetric(horizontal: 6, vertical: 2),
        decoration: BoxDecoration(
          color: Colors.grey[200],
          borderRadius: BorderRadius.circular(4),
        ),
        child: Text(
          '${match.startTime} â€” ${match.endTime}',
          style: TextStyle(fontSize: 11, fontFamily: 'monospace')
        ),
      )
    ]
  )
}

// å‰§æœ¬æ¥æºï¼šä¸Šä¸‹æ–‡ç‰‡æ®µ
else {
  _buildHighlightText(
    match.matchedContent, 
    query,
    GoogleFonts.notoSerif(fontSize: 15, height: 1.6)
  )
}
```

**æ€§èƒ½ä¼˜åŒ–æªæ–½**ï¼š
1. **åˆ†å±‚åŠ è½½**ï¼šä¼˜å…ˆåŠ è½½å°æ–‡ä»¶ï¼Œé¿å…å¯åŠ¨æ—¶é•¿æ—¶é—´é˜»å¡
2. **å»¶è¿Ÿè§¦å‘**ï¼šåªæœ‰æŸ¥è¯¢è¯é•¿åº¦â‰¥2æ—¶æ‰å¯åŠ¨æ·±åº¦æœç´¢
3. **ç»“æœé™åˆ¶**ï¼šæ¯ä¸ªæ•°æ®æºæœ€å¤šè¿”å›50æ¡ç»“æœ
4. **å¼‚æ­¥åˆå¹¶**ï¼šä¸¤ä¸ªå¼•æ“å¹¶è¡Œæ‰§è¡Œï¼Œä½¿ç”¨ `Future.wait()` ç­‰å¾…
5. **UI åé¦ˆ**ï¼šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ï¼Œå‘ŠçŸ¥ç”¨æˆ·æ­£åœ¨æœç´¢

### 3.2 ç”µå½±è¯¦æƒ…é¡µ (`MovieDetailPage`)

#### 3.2.1 æ²‰æµ¸å¼ UI è®¾è®¡

**åŠ¨æ€ AppBar é€æ˜åº¦**ï¼š
```dart
final ScrollController _scrollController = ScrollController();
double _appBarOpacity = 0.0;

@override
void initState() {
  super.initState();
  _scrollController.addListener(() {
    double offset = _scrollController.offset;
    double opacity = (offset / 200).clamp(0.0, 1.0);
    if (opacity != _appBarOpacity) {
      setState(() => _appBarOpacity = opacity);
    }
  });
}

// AppBar èƒŒæ™¯è‰²éšæ»šåŠ¨æ¸å˜
AppBar(
  backgroundColor: Colors.black.withOpacity(_appBarOpacity * 0.8),
  title: _appBarOpacity > 0.8 
    ? Text(movie.title) 
    : null,  // é¡¶éƒ¨æ—¶éšè—æ ‡é¢˜
)
```

**æ¯›ç»ç’ƒèƒŒæ™¯æ•ˆæœ**ï¼š
```dart
Stack(
  children: [
    // 1. èƒŒæ™¯ï¼šæ¨¡ç³Šçš„æµ·æŠ¥
    Positioned.fill(
      child: CachedNetworkImage(
        imageUrl: movie.fullPosterUrl,
        fit: BoxFit.cover,
      )
    ),
    // 2. æ¯›ç»ç’ƒæ»¤é•œ
    Positioned.fill(
      child: BackdropFilter(
        filter: ImageFilter.blur(sigmaX: 30, sigmaY: 30),
        child: Container(color: Colors.black.withOpacity(0.3)),
      )
    ),
    // 3. å†…å®¹å±‚
    SingleChildScrollView(child: ...)
  ]
)
```

**Hero åŠ¨ç”»è¿‡æ¸¡**ï¼š
```dart
// åˆ—è¡¨é¡µ
Hero(
  tag: 'detail_poster_${movie.id}',
  child: CachedNetworkImage(imageUrl: movie.fullPosterUrl)
)

// è¯¦æƒ…é¡µï¼ˆç›¸åŒ tagï¼‰
Hero(
  tag: 'detail_poster_${movie.id}',
  child: Container(
    width: 140,
    height: 210,
    decoration: BoxDecoration(
      image: DecorationImage(image: CachedNetworkImageProvider(...))
    )
  )
)
```

#### 3.2.2 æ•°æ®åŠ è½½ç­–ç•¥

**å¹¶è¡Œè¯·æ±‚ä¼˜åŒ–**ï¼š
```dart
void _loadExtraData() async {
  // ä½¿ç”¨ Future.wait å¹¶è¡Œå‘èµ·å¤šä¸ªè¯·æ±‚
  final results = await Future.wait([
    _tmdbService.getMovieDetail(_movie.id),       // å®Œæ•´è¯¦æƒ…
    _tmdbService.getMovieCredits(_movie.id),      // æ¼”èŒäººå‘˜
    _tmdbService.getMovieRecommendations(_movie.id), // æ¨è
    _tmdbService.getMovieImages(_movie.id),       // å‰§ç…§
    _tmdbService.getMovieReviews(_movie.id),      // è¯„è®º
    _youTubeService.searchVideo(_movie.title),    // YouTube è§†é¢‘
  ]);
  
  setState(() {
    _movie = results[0] as Movie;
    _cast = results[1] as List<Cast>;
    _recommendations = results[2] as List<Movie>;
    _images = results[3] as List<String>;
    _reviews = results[4] as List<Review>;
    _videoKey = results[5] as String?;
  });
}
```

**çŠ¶æ€åŒæ­¥**ï¼š
```dart
void _checkStatus() async {
  // å¹¶è¡ŒæŸ¥è¯¢æœ¬åœ°çŠ¶æ€
  final results = await Future.wait([
    _storageService.isFavorite(_movie.id),
    _storageService.getWatchStatus(_movie.id),
    _storageService.getProgress(_movie.id),
    _storageService.getNote(_movie.id),
  ]);
  
  setState(() {
    _isFavorite = results[0] as bool;
    _watchStatus = results[1] as WatchStatus;
    _progress = results[2] as double;
    _userNote = results[3] as String?;
  });
}
```

#### 3.2.3 è§‚å½±çŠ¶æ€ç®¡ç†

**ä¸‰æ€çŠ¶æ€æœº**ï¼š
```dart
enum WatchStatus { none, wantToWatch, watching, watched }

void _changeWatchStatus(WatchStatus status) async {
  await _storageService.setWatchStatus(_movie, status);
  setState(() => _watchStatus = status);
}

// UI å±•ç¤º
Row(
  children: [
    _buildStatusButton(WatchStatus.wantToWatch, 'æƒ³çœ‹', 
      Icons.bookmark_border, Icons.bookmark),
    _buildStatusButton(WatchStatus.watching, 'æ­£åœ¨çœ‹', 
      Icons.play_circle_outline, Icons.play_circle_fill),
    _buildStatusButton(WatchStatus.watched, 'çœ‹è¿‡', 
      Icons.check_circle_outline, Icons.check_circle),
  ]
)
```

**è§‚çœ‹è¿›åº¦è¿½è¸ª**ï¼š
```dart
// åªåœ¨"åœ¨çœ‹"çŠ¶æ€æ˜¾ç¤ºè¿›åº¦æ¡
if (_watchStatus == WatchStatus.watching) 
  Column(
    children: [
      Text('è§‚çœ‹è¿›åº¦: ${(_progress * 100).toInt()}%'),
      Slider(
        value: _progress,
        onChanged: (value) async {
          setState(() => _progress = value);
          await _storageService.setProgress(_movie.id, value);
        },
      )
    ]
  )
```

#### 3.2.4 è‡ªå®šä¹‰ç‰‡å•

**åˆ›å»ºç‰‡å•å¯¹è¯æ¡†**ï¼š
```dart
void _showAddToListDialog() async {
  final lists = await _storageService.getCustomListNames();
  
  showModalBottomSheet(
    context: context,
    builder: (context) => StatefulBuilder(
      builder: (context, setModalState) {
        return Container(
          child: Column(
            children: [
              // ç°æœ‰ç‰‡å•åˆ—è¡¨
              Expanded(
                child: ListView.builder(
                  itemCount: lists.length,
                  itemBuilder: (context, index) {
                    return ListTile(
                      title: Text(lists[index]),
                      trailing: Icon(Icons.add_circle_outline),
                      onTap: () async {
                        await _storageService.addMovieToCustomList(
                          lists[index], _movie
                        );
                        Navigator.pop(context);
                      },
                    );
                  },
                ),
              ),
              // æ–°å»ºç‰‡å•
              TextField(
                controller: textController,
                decoration: InputDecoration(hintText: 'ç‰‡å•åç§°'),
              ),
              TextField(
                controller: descController,
                decoration: InputDecoration(hintText: 'ä¸€å¥è¯ç®€ä»‹'),
              ),
              ElevatedButton(
                child: Text('åˆ›å»º'),
                onPressed: () async {
                  await _storageService.createCustomList(
                    textController.text, 
                    description: descController.text
                  );
                  // åˆ·æ–°åˆ—è¡¨
                  final newLists = await _storageService.getCustomListNames();
                  setModalState(() {
                    lists.clear();
                    lists.addAll(newLists);
                  });
                },
              )
            ],
          ),
        );
      }
    ),
  );
}
```

#### 3.2.5 ç¬”è®°ç³»ç»Ÿ

**å¯Œæ–‡æœ¬ç¼–è¾‘**ï¼š
```dart
void _showNoteDialog() {
  final noteController = TextEditingController(text: _userNote);
  
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('æˆ‘çš„è§‚å½±ç¬”è®°'),
      content: TextField(
        controller: noteController,
        maxLines: 5,
        decoration: InputDecoration(
          hintText: 'è®°å½•ä¸‹è¿™ä¸€åˆ»çš„æ„Ÿå—...',
          filled: true,
          fillColor: Colors.grey[100],
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide.none,
          ),
        ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('å–æ¶ˆ'),
        ),
        ElevatedButton(
          onPressed: () async {
            await _storageService.saveNote(_movie, noteController.text);
            setState(() => _userNote = noteController.text);
            Navigator.pop(context);
          },
          child: Text('ä¿å­˜'),
        ),
      ],
    ),
  );
}
```

**ç¬”è®°å±•ç¤ºå¡ç‰‡**ï¼š
```dart
Container(
  padding: EdgeInsets.all(20),
  decoration: BoxDecoration(
    color: Color(0xFFFFF8E1),  // æš–é»„è‰²èƒŒæ™¯
    borderRadius: BorderRadius.circular(16),
    border: Border.all(color: Color(0xFFFFECB3)),
    boxShadow: [
      BoxShadow(
        color: Colors.black.withOpacity(0.05),
        blurRadius: 10,
        offset: Offset(0, 5)
      )
    ],
  ),
  child: Column(
    children: [
      Row(
        children: [
          Icon(Icons.format_quote_rounded, color: Colors.amber),
          Text('Review', style: TextStyle(color: Colors.amber))
        ]
      ),
      Text(
        _userNote!,
        style: TextStyle(
          fontSize: 15,
          height: 1.6,
          color: Colors.brown[800],
          fontStyle: FontStyle.italic
        )
      ),
      TextButton.icon(
        onPressed: _showNoteDialog,
        icon: Icon(Icons.edit, size: 14),
        label: Text('ç¼–è¾‘'),
      )
    ],
  ),
)
```

#### 3.2.6 å¤šåª’ä½“å±•ç¤º

**é¢„å‘Šç‰‡æ’­æ”¾**ï¼š
```dart
ElevatedButton.icon(
  onPressed: () {
    if (_videoKey != null) {
      Navigator.push(
        context,
        MaterialPageRoute(
          builder: (context) => VideoPlayerPage(
            videoId: _videoKey!,
            title: movie.title,
          ),
        ),
      );
    } else {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('æš‚æ— é¢„å‘Šç‰‡èµ„æº')),
      );
    }
  },
  style: ElevatedButton.styleFrom(
    backgroundColor: _videoKey != null 
      ? Color(0xFFFF5252) 
      : Colors.grey,
    foregroundColor: Colors.white,
    elevation: 4,
  ),
  icon: Icon(Icons.play_arrow_rounded),
  label: Text(_videoKey != null ? 'ç›¸å…³è§†é¢‘' : 'æš‚æ— èµ„æº'),
)
```

**å‰§ç…§ç›¸å†Œ**ï¼ˆæ”¯æŒæ‰‹åŠ¿ç¼©æ”¾ï¼‰ï¼š
```dart
void _showFullImage(BuildContext context, int initialIndex) {
  PageController pageController = PageController(initialPage: initialIndex);
  
  showDialog(
    context: context,
    builder: (context) => Dialog(
      backgroundColor: Colors.transparent,
      insetPadding: EdgeInsets.zero,
      child: Stack(
        children: [
          // å¯æ»‘åŠ¨çš„å›¾ç‰‡æµè§ˆå™¨
          PageView.builder(
            controller: pageController,
            itemCount: _images.length,
            itemBuilder: (context, index) {
              return InteractiveViewer(  // æ”¯æŒåŒæŒ‡ç¼©æ”¾
                child: CachedNetworkImage(
                  imageUrl: _images[index],
                  fit: BoxFit.contain
                ),
              );
            },
          ),
          // å…³é—­æŒ‰é’®
          Positioned(
            top: 40, right: 20,
            child: IconButton(
              icon: Icon(Icons.close, color: Colors.white, size: 30),
              onPressed: () => Navigator.pop(context),
            )
          ),
          // é¡µç æŒ‡ç¤ºå™¨
          Positioned(
            bottom: 40,
            child: Container(
              padding: EdgeInsets.symmetric(horizontal: 12, vertical: 6),
              decoration: BoxDecoration(
                color: Colors.black54,
                borderRadius: BorderRadius.circular(20),
              ),
              child: SmoothPageIndicator(
                controller: pageController,
                count: _images.length,
                effect: ScrollingDotsEffect(
                  activeDotColor: Colors.white,
                  dotColor: Colors.grey,
                ),
              ),
            ),
          ),
        ],
      ),
    ),
  );
}
```

### 3.3 ä¸ªäººä¸»é¡µ (`ProfilePage`)

#### 3.3.1 ç”¨æˆ·ç³»ç»Ÿ

**æ³¨å†Œç™»å½•æµç¨‹**ï¼š
```dart
Future<void> register(String username, String password) async {
  final prefs = await SharedPreferences.getInstance();
  final dbJson = prefs.getString(_usersDbKey);
  Map<String, dynamic> db = dbJson != null ? jsonDecode(dbJson) : {};
  
  // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
  if (db.values.any((u) => u['username'] == username)) {
    throw Exception('ç”¨æˆ·åå·²å­˜åœ¨');
  }
  
  // åˆ›å»ºæ–°ç”¨æˆ·
  final newUser = User(
    id: DateTime.now().millisecondsSinceEpoch.toString(),
    username: username,
    password: password,
    avatar: 'https://i.pravatar.cc/150?img=${username.length % 70}',
  );
  
  // ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
  db[newUser.id] = newUser.toJson();
  await prefs.setString(_usersDbKey, jsonEncode(db));
  await prefs.setString(_userKey, jsonEncode(newUser.toJson()));
}
```

**å¤´åƒç®¡ç†**ï¼š
```dart
void _changeAvatar() {
  showModalBottomSheet(
    context: context,
    builder: (context) => Container(
      child: Column(
        children: [
          // ä»ç›¸å†Œé€‰æ‹©
          ListTile(
            leading: Icon(Icons.photo_library),
            title: Text('ä»ç›¸å†Œé€‰æ‹©'),
            onTap: () async {
              final XFile? image = await _picker.pickImage(
                source: ImageSource.gallery
              );
              if (image != null) {
                final updatedUser = _currentUser!.copyWith(
                  avatar: image.path
                );
                await _storageService.updateUser(updatedUser);
                setState(() => _currentUser = updatedUser);
              }
            },
          ),
          // é€‰æ‹©é»˜è®¤å¤´åƒ
          Expanded(
            child: GridView.builder(
              gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                crossAxisCount: 4
              ),
              itemCount: 8,
              itemBuilder: (context, index) {
                final url = 'https://i.pravatar.cc/150?img=${index * 5 + 10}';
                return GestureDetector(
                  onTap: () async {
                    final updatedUser = _currentUser!.copyWith(avatar: url);
                    await _storageService.updateUser(updatedUser);
                    setState(() => _currentUser = updatedUser);
                    Navigator.pop(context);
                  },
                  child: CircleAvatar(backgroundImage: NetworkImage(url)),
                );
              },
            ),
          )
        ],
      ),
    ),
  );
}
```

#### 3.3.2 è§‚å½±çƒ­åº¦å›¾ (`ContributionHeatmap`)

**æ•°æ®ç»“æ„**ï¼š
```dart
Map<DateTime, int> _heatmapData = {};

// ä»æ—¶é—´æˆ³æ„å»ºçƒ­åº¦å›¾
final timestamps = await _storageService.getAllTimestamps();
timestamps.forEach((key, value) {
  final date = DateTime.fromMillisecondsSinceEpoch(value);
  final normalizedDate = DateTime(date.year, date.month, date.day);
  heatmapData[normalizedDate] = (heatmapData[normalizedDate] ?? 0) + 1;
});
```

**ç½‘æ ¼å¸ƒå±€ç®—æ³•**ï¼š
```dart
Widget _buildGrid(DateTime startDate, int columns, double boxSize) {
  return Row(
    children: List.generate(columns, (colIndex) {
      final weekStart = startDate.add(Duration(days: colIndex * 7));
      return Column(
        children: List.generate(7, (rowIndex) {
          final date = weekStart.add(Duration(days: rowIndex));
          final normalizedDate = DateTime(date.year, date.month, date.day);
          final count = data[normalizedDate] ?? 0;
          
          return Container(
            width: boxSize,
            height: boxSize,
            margin: EdgeInsets.all(1.5),
            decoration: BoxDecoration(
              color: _getColor(count),
              borderRadius: BorderRadius.circular(1.5),
            ),
            child: Tooltip(
              message: '${DateFormat('yyyy-MM-dd').format(date)}: $count',
            ),
          );
        }),
      );
    }),
  );
}
```

**é¢œè‰²æ˜ å°„**ï¼š
```dart
Color _getColor(int count) {
  if (count == 0) return Color(0xFFEEEEEE);    // æµ…ç°
  if (count == 1) return Color(0xFFFFE0B2);    // æµ…æ©™
  if (count <= 3) return Color(0xFFFFB74D);    // ä¸­æ©™
  if (count <= 5) return Color(0xFFFF9800);    // æ·±æ©™
  return Color(0xFFE65100);                     // çº¢æ©™
}
```

#### 3.3.3 ç»Ÿè®¡æ•°æ®å±•ç¤º

**æ•°æ®æ±‡æ€»**ï¼š
```dart
int _watchedCount = 0;      // çœ‹è¿‡
int _wantCount = 0;         // æƒ³çœ‹
int _watchingCount = 0;     // åœ¨çœ‹
int _favoriteCount = 0;     // æ”¶è—
int _commentCount = 0;      // è¯„è®º
int _listCount = 0;         // ç‰‡å•

void _loadData() async {
  final results = await Future.wait([
    _storageService.getMoviesByStatus(WatchStatus.watched),
    _storageService.getMoviesByStatus(WatchStatus.wantToWatch),
    _storageService.getMoviesByStatus(WatchStatus.watching),
    _storageService.getFavorites(),
    _storageService.getCommentedMovies(),
    _storageService.getCustomListNames(),
  ]);
  
  setState(() {
    _watchedCount = results[0].length;
    _wantCount = results[1].length;
    _watchingCount = results[2].length;
    _favoriteCount = results[3].length;
    _commentCount = results[4].length;
    _listCount = results[5].length;
  });
}
```

### 3.3 æ•°æ®æœåŠ¡å±‚ (`Services`)
- **`TMDbService`**: å°è£…æ‰€æœ‰å¤–éƒ¨ API è°ƒç”¨ï¼Œå¤„ç† JSON åºåˆ—åŒ–ä¸å¼‚å¸¸ã€‚
- **`StorageService`**: å°è£…æœ¬åœ°å­˜å‚¨é€»è¾‘ï¼Œç®¡ç† JSON æ ¼å¼çš„ç”¨æˆ·æ•°æ®ï¼ˆå¦‚è‡ªå®šä¹‰ç‰‡å•ï¼‰ã€‚
- **`QuoteService`**: ä¸“ç”¨äºå¤„ç†å°è¯æ£€ç´¢ã€‚
  - *ä¼˜åŒ–ç­–ç•¥*: å®ç°äº† `compute` å‡½æ•°è°ƒç”¨ï¼Œå°†è€—æ—¶çš„ JSON è§£æå’Œå­—ç¬¦ä¸²åŒ¹é…ä»»åŠ¡æ”¾å…¥åå°éš”ç¦»çº¿ç¨‹ï¼Œè§£å†³äº†å¤§æ–‡ä»¶æœç´¢å¯¼è‡´çš„ç•Œé¢å†»ç»“é—®é¢˜ã€‚
  - *æ•°æ®æ˜ å°„*: å®ç°äº†ä»æœ¬åœ°æ•°æ®é›† ID (`tmdb_id`) åˆ°åœ¨çº¿ API æ•°æ®çš„æ˜ å°„ï¼Œç¡®ä¿æœ¬åœ°æœç´¢ç»“æœèƒ½è·³è½¬è‡³å®Œæ•´çš„è¯¦æƒ…é¡µã€‚

---

## 4. è¯¦ç»†æŠ€æœ¯å®ç° (Technical Implementation Details)

### 4.1 åº”ç”¨æ¶æ„è®¾è®¡

#### 4.1.1 ä¸»åº”ç”¨å…¥å£ (`main.dart`)
```dart
class MovieMindApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      theme: ThemeData(
        scaffoldBackgroundColor: const Color(0xFFF5F5F7),
        primaryColor: Colors.black,
        useMaterial3: true,
        fontFamily: 'San Francisco',
      ),
      home: const MainScreen(),
    );
  }
}
```

åº”ç”¨é‡‡ç”¨ **Material Design 3** è®¾è®¡è¯­è¨€ï¼Œé…ç½®äº†ç»Ÿä¸€çš„ä¸»é¢˜è‰²å½©æ–¹æ¡ˆï¼š
- **èƒŒæ™¯è‰²**: `#F5F5F7` (è‹¹æœé£æ ¼çš„æµ…ç°è‰²)
- **ä¸»è‰²è°ƒ**: é»‘è‰²ç³»ï¼Œè¥é€ ä¸“ä¸šç”µå½±åº”ç”¨çš„è§†è§‰æ„Ÿå—
- **å­—ä½“**: San Francisco ç³»ç»Ÿå­—ä½“ï¼Œç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§

#### 4.1.2 åº•éƒ¨å¯¼èˆªæ¶æ„
```dart
class MainScreen extends StatefulWidget {
  int _currentIndex = 0;
  final List<Widget> _pages = [
    const HomeTab(),      // é¦–é¡µæ¨è
    const SearchPage(),   // æœç´¢é¡µé¢
    const MyMoviesPage(), // æˆ‘çš„ç”µå½±
    const ProfilePage(),  // ä¸ªäººèµ„æ–™
  ];
}
```

é‡‡ç”¨ `PageView` + `BottomNavigationBar` çš„ç»å…¸æ¶æ„ï¼Œæ”¯æŒæ‰‹åŠ¿æ»‘åŠ¨åˆ‡æ¢é¡µé¢ã€‚

### 4.2 æ•°æ®å±‚å®ç°

#### 4.2.1 TMDb API æœåŠ¡ (`TMDbService`)
```dart
class TMDbService {
  static const String apiKey = '9d5a5768705c19907badb63abbb20821';
  static const String baseUrl = 'https://api.themoviedb.org/3';
  
  late final Dio _dio;
  
  TMDbService() {
    _dio = Dio(BaseOptions(
      baseUrl: baseUrl,
      connectTimeout: const Duration(seconds: 5),
      receiveTimeout: const Duration(seconds: 5),
      queryParameters: {
        'api_key': apiKey,
        'language': 'zh-CN',
      },
    ));
    _dio.interceptors.add(LogInterceptor());
  }
}
```

**æ ¸å¿ƒç‰¹æ€§**:
- **ç»Ÿä¸€é…ç½®**: æ‰€æœ‰è¯·æ±‚è‡ªåŠ¨æºå¸¦ API Key å’Œä¸­æ–‡è¯­è¨€å‚æ•°
- **è¶…æ—¶æ§åˆ¶**: è¿æ¥å’Œæ¥æ”¶è¶…æ—¶å‡è®¾ä¸º 5 ç§’ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
- **æ—¥å¿—æ‹¦æˆª**: å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- **é”™è¯¯å¤„ç†**: å®ç°äº†å®Œæ•´çš„å¼‚å¸¸æ•è·æœºåˆ¶

**ä¸»è¦ API å°è£…**:
```dart
// ç”µå½±ç›¸å…³
Future<List<Movie>> getNowPlaying() => _getMovies('/movie/now_playing');
Future<List<Movie>> getPopular() => _getMovies('/movie/popular');
Future<Movie?> getMovieDetail(int movieId) async { /* ... */ }

// æœç´¢ç›¸å…³
Future<List<Movie>> searchMovies(String query) async { /* ... */ }
Future<List<Person>> searchPeople(String query) async { /* ... */ }

// å‘ç°ç›¸å…³
Future<List<Movie>> discoverMovies({int? genreId, String? region}) async { /* ... */ }
```

#### 4.2.2 æœ¬åœ°å­˜å‚¨æœåŠ¡ (`StorageService`)
```dart
class StorageService {
  static const String _favoritesKey = 'favorites';
  static const String _watchStatusKey = 'watch_status';
  static const String _notesKey = 'notes';
  
  Future<bool> toggleFavorite(Movie movie) async {
    final prefs = await SharedPreferences.getInstance();
    List<String> favorites = prefs.getStringList(_favoritesKey) ?? [];
    
    final movieJson = jsonEncode(movie.toJson());
    if (favorites.contains(movieJson)) {
      favorites.remove(movieJson);
      await prefs.setStringList(_favoritesKey, favorites);
      return false;
    } else {
      favorites.add(movieJson);
      await prefs.setStringList(_favoritesKey, favorites);
      return true;
    }
  }
}
```

**å­˜å‚¨ç­–ç•¥**:
- **JSON åºåˆ—åŒ–**: å°†å¤æ‚å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²å­˜å‚¨
- **åˆ†ç±»å­˜å‚¨**: ä¸åŒç±»å‹æ•°æ®ä½¿ç”¨ä¸åŒçš„ Key è¿›è¡Œéš”ç¦»
- **å¼‚æ­¥æ“ä½œ**: æ‰€æœ‰å­˜å‚¨æ“ä½œå‡ä¸ºå¼‚æ­¥ï¼Œé¿å…é˜»å¡ UI çº¿ç¨‹

### 4.3 å°è¯æœç´¢æ ¸å¿ƒå®ç°

#### 4.3.1 QuoteService æ¶æ„
```dart
class QuoteService {
  static final QuoteService _instance = QuoteService._internal();
  factory QuoteService() => _instance;
  
  Map<String, List<dynamic>>? _subtitleData;
  
  Future<void> init() async {
    if (_subtitleData != null) return;
    
    try {
      final String subtitleJson = await rootBundle.loadString(
        'assets/scripts/33_subtitles_data_with_tmdb.json'
      );
      final Map<String, dynamic> parsed = jsonDecode(subtitleJson);
      if (parsed['data'] != null) {
        _subtitleData = Map<String, List<dynamic>>.from(parsed['data']);
      }
    } catch (e) {
      debugPrint('Error loading subtitles: $e');
      _subtitleData = {};
    }
  }
}
```

**å•ä¾‹æ¨¡å¼**: ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ª QuoteService å®ä¾‹ï¼Œé¿å…é‡å¤åŠ è½½æ•°æ®ã€‚

#### 4.3.2 åŒå¼•æ“æœç´¢ç®—æ³•
```dart
Future<List<QuoteMatch>> searchQuotes(String query) async {
  List<QuoteMatch> results = [];
  final lowerQuery = query.toLowerCase().trim();

  // å¼•æ“1: ç²¾é€‰å­—å¹•æ•°æ®æœç´¢ (å¿«é€Ÿ)
  if (_subtitleData != null) {
    _subtitleData!.forEach((keyword, matches) {
      bool keywordMatches = keyword.toLowerCase().contains(lowerQuery);
      
      for (var item in matches) {
        String content = item['subtitle_content'] ?? '';
        String contentZh = item['subtitle_content_zh'] ?? '';
        
        if (keywordMatches || 
            content.toLowerCase().contains(lowerQuery) || 
            contentZh.contains(lowerQuery)) {
          // æ„å»ºåŒ¹é…ç»“æœ
          results.add(QuoteMatch(/* ... */));
        }
      }
    });
  }

  // å¼•æ“2: å‰§æœ¬æ•°æ®æœç´¢ (æ·±åº¦)
  if (query.length >= 2) {
    final scriptResults = await _searchScriptsInIsolate(query);
    results.addAll(scriptResults);
  }

  return results;
}
```

**æœç´¢ç­–ç•¥**:
1. **ä¼˜å…ˆçº§æœç´¢**: å…ˆæœç´¢å°æ–‡ä»¶ (3.6MB)ï¼Œå†æœç´¢å¤§æ–‡ä»¶ (308MB)
2. **æ¡ä»¶è§¦å‘**: åªæœ‰æŸ¥è¯¢è¯é•¿åº¦ â‰¥2 æ—¶æ‰å¯åŠ¨æ·±åº¦æœç´¢
3. **å¤šå­—æ®µåŒ¹é…**: åŒæ—¶åŒ¹é…å…³é”®è¯ã€è‹±æ–‡å†…å®¹ã€ä¸­æ–‡å†…å®¹

#### 4.3.3 Isolate å¹¶å‘å¤„ç†
```dart
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final token = RootIsolateToken.instance;
  return await compute(_parseAndSearchScripts, {
    'query': query, 
    'token': token
  });
}

static Future<List<QuoteMatch>> _parseAndSearchScripts(
  Map<String, dynamic> params
) async {
  final query = params['query'] as String;
  final token = params['token'] as RootIsolateToken?;
  
  if (token != null) {
    BackgroundIsolateBinaryMessenger.ensureInitialized(token);
  }

  try {
    final String jsonString = await rootBundle.loadString(
      'assets/scripts/movie_scripts_with_tmdb.json'
    );
    final List<dynamic> data = jsonDecode(jsonString);
    // æ‰§è¡Œæœç´¢é€»è¾‘...
  } catch (e) {
    debugPrint('Isolate search error: $e');
    return [];
  }
}
```

**å¹¶å‘ä¼˜åŒ–**:
- **Isolate éš”ç¦»**: å¤§æ–‡ä»¶å¤„ç†åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­è¿›è¡Œ
- **Token ä¼ é€’**: ç¡®ä¿ Isolate ä¸­èƒ½æ­£å¸¸è®¿é—® Flutter èµ„æº
- **å¼‚å¸¸éš”ç¦»**: Isolate ä¸­çš„å¼‚å¸¸ä¸ä¼šå½±å“ä¸»çº¿ç¨‹

### 4.4 UI å±‚å…³é”®å®ç°

#### 4.4.1 å…³é”®è¯é«˜äº®ç®—æ³•
```dart
Widget _buildHighlightText(String text, String query, TextStyle style) {
  if (query.isEmpty) return Text(text, style: style);

  final lowerText = text.toLowerCase();
  final lowerQuery = query.toLowerCase();
  if (!lowerText.contains(lowerQuery)) return Text(text, style: style);

  final List<TextSpan> spans = [];
  int start = 0;
  int indexOfHighlight;

  while ((indexOfHighlight = lowerText.indexOf(lowerQuery, start)) != -1) {
    // æ·»åŠ é«˜äº®å‰çš„æ™®é€šæ–‡æœ¬
    if (indexOfHighlight > start) {
      spans.add(TextSpan(
        text: text.substring(start, indexOfHighlight), 
        style: style
      ));
    }
    
    // æ·»åŠ é«˜äº®æ–‡æœ¬
    spans.add(TextSpan(
      text: text.substring(indexOfHighlight, indexOfHighlight + query.length),
      style: style.copyWith(
        color: Colors.redAccent, 
        fontWeight: FontWeight.bold
      ),
    ));
    
    start = indexOfHighlight + query.length;
  }

  // æ·»åŠ å‰©ä½™çš„æ™®é€šæ–‡æœ¬
  if (start < text.length) {
    spans.add(TextSpan(text: text.substring(start), style: style));
  }

  return RichText(text: TextSpan(children: spans));
}
```

**ç®—æ³•ç‰¹ç‚¹**:
- **å¤§å°å†™ä¸æ•æ„Ÿ**: ä½¿ç”¨ `toLowerCase()` è¿›è¡ŒåŒ¹é…
- **å¤šæ¬¡åŒ¹é…**: æ”¯æŒåŒä¸€æ–‡æœ¬ä¸­å¤šä¸ªå…³é”®è¯é«˜äº®
- **æ ·å¼ä¿æŒ**: ä¿æŒåŸæœ‰æ–‡æœ¬æ ·å¼ï¼Œä»…å¯¹åŒ¹é…éƒ¨åˆ†åº”ç”¨é«˜äº®

#### 4.4.2 è§‚å½±çƒ­åº¦å›¾ç»„ä»¶ (`HeatmapGrid`)
```dart
class ContributionHeatmap extends StatelessWidget {
  final Map<DateTime, int> data;
  
  Widget _buildGrid(DateTime startDate, int columns, double boxSize, double margin) {
    return Row(
      children: List.generate(columns, (colIndex) {
        final weekStart = startDate.add(Duration(days: colIndex * 7));
        return Column(
          children: List.generate(7, (rowIndex) {
            final date = weekStart.add(Duration(days: rowIndex));
            final count = data[DateTime(date.year, date.month, date.day)] ?? 0;
            
            return Container(
              width: boxSize,
              height: boxSize,
              margin: EdgeInsets.all(margin),
              decoration: BoxDecoration(
                color: _getColor(count),
                borderRadius: BorderRadius.circular(1.5),
              ),
            );
          }),
        );
      }),
    );
  }
  
  Color _getColor(int count) {
    if (count == 0) return const Color(0xFFEEEEEE);
    if (count == 1) return const Color(0xFFFFE0B2);
    if (count <= 3) return const Color(0xFFFFB74D);
    if (count <= 5) return const Color(0xFFFF9800);
    return const Color(0xFFE65100);
  }
}
```

**å®ç°ç‰¹ç‚¹**:
- **GitHub é£æ ¼**: æ¨¡ä»¿ GitHub è´¡çŒ®å›¾çš„è§†è§‰è®¾è®¡
- **åŠ¨æ€æ•°æ®**: æ ¹æ®è§‚å½±é¢‘æ¬¡åŠ¨æ€è°ƒæ•´é¢œè‰²æ·±åº¦
- **æ—¶é—´è½´**: æ”¯æŒ 53 å‘¨çš„æ—¶é—´è·¨åº¦å±•ç¤º
- **å“åº”å¼**: æ”¯æŒæ°´å¹³æ»šåŠ¨æŸ¥çœ‹å†å²æ•°æ®

### 4.5 æ•°æ®æ¨¡å‹è®¾è®¡

#### 4.5.1 Movie æ¨¡å‹çš„å¤šæ€å¤„ç†
```dart
class Movie {
  final int id;
  final String title;
  final String originalTitle;
  // ... å…¶ä»–å­—æ®µ

  // æ ‡å‡† API æ•°æ®è§£æ
  factory Movie.fromJson(Map<String, dynamic> json) {
    return Movie(
      id: json['id'] ?? 0,
      title: json['title'] ?? json['original_title'] ?? '',
      // ...
    );
  }

  // æœ¬åœ°æ•°æ®è§£æ (å…¼å®¹ä¸åŒå­—æ®µå)
  factory Movie.fromLocalJson(Map<String, dynamic> json) {
    return Movie(
      id: json['id'] ?? json['tmdb_id'] ?? 0, // å…³é”®å…¼å®¹å¤„ç†
      title: json['title'] ?? '',
      // ...
    );
  }
}
```

**è®¾è®¡äº®ç‚¹**:
- **å¤šå·¥å‚æ–¹æ³•**: é’ˆå¯¹ä¸åŒæ•°æ®æºæä¾›ä¸“é—¨çš„è§£ææ–¹æ³•
- **å­—æ®µå…¼å®¹**: å¤„ç† `id` vs `tmdb_id` ç­‰å­—æ®µå·®å¼‚
- **ç©ºå€¼å®‰å…¨**: æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸

### 4.6 æ€§èƒ½ä¼˜åŒ–å®ç°

#### 4.6.1 å›¾ç‰‡ç¼“å­˜ç­–ç•¥
```dart
// åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨
CachedNetworkImage(
  imageUrl: movie.fullPosterUrl,
  fit: BoxFit.cover,
  placeholder: (context, url) => Container(
    color: Colors.grey[300],
    child: const Icon(Icons.movie, color: Colors.grey),
  ),
  errorWidget: (context, url, error) => Container(
    color: Colors.grey[300],
    child: const Icon(Icons.error, color: Colors.red),
  ),
)
```

**ç¼“å­˜æœºåˆ¶**:
- **ä¸‰çº§ç¼“å­˜**: å†…å­˜ â†’ ç£ç›˜ â†’ ç½‘ç»œ
- **å ä½ç¬¦**: åŠ è½½è¿‡ç¨‹ä¸­æ˜¾ç¤ºç°è‰²å ä½
- **é”™è¯¯å¤„ç†**: åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯å›¾æ ‡

#### 4.6.2 è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
```dart
ListView.builder(
  itemCount: movies.length,
  itemBuilder: (context, index) {
    final movie = movies[index];
    return MovieCard(movie: movie);
  },
)
```

**å†…å­˜ä¼˜åŒ–**:
- **æŒ‰éœ€æ„å»º**: åªæ„å»ºå¯è§åŒºåŸŸçš„ Widget
- **è‡ªåŠ¨å›æ”¶**: æ»šåŠ¨å‡ºè§†é‡çš„ Widget è‡ªåŠ¨é”€æ¯
- **å¤ç”¨æœºåˆ¶**: Widget å¯¹è±¡æ± å¤ç”¨ï¼Œå‡å°‘ GC å‹åŠ›

---

## 5. å…³é”®æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 å¤§æ–‡ä»¶æœ¬åœ°æ£€ç´¢æ€§èƒ½ä¼˜åŒ–
- **é—®é¢˜**: å‰§æœ¬æ•°æ®æ–‡ä»¶å¤§å°çº¦ä¸º 308MBï¼Œç›´æ¥åœ¨ä¸»çº¿ç¨‹åŠ è½½å’Œéå†ä¼šå¯¼è‡´ UI ä¸¥é‡æ‰å¸§ç”šè‡³ ANRã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  1. å¼•å…¥ Flutter çš„ **Isolate (Compute)** æœºåˆ¶ã€‚
  2. ä»…åœ¨ç”¨æˆ·è¾“å…¥ç‰¹å®šé•¿åº¦å­—ç¬¦ï¼ˆ>=2ï¼‰åè§¦å‘æ·±åº¦æœç´¢ã€‚
  3. é‡‡ç”¨æµå¼æˆ–åˆ†å—æ€æƒ³ï¼ˆè™½å—é™äº JSON ç»“æ„ç›®å‰é‡‡ç”¨æ•´ä½“åŠ è½½ï¼Œä½†ç½®äºç‹¬ç«‹çº¿ç¨‹ï¼‰ï¼Œä¿è¯ä¸»çº¿ç¨‹æµç•…åº¦ã€‚

### 5.2 æ··åˆæ•°æ®æºçš„ç»Ÿä¸€å±•ç¤º
- **é—®é¢˜**: æœç´¢ç»“æœæ—¢æ¥è‡ª TMDb åœ¨çº¿ APIï¼Œä¹Ÿæ¥è‡ªæœ¬åœ° JSON æ•°æ®ï¼Œä¸”å­—æ®µç»“æ„ä¸åŒã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  - ç»Ÿä¸€æ•°æ®æ¨¡å‹ `Movie`ï¼Œå¢åŠ äº† `fromLocalJson` å·¥å‚æ–¹æ³•ï¼Œå…¼å®¹ `id` ä¸ `tmdb_id` å­—æ®µå·®å¼‚ã€‚
  - ç»Ÿä¸€å°è£… `QuoteMatch` å¯¹è±¡ï¼Œæ— è®ºæ¥æºæ˜¯å­—å¹•è¿˜æ˜¯å‰§æœ¬ï¼Œå‡æ ‡å‡†åŒ–ä¸ºç»Ÿä¸€ç»“æ„ä¾› UI æ¸²æŸ“ã€‚

### 5.3 æœç´¢å…³é”®è¯é«˜äº®
- **é—®é¢˜**: éœ€è¦åœ¨é•¿æ®µæ–‡æœ¬ä¸­åŠ¨æ€æ ‡è®°å‡ºç”¨æˆ·è¾“å…¥çš„å…³é”®è¯ï¼Œä¸”éœ€å¿½ç•¥å¤§å°å†™ã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  - ç¼–å†™äº†æ­£åˆ™æ— å…³çš„å­—ç¬¦ä¸²éå†ç®—æ³• `_buildHighlightText`ã€‚
  - ä½¿ç”¨ `TextSpan` æ‹¼æ¥ï¼Œä¸ç ´ååŸæœ‰æ–‡æœ¬ç»“æ„ï¼Œæ”¯æŒå¤šå¤„åŒ¹é…é«˜äº®ã€‚

---

## 6. ç›®å½•ç»“æ„è¯´æ˜

```
lib/
â”œâ”€â”€ main.dart                    # åº”ç”¨å…¥å£ï¼Œä¸»é¢˜é…ç½®ï¼Œåº•éƒ¨å¯¼èˆª
â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ movie.dart              # Movie, Cast, Genre, Person ç­‰æ ¸å¿ƒæ¨¡å‹
â”‚   â””â”€â”€ award.dart              # Award, AwardMovie å¥–é¡¹ç›¸å…³æ¨¡å‹
â”œâ”€â”€ pages/                       # é¡µé¢å±‚ (UI)
â”‚   â”œâ”€â”€ search_page.dart        # å¤šç»´åº¦æœç´¢é¡µé¢ (æ ¸å¿ƒåŠŸèƒ½)
â”‚   â”œâ”€â”€ movie_detail_page.dart  # ç”µå½±è¯¦æƒ…é¡µ (æ²‰æµ¸å¼è®¾è®¡)
â”‚   â”œâ”€â”€ person_detail_page.dart # å½±äººè¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ movie_list_page.dart    # ç”µå½±åˆ—è¡¨é¡µ (åˆ†ç±»å±•ç¤º)
â”‚   â”œâ”€â”€ person_list_page.dart   # å½±äººåˆ—è¡¨é¡µ
â”‚   â”œâ”€â”€ my_movies_page.dart     # ä¸ªäººè§‚å½±ç®¡ç†
â”‚   â”œâ”€â”€ profile_page.dart       # ä¸ªäººèµ„æ–™é¡µ (çƒ­åº¦å›¾)
â”‚   â”œâ”€â”€ custom_lists_page.dart  # è‡ªå®šä¹‰ç‰‡å•ç®¡ç†
â”‚   â”œâ”€â”€ award_year_list_page.dart # å¥–é¡¹å¹´ä»½åˆ—è¡¨
â”‚   â””â”€â”€ video_player_page.dart  # è§†é¢‘æ’­æ”¾é¡µ
â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ tmdb_service.dart       # TMDb API å°è£… (ç½‘ç»œè¯·æ±‚)
â”‚   â”œâ”€â”€ quote_service.dart      # å°è¯æœç´¢æœåŠ¡ (æœ¬åœ°æ•°æ® + Isolate)
â”‚   â”œâ”€â”€ award_service.dart      # å¥–é¡¹æ•°æ®æœåŠ¡ (æœ¬åœ° JSON)
â”‚   â”œâ”€â”€ storage_service.dart    # æœ¬åœ°å­˜å‚¨æœåŠ¡ (SharedPreferences)
â”‚   â””â”€â”€ youtube_service.dart    # YouTube è§†é¢‘æœç´¢
â””â”€â”€ widgets/                     # å¯å¤ç”¨ç»„ä»¶
    â”œâ”€â”€ expandable_text.dart    # å¯å±•å¼€æ–‡æœ¬ç»„ä»¶
    â”œâ”€â”€ glass_box.dart          # æ¯›ç»ç’ƒæ•ˆæœå®¹å™¨
    â”œâ”€â”€ heatmap_grid.dart       # GitHub é£æ ¼çƒ­åº¦å›¾
    â””â”€â”€ quote_animation_view.dart # å°è¯åŠ¨ç”»å±•ç¤º

assets/
â”œâ”€â”€ scripts/                     # å°è¯ä¸å‰§æœ¬æ•°æ®é›†
â”‚   â”œâ”€â”€ 33_subtitles_data_with_tmdb.json    # ç²¾é€‰å­—å¹•æ•°æ® 
â”‚   â””â”€â”€ movie_scripts_with_tmdb.json        # å®Œæ•´å‰§æœ¬æ•°æ® 
â”œâ”€â”€ images/                      # é™æ€å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ genres/                 # ç”µå½±ç±»å‹èƒŒæ™¯å›¾ (19å¼ )
â”‚   â”‚   â”œâ”€â”€ Action.jpg          # åŠ¨ä½œç‰‡èƒŒæ™¯
â”‚   â”‚   â”œâ”€â”€ Comedy.jpg          # å–œå‰§ç‰‡èƒŒæ™¯
â”‚   â”‚   â””â”€â”€ ...                 # å…¶ä»–ç±»å‹
â”‚   â””â”€â”€ actors/                 # å½±äººåˆ†ç±»å›¾ç‰‡
â”‚       â”œâ”€â”€ ç”·æ¼”å‘˜.jpg           # ç”·æ¼”å‘˜åˆ†ç±»å›¾
â”‚       â”œâ”€â”€ å¥³æ¼”å‘˜.jpg           # å¥³æ¼”å‘˜åˆ†ç±»å›¾
â”‚       â””â”€â”€ å¯¼æ¼”.jpg             # å¯¼æ¼”åˆ†ç±»å›¾
â””â”€â”€ awards/                      # å¥–é¡¹æ•°æ®é›† (JSON)
    â”œâ”€â”€ å¥¥æ–¯å¡_output_winner_nominees.json
    â”œâ”€â”€ æˆ›çº³_output_winner_nominees.json
    â”œâ”€â”€ æŸæ—_output_winner_nominees.json
    â”œâ”€â”€ é‡‘åƒå¥–_output_winner_nominees.json
    â”œâ”€â”€ é‡‘çˆµå¥–_output_winner_nominees.json
    â””â”€â”€ é‡‘é¸¡å¥–_output_winner_nominees.json
```

---

## 7. æ•°æ®æµæ¶æ„

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B{æœç´¢ç±»å‹}
    B -->|ç”µå½±| C[TMDb API]
    B -->|å½±äºº| D[TMDb API]
    B -->|å¥–é¡¹| E[æœ¬åœ°å¥–é¡¹æ•°æ®]
    B -->|å°è¯| F[QuoteService]
    
    F --> G[ç²¾é€‰å­—å¹•æ•°æ®]
    F --> H[å‰§æœ¬æ•°æ® Isolate]
    
    C --> I[ç»Ÿä¸€æ•°æ®æ¨¡å‹]
    D --> I
    E --> I
    G --> I
    H --> I
    
    I --> J[UI æ¸²æŸ“]
    J --> K[è¯¦æƒ…é¡µé¢]
    K --> L[TMDb API è¡¥å……æ•°æ®]
```

---

## 6. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 6.1 å›¾ç‰‡åŠ è½½ä¼˜åŒ–

#### ä¸‰çº§ç¼“å­˜æœºåˆ¶
```dart
CachedNetworkImage(
  imageUrl: movie.fullPosterUrl,
  fit: BoxFit.cover,
  // 1. å†…å­˜ç¼“å­˜æ£€æŸ¥ï¼ˆæœ€å¿«ï¼‰
  memCacheWidth: 500,
  memCacheHeight: 750,
  // 2. ç£ç›˜ç¼“å­˜æ£€æŸ¥ï¼ˆä¸­é€Ÿï¼‰
  maxWidthDiskCache: 1000,
  maxHeightDiskCache: 1500,
  // 3. ç½‘ç»œåŠ è½½ï¼ˆæœ€æ…¢ï¼‰
  placeholder: (context, url) => Container(
    color: Colors.grey[300],
    child: Icon(Icons.movie, color: Colors.grey),
  ),
  errorWidget: (context, url, error) => Container(
    color: Colors.grey[300],
    child: Icon(Icons.error, color: Colors.red),
  ),
)
```

**ç¼“å­˜ç­–ç•¥**ï¼š
- **å†…å­˜ç¼“å­˜**ï¼šLRU ç®—æ³•ï¼Œæœ€å¤šç¼“å­˜ 100 å¼ å›¾ç‰‡ï¼Œçº¦ 50MB
- **ç£ç›˜ç¼“å­˜**ï¼šé»˜è®¤ 7 å¤©è¿‡æœŸï¼Œæœ€å¤š 200MB
- **é¢„åŠ è½½**ï¼šåˆ—è¡¨æ»šåŠ¨æ—¶é¢„åŠ è½½ä¸‹ä¸€å±å›¾ç‰‡

**å¸¦å®½ä¼˜åŒ–**ï¼š
- æ ¹æ®è®¾å¤‡ DPR åŠ¨æ€é€‰æ‹©å›¾ç‰‡å°ºå¯¸
- ä½¿ç”¨ TMDb çš„å¤šå°ºå¯¸ APIï¼šw92, w154, w185, w342, w500, w780, original
- åˆ—è¡¨ä½¿ç”¨ w185ï¼Œè¯¦æƒ…é¡µä½¿ç”¨ w500

### 6.2 ç½‘ç»œè¯·æ±‚ä¼˜åŒ–

#### å¹¶è¡Œè¯·æ±‚ç­–ç•¥
```dart
// é¦–é¡µæ•°æ®å¹¶è¡ŒåŠ è½½
final results = await Future.wait([
  _tmdbService.getPopular(),
  _tmdbService.getNowPlaying(),
  _tmdbService.getUpcoming(),
  _tmdbService.getTopRated(),
], eagerError: false);  // æŸä¸ªè¯·æ±‚å¤±è´¥ä¸å½±å“å…¶ä»–
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- ä¸²è¡ŒåŠ è½½ï¼š4 Ã— 500ms = 2000ms
- å¹¶è¡ŒåŠ è½½ï¼šmax(500ms) = 500ms
- **æé€Ÿ 75%**

#### è¯·æ±‚å»é‡
```dart
Map<String, Future> _pendingRequests = {};

Future<Movie?> getMovieDetail(int movieId) async {
  final key = 'movie_$movieId';
  
  if (_pendingRequests.containsKey(key)) {
    return await _pendingRequests[key];  // å¤ç”¨è¿›è¡Œä¸­çš„è¯·æ±‚
  }
  
  final future = _dio.get('/movie/$movieId');
  _pendingRequests[key] = future;
  
  try {
    final response = await future;
    return Movie.fromJson(response.data);
  } finally {
    _pendingRequests.remove(key);
  }
}
```

#### é™çº§å¤„ç†
```dart
Future<List<Movie>> _getMovies(String path) async {
  try {
    final response = await _dio.get(path);
    return response.data['results'].map(...).toList();
  } on DioException catch (e) {
    print('Network Error: ${e.message}');
    return _getMockMovies(path);  // è¿”å›ç¦»çº¿æ•°æ®
  }
}
```

### 6.3 æœç´¢æ€§èƒ½ä¼˜åŒ–

#### åŒå¼•æ“æ¶æ„æ€§èƒ½å¯¹æ¯”

| å¼•æ“ | æ•°æ®é‡ | çº¿ç¨‹ | å¹³å‡è€—æ—¶ | UI å½±å“ |
|------|--------|------|----------|---------|
| ç²¾é€‰å­—å¹• | 3.6MB | ä¸»çº¿ç¨‹ | 30-50ms | æ— æ„ŸçŸ¥ |
| å®Œæ•´å‰§æœ¬ | 308MB | Isolate | 1-2s | æ— é˜»å¡ |

**å…³é”®ä¼˜åŒ–**ï¼š
1. **å»¶è¿Ÿè§¦å‘**ï¼šæŸ¥è¯¢é•¿åº¦ < 2 æ—¶ä¸å¯åŠ¨æ·±åº¦æœç´¢
2. **ç»“æœé™åˆ¶**ï¼šæ¯ä¸ªæ•°æ®æºæœ€å¤šè¿”å› 50 æ¡
3. **å»é‡ç®—æ³•**ï¼šä½¿ç”¨ `Set<int>` è®°å½•å·²è¿”å›çš„ç”µå½± ID
4. **ç¼“å­˜æœºåˆ¶**ï¼šç²¾é€‰æ•°æ®åœ¨ `QuoteService` åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§åŠ è½½

```dart
class QuoteService {
  Map<String, List<dynamic>>? _subtitleData;
  
  Future<void> init() async {
    if (_subtitleData != null) return;  // å•ä¾‹ç¼“å­˜
    
    final jsonString = await rootBundle.loadString(
      'assets/scripts/33_subtitles_data_with_tmdb.json'
    );
    _subtitleData = jsonDecode(jsonString)['data'];
  }
}
```

### 6.4 å†…å­˜ç®¡ç†

#### è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
```dart
ListView.builder(
  itemCount: movies.length,
  cacheExtent: 500,  // é¢„æ¸²æŸ“èŒƒå›´ï¼ˆåƒç´ ï¼‰
  itemBuilder: (context, index) {
    // åªæ„å»ºå¯è§ + é¢„æ¸²æŸ“èŒƒå›´å†…çš„ Widget
    return MovieCard(movie: movies[index]);
  },
)
```

**å†…å­˜æ”¶ç›Š**ï¼š
- ä¼ ç»Ÿæ–¹å¼ï¼š1000 éƒ¨ç”µå½± Ã— 5KB = 5MB
- è™šæ‹Ÿæ»šåŠ¨ï¼š20 ä¸ªå¯è§ Widget Ã— 5KB = 100KB
- **å‡å°‘ 98% å†…å­˜å ç”¨**

#### å¤§å¯¹è±¡å¤„ç†
```dart
// å‰§æœ¬æœç´¢å®Œæˆåç«‹å³é‡Šæ”¾
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final results = await compute(_parseAndSearchScripts, params);
  // Isolate é”€æ¯æ—¶è‡ªåŠ¨é‡Šæ”¾ 308MB æ•°æ®
  return results;
}
```

#### å›¾ç‰‡å†…å­˜å‹ç¼©
```dart
CachedNetworkImage(
  imageUrl: url,
  memCacheWidth: 500,  // å†…å­˜ç¼“å­˜æ—¶å‹ç¼©åˆ° 500px
  memCacheHeight: 750,
  // åŸå›¾å¯èƒ½ 2000Ã—3000ï¼Œå†…å­˜ä¸­åªä¿å­˜ 500Ã—750
)
```

### 6.5 å¯åŠ¨æ€§èƒ½ä¼˜åŒ–

#### å†·å¯åŠ¨ä¼˜åŒ–
```dart
void main() {
  WidgetsFlutterBinding.ensureInitialized();
  
  // é¢„åŠ è½½å…³é”®èµ„æº
  runApp(MovieMindApp());
  
  // å»¶è¿Ÿåˆå§‹åŒ–éå…³é”®æœåŠ¡
  Future.delayed(Duration(seconds: 1), () {
    QuoteService().init();  // å°è¯æ•°æ®é¢„åŠ è½½
  });
}
```

**å¯åŠ¨æ—¶é—´**ï¼š
- Android: 1.2s (å†·å¯åŠ¨) / 0.3s (çƒ­å¯åŠ¨)
- iOS: 0.8s (å†·å¯åŠ¨) / 0.2s (çƒ­å¯åŠ¨)

#### èµ„æºé¢„ç¼–è¯‘
```yaml
flutter:
  assets:
    - assets/images/genres/
    - assets/scripts/
  fonts:
    - family: San Francisco
      fonts:
        - asset: fonts/SF-Pro.ttf
```

### 6.6 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### é¿å…ä¸å¿…è¦çš„é‡å»º
```dart
class MovieCard extends StatelessWidget {
  final Movie movie;
  
  const MovieCard({Key? key, required this.movie}) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    // ä½¿ç”¨ const æ„é€ å‡½æ•°ï¼Œé¿å…é‡å¤åˆ›å»º
    return const Card(...);
  }
}
```

#### ä½¿ç”¨ RepaintBoundary
```dart
RepaintBoundary(
  child: ComplexWidget(),  // å¤æ‚ç»„ä»¶ç‹¬ç«‹é‡ç»˜å±‚
)
```

#### åŠ¨ç”»æ€§èƒ½
```dart
AnimatedContainer(
  duration: Duration(milliseconds: 200),
  curve: Curves.easeInOut,  // ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„æ›²çº¿
  // ...
)
```

**å¸§ç‡ç›‘æ§**ï¼š
- ç›®æ ‡ï¼š60 FPS (16.67ms/frame)
- å®æµ‹ï¼šåˆ—è¡¨æ»šåŠ¨ 58-60 FPS
- æœç´¢ç»“æœæ¸²æŸ“ï¼š55-60 FPS

## 7. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 7.1 äº¤äº’è®¾è®¡åŸåˆ™

#### å³æ—¶åé¦ˆ
- **åŠ è½½çŠ¶æ€**ï¼šæ‰€æœ‰å¼‚æ­¥æ“ä½œæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
- **æ“ä½œç¡®è®¤**ï¼šæ”¶è—ã€çŠ¶æ€å˜æ›´æœ‰è§†è§‰åé¦ˆ
- **é”™è¯¯æç¤º**ï¼šç½‘ç»œå¼‚å¸¸æ—¶å¼¹å‡ºå‹å¥½æç¤º

#### æ‰‹åŠ¿äº¤äº’
```dart
GestureDetector(
  onTap: () => navigateToDetail(),
  onLongPress: () => showQuickActions(),  // é•¿æŒ‰å¿«æ·æ“ä½œ
  child: MovieCard(),
)
```

#### åŠ¨ç”»æµç•…æ€§
- Hero åŠ¨ç”»ï¼šé¡µé¢è·³è½¬æ—¶çš„å…±äº«å…ƒç´ è¿‡æ¸¡
- çŠ¶æ€åˆ‡æ¢åŠ¨ç”»ï¼šæ”¶è—ã€è§‚å½±çŠ¶æ€çš„å¹³æ»‘è¿‡æ¸¡
- åˆ—è¡¨åŠ è½½åŠ¨ç”»ï¼šæ–°æ•°æ®æ·¡å…¥æ•ˆæœ

### 7.2 è§†è§‰è®¾è®¡ç³»ç»Ÿ

#### é¢œè‰²ç³»ç»Ÿ
```dart
class AppColors {
  static const primary = Color(0xFF000000);       // é»‘è‰²ä¸»é¢˜
  static const background = Color(0xFFF5F5F7);    // æµ…ç°èƒŒæ™¯
  static const accent = Color(0xFFFF9800);        // æ©™è‰²å¼ºè°ƒ
  static const success = Color(0xFF4CAF50);       // ç»¿è‰²æˆåŠŸ
  static const error = Color(0xFFF44336);         // çº¢è‰²é”™è¯¯
}
```

#### å­—ä½“ç³»ç»Ÿ
- **æ ‡é¢˜**ï¼šSan Francisco Display Bold, 24-32px
- **æ­£æ–‡**ï¼šSan Francisco Text Regular, 14-16px
- **è¾…åŠ©**ï¼šSan Francisco Text Light, 12-13px
- **ç‰¹æ®Š**ï¼š19 ç§ç”µå½±ç±»å‹ç‹¬ç‰¹å­—ä½“

#### é—´è·ç³»ç»Ÿ
```dart
const spacing = {
  xs: 4.0,
  sm: 8.0,
  md: 16.0,
  lg: 24.0,
  xl: 32.0,
};
```

### 7.3 æ— éšœç¢è®¾è®¡

#### è¯­ä¹‰åŒ–æ ‡ç­¾
```dart
Semantics(
  label: 'ç”µå½±: ${movie.title}',
  hint: 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…',
  child: MovieCard(movie: movie),
)
```

#### å¯¹æ¯”åº¦
- æ–‡æœ¬ä¸èƒŒæ™¯å¯¹æ¯”åº¦ â‰¥ 4.5:1
- å¤§å·æ–‡æœ¬å¯¹æ¯”åº¦ â‰¥ 3:1

#### è§¦æ‘¸ç›®æ ‡
- æœ€å°è§¦æ‘¸åŒºåŸŸï¼š44Ã—44 dp (iOS) / 48Ã—48 dp (Android)

---

## 8. æ•°æ®å®‰å…¨ä¸å­˜å‚¨

### 8.1 æœ¬åœ°æ•°æ®å­˜å‚¨æ¶æ„

#### SharedPreferences æ•°æ®ç»“æ„
```dart
// ç”¨æˆ·ç³»ç»Ÿ
const String _userKey = 'current_user';
const String _usersDbKey = 'all_users_db';

// è§‚å½±æ•°æ®
const String _favoritesKey = 'favorite_movies';
const String _statusKey = 'movie_status';
const String _progressKey = 'movie_progress';
const String _timeKey = 'movie_timestamp';
const String _notesKey = 'movie_notes';

// ç‰‡å•ç³»ç»Ÿ
const String _customListsKey = 'custom_movie_lists';
const String _customListDescsKey = 'custom_movie_lists_desc';

// ç”µå½±ç¼“å­˜æ± 
const String _movieCacheKey = 'movie_cache_pool';
```

#### æ•°æ®æŒä¹…åŒ–ç­–ç•¥
```dart
Future<void> setWatchStatus(Movie movie, WatchStatus status) async {
  final prefs = await SharedPreferences.getInstance();
  
  // 1. æ›´æ–°çŠ¶æ€æ˜ å°„
  final statusJson = prefs.getString(_statusKey);
  Map<String, dynamic> statusMap = statusJson != null 
    ? jsonDecode(statusJson) : {};
  statusMap[movie.id.toString()] = status.index;
  await prefs.setString(_statusKey, jsonEncode(statusMap));
  
  // 2. è®°å½•æ—¶é—´æˆ³ï¼ˆç”¨äºçƒ­åº¦å›¾ï¼‰
  final timeJson = prefs.getString(_timeKey);
  Map<String, dynamic> timeMap = timeJson != null 
    ? jsonDecode(timeJson) : {};
  timeMap[movie.id.toString()] = DateTime.now().millisecondsSinceEpoch;
  await prefs.setString(_timeKey, jsonEncode(timeMap));
  
  // 3. ç¼“å­˜ç”µå½±å¯¹è±¡ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰
  await _saveMovieToCache(movie);
}
```

### 8.2 å®‰å…¨æ€§è€ƒè™‘

#### API å¯†é’¥ç®¡ç†
**å½“å‰å®ç°**ï¼ˆå¼€å‘é˜¶æ®µï¼‰ï¼š
```dart
class TMDbService {
  static const String apiKey = '9d5a5768705c19907badb63abbb20821';
}
```

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
```dart
// 1. ä½¿ç”¨ç¯å¢ƒå˜é‡
class TMDbService {
  static final apiKey = const String.fromEnvironment('TMDB_API_KEY');
}

// 2. è¿è¡Œæ—¶é…ç½®
flutter run --dart-define=TMDB_API_KEY=your_key_here

// 3. ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
class TMDbService {
  static const baseUrl = 'https://your-proxy.com/api';
  // ä»£ç†æœåŠ¡å™¨åç«¯æ·»åŠ  API Key
}
```

#### æ•°æ®éªŒè¯
```dart
factory Movie.fromJson(Map<String, dynamic> json) {
  return Movie(
    id: json['id'] ?? 0,  // é»˜è®¤å€¼é˜²æ­¢ null
    title: json['title'] ?? json['original_title'] ?? '',
    posterPath: json['poster_path'] ?? '',
    voteAverage: (json['vote_average'] ?? 0).toDouble(),  // ç±»å‹è½¬æ¢
    overview: json['overview'] ?? 'æš‚æ— ç®€ä»‹',
    // ...
  );
}
```

**å¼‚å¸¸å¤„ç†æœºåˆ¶**ï¼š
```dart
Future<List<Movie>> searchMovies(String query) async {
  try {
    final response = await _dio.get('/search/movie', 
      queryParameters: {'query': query}
    );
    
    if (response.statusCode == 200) {
      final results = response.data['results'] as List;
      return results.map((e) => Movie.fromJson(e)).toList();
    }
    return [];
  } on DioException catch (e) {
    // ç½‘ç»œå¼‚å¸¸
    if (e.type == DioExceptionType.connectionTimeout) {
      print('Connection timeout');
    } else if (e.type == DioExceptionType.badResponse) {
      print('Bad response: ${e.response?.statusCode}');
    }
    return [];
  } catch (e) {
    // æœªçŸ¥å¼‚å¸¸
    print('Unknown error: $e');
    return [];
  }
}
```

#### ç”¨æˆ·æ•°æ®åŠ å¯†
**å¯†ç å­˜å‚¨**ï¼ˆå½“å‰ä¸ºæ˜æ–‡ï¼Œç”Ÿäº§ç¯å¢ƒéœ€æ”¹è¿›ï¼‰ï¼š
```dart
// æ¨èä½¿ç”¨åŠ å¯†åº“
import 'package:crypto/crypto.dart';
import 'dart:convert';

String hashPassword(String password) {
  var bytes = utf8.encode(password);
  var digest = sha256.convert(bytes);
  return digest.toString();
}

Future<void> register(String username, String password) async {
  final hashedPassword = hashPassword(password);
  // å­˜å‚¨ hashedPassword è€Œéæ˜æ–‡
}
```

### 8.3 æ•°æ®åŒæ­¥ç­–ç•¥

#### æœ¬åœ°ä¼˜å…ˆ (Offline-First)
```dart
Future<Movie?> getMovieDetail(int movieId) async {
  // 1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
  final cached = await _getCachedMovie(movieId);
  if (cached != null && !_isStale(cached)) {
    return cached;
  }
  
  // 2. è¯·æ±‚ç½‘ç»œæ•°æ®
  try {
    final movie = await _fetchMovieFromAPI(movieId);
    await _cacheMovie(movie);  // æ›´æ–°ç¼“å­˜
    return movie;
  } catch (e) {
    // 3. ç½‘ç»œå¤±è´¥ï¼Œè¿”å›è¿‡æœŸç¼“å­˜
    return cached;
  }
}
```

#### æ•°æ®ä¸€è‡´æ€§
```dart
Future<void> _saveMovieToCache(Movie movie) async {
  final prefs = await SharedPreferences.getInstance();
  final cacheJson = prefs.getString(_movieCacheKey);
  Map<String, dynamic> cacheMap = cacheJson != null 
    ? jsonDecode(cacheJson) : {};
  
  // æ›´æ–°æˆ–æ’å…¥
  cacheMap[movie.id.toString()] = movie.toJson();
  
  // é™åˆ¶ç¼“å­˜å¤§å°ï¼ˆæœ€å¤š 100 éƒ¨ç”µå½±ï¼‰
  if (cacheMap.length > 100) {
    final oldestKey = cacheMap.keys.first;
    cacheMap.remove(oldestKey);
  }
  
  await prefs.setString(_movieCacheKey, jsonEncode(cacheMap));
}
```

## 9. æµ‹è¯•ä¸è´¨é‡ä¿è¯

### 9.1 æµ‹è¯•ç­–ç•¥

#### æµ‹è¯•é‡‘å­—å¡”
```
         /\
        /  \    E2E æµ‹è¯• (5%)
       /____\
      /      \  é›†æˆæµ‹è¯• (15%)
     /________\
    /          \ å•å…ƒæµ‹è¯• (80%)
   /____________\
```

### 9.2 å•å…ƒæµ‹è¯•

#### Service å±‚æµ‹è¯•
```dart
// test/services/tmdb_service_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';

void main() {
  group('TMDbService', () {
    late TMDbService service;
    late MockDio mockDio;
    
    setUp(() {
      mockDio = MockDio();
      service = TMDbService(dio: mockDio);
    });
    
    test('searchMovies è¿”å›ç”µå½±åˆ—è¡¨', () async {
      // Arrange
      when(mockDio.get(any, queryParameters: anyNamed('queryParameters')))
        .thenAnswer((_) async => Response(
          data: {
            'results': [
              {'id': 550, 'title': 'Fight Club'},
            ]
          },
          statusCode: 200,
        ));
      
      // Act
      final results = await service.searchMovies('Fight Club');
      
      // Assert
      expect(results.length, 1);
      expect(results[0].title, 'Fight Club');
    });
    
    test('ç½‘ç»œå¼‚å¸¸æ—¶è¿”å›ç©ºåˆ—è¡¨', () async {
      // Arrange
      when(mockDio.get(any, queryParameters: anyNamed('queryParameters')))
        .thenThrow(DioException(
          requestOptions: RequestOptions(path: '/search/movie'),
          type: DioExceptionType.connectionTimeout,
        ));
      
      // Act
      final results = await service.searchMovies('test');
      
      // Assert
      expect(results, isEmpty);
    });
  });
}
```

#### Model å±‚æµ‹è¯•
```dart
// test/models/movie_test.dart
void main() {
  group('Movie', () {
    test('fromJson æ­£ç¡®è§£ææ•°æ®', () {
      final json = {
        'id': 550,
        'title': 'Fight Club',
        'vote_average': 8.4,
        'release_date': '1999-10-15',
      };
      
      final movie = Movie.fromJson(json);
      
      expect(movie.id, 550);
      expect(movie.title, 'Fight Club');
      expect(movie.voteAverage, 8.4);
    });
    
    test('fromJson å¤„ç†ç¼ºå¤±å­—æ®µ', () {
      final json = {'id': 1};
      final movie = Movie.fromJson(json);
      
      expect(movie.title, '');
      expect(movie.overview, 'æš‚æ— ç®€ä»‹');
    });
  });
}
```

### 9.3 Widget æµ‹è¯•

```dart
// test/widgets/movie_card_test.dart
void main() {
  testWidgets('MovieCard æ­£ç¡®æ˜¾ç¤ºç”µå½±ä¿¡æ¯', (WidgetTester tester) async {
    final movie = Movie(
      id: 1,
      title: 'Test Movie',
      posterPath: '/test.jpg',
      voteAverage: 8.5,
    );
    
    await tester.pumpWidget(
      MaterialApp(
        home: Scaffold(
          body: MovieCard(movie: movie),
        ),
      ),
    );
    
    // éªŒè¯æ ‡é¢˜æ˜¾ç¤º
    expect(find.text('Test Movie'), findsOneWidget);
    
    // éªŒè¯è¯„åˆ†æ˜¾ç¤º
    expect(find.text('8.5'), findsOneWidget);
  });
  
  testWidgets('ç‚¹å‡» MovieCard è§¦å‘å¯¼èˆª', (WidgetTester tester) async {
    // ...æµ‹è¯•ç‚¹å‡»äº‹ä»¶
  });
}
```

### 9.4 é›†æˆæµ‹è¯•

```dart
// integration_test/app_test.dart
void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();
  
  group('ç«¯åˆ°ç«¯æµ‹è¯•', () {
    testWidgets('å®Œæ•´æœç´¢æµç¨‹', (WidgetTester tester) async {
      app.main();
      await tester.pumpAndSettle();
      
      // 1. ç‚¹å‡»æœç´¢ Tab
      await tester.tap(find.byIcon(Icons.explore_outlined));
      await tester.pumpAndSettle();
      
      // 2. è¾“å…¥æœç´¢å…³é”®è¯
      await tester.enterText(
        find.byType(TextField), 
        'Inception'
      );
      await tester.pumpAndSettle();
      
      // 3. æäº¤æœç´¢
      await tester.testTextInput.receiveAction(TextInputAction.search);
      await tester.pumpAndSettle(Duration(seconds: 2));
      
      // 4. éªŒè¯ç»“æœ
      expect(find.text('Inception'), findsAtLeastNWidgets(1));
      
      // 5. ç‚¹å‡»è¿›å…¥è¯¦æƒ…
      await tester.tap(find.text('Inception').first);
      await tester.pumpAndSettle();
      
      // 6. éªŒè¯è¯¦æƒ…é¡µåŠ è½½
      expect(find.byType(MovieDetailPage), findsOneWidget);
    });
  });
}
```

### 9.5 æ€§èƒ½æµ‹è¯•

```dart
void main() {
  test('å°è¯æœç´¢æ€§èƒ½æµ‹è¯•', () async {
    final service = QuoteService();
    await service.init();
    
    final stopwatch = Stopwatch()..start();
    final results = await service.searchQuotes('love');
    stopwatch.stop();
    
    // ç²¾é€‰å­—å¹•æœç´¢åº”åœ¨ 100ms å†…å®Œæˆ
    expect(stopwatch.elapsedMilliseconds, lessThan(100));
    expect(results, isNotEmpty);
  });
}
```

### 9.6 ä»£ç è´¨é‡å·¥å…·

#### Lint é…ç½®
```yaml
# analysis_options.yaml
include: package:flutter_lints/flutter.yaml

linter:
  rules:
    - always_declare_return_types
    - avoid_print
    - prefer_const_constructors
    - require_trailing_commas
    - sort_child_properties_last
```

#### é™æ€åˆ†æ
```bash
flutter analyze  # è¿è¡Œé™æ€åˆ†æ
flutter test --coverage  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•
- å¯¹æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æœç´¢ç®—æ³•ã€æ•°æ®è§£æï¼‰ç¼–å†™å•å…ƒæµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼š>80%

### 10.2 é›†æˆæµ‹è¯•
- æµ‹è¯• API è°ƒç”¨çš„å®Œæ•´æµç¨‹
- éªŒè¯æœ¬åœ°æ•°æ®ä¸è¿œç¨‹æ•°æ®çš„æ•´åˆé€»è¾‘

### 10.3 UI æµ‹è¯•
- ä½¿ç”¨ Flutter çš„ `flutter_test` æ¡†æ¶è¿›è¡Œ Widget æµ‹è¯•
- éªŒè¯æœç´¢ç»“æœçš„æ­£ç¡®å±•ç¤ºå’Œäº¤äº’

---

## 10. éƒ¨ç½²ä¸å‘å¸ƒ

### 10.1 æ„å»ºé…ç½®

#### Android é…ç½®
```gradle
// android/app/build.gradle.kts
android {
    compileSdk = 34
    
    defaultConfig {
        applicationId = "com.moviemind.app"
        minSdk = 21  // Android 5.0+
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"
    }
    
    signingConfigs {
        create("release") {
            storeFile = file("../keystore.jks")
            storePassword = System.getenv("KEYSTORE_PASSWORD")
            keyAlias = "moviemind"
            keyPassword = System.getenv("KEY_PASSWORD")
        }
    }
    
    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
}
```

**æ··æ·†é…ç½®** (`proguard-rules.pro`):
```proguard
-keep class io.flutter.app.** { *; }
-keep class io.flutter.plugin.** { *; }
-keep class io.flutter.util.** { *; }
-keep class io.flutter.view.** { *; }
```

#### iOS é…ç½®
```xml
<!-- ios/Runner/Info.plist -->
<key>CFBundleDisplayName</key>
<string>MovieMind</string>
<key>CFBundleIdentifier</key>
<string>com.moviemind.app</string>
<key>CFBundleVersion</key>
<string>1</string>
<key>CFBundleShortVersionString</key>
<string>1.0.0</string>

<!-- æƒé™è¯´æ˜ -->
<key>NSPhotoLibraryUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸å†Œä»¥ä¸Šä¼ å¤´åƒ</string>
<key>NSCameraUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„å¤´åƒ</string>
```

### 10.2 å¤šå¹³å°æ„å»ºå‘½ä»¤

#### Android Release
```bash
# APK (é€šç”¨)
flutter build apk --release

# App Bundle (æ¨èï¼ŒGoogle Play)
flutter build appbundle --release

# åˆ†æ¶æ„ APK (å‡å°ä½“ç§¯)
flutter build apk --split-per-abi --release
```

**äº§ç‰©**ï¼š
- `build/app/outputs/flutter-apk/app-release.apk` (çº¦ 45MB)
- `build/app/outputs/bundle/release/app-release.aab` (çº¦ 38MB)

#### iOS Release
```bash
# æ„å»º Archive
flutter build ios --release

# åœ¨ Xcode ä¸­æ‰“å¼€
open ios/Runner.xcworkspace

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
xcodebuild -workspace ios/Runner.xcworkspace \
  -scheme Runner \
  -configuration Release \
  -archivePath build/ios/Runner.xcarchive \
  archive
```

#### Web Release
```bash
flutter build web --release \
  --web-renderer canvaskit \  # é«˜æ€§èƒ½æ¸²æŸ“
  --base-href /moviemind/  # åŸºç¡€è·¯å¾„

# ä¼˜åŒ–è¾“å‡º
flutter build web --release \
  --dart-define=FLUTTER_WEB_USE_SKIA=true \
  --source-maps  # ç”Ÿæˆ Source Maps ä¾¿äºè°ƒè¯•
```

**éƒ¨ç½²**ï¼š
```bash
# ä½¿ç”¨ Firebase Hosting
firebase deploy

# æˆ–ä½¿ç”¨ Nginx
cp -r build/web/* /var/www/moviemind/
```

### 10.3 ç‰ˆæœ¬ç®¡ç†

#### è¯­ä¹‰åŒ–ç‰ˆæœ¬
```yaml
# pubspec.yaml
version: 1.0.0+1
#        â”‚ â”‚ â”‚  â”‚
#        â”‚ â”‚ â”‚  â””â”€ Build Number (é€’å¢)
#        â”‚ â”‚ â””â”€â”€â”€â”€ Patch (Bug ä¿®å¤)
#        â”‚ â””â”€â”€â”€â”€â”€â”€ Minor (æ–°åŠŸèƒ½)
#        â””â”€â”€â”€â”€â”€â”€â”€â”€ Major (ç ´åæ€§å˜æ›´)
```

**ç‰ˆæœ¬å†å²**ï¼š
- `1.0.0+1` (2025-12-11): åˆå§‹ç‰ˆæœ¬
- `1.0.1+2` (è®¡åˆ’): Bug ä¿®å¤ï¼Œæ€§èƒ½ä¼˜åŒ–
- `1.1.0+3` (è®¡åˆ’): æ–°å¢ç¤¾äº¤åˆ†äº«åŠŸèƒ½

#### Git å·¥ä½œæµ
```bash
# åŠŸèƒ½å¼€å‘
git checkout -b feature/social-share
git commit -m "feat: æ·»åŠ ç¤¾äº¤åˆ†äº«åŠŸèƒ½"
git push origin feature/social-share

# å‘å¸ƒç‰ˆæœ¬
git checkout main
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

### 10.4 CI/CD é…ç½®

#### GitHub Actions
```yaml
# .github/workflows/build.yml
name: Build and Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.16.0'
      
      - name: Install dependencies
        run: flutter pub get
      
      - name: Run tests
        run: flutter test --coverage
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
  
  build-android:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
      
      - name: Build APK
        run: flutter build apk --release
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: app-release
          path: build/app/outputs/flutter-apk/app-release.apk
```

### 10.5 èµ„æºä¼˜åŒ–

#### å›¾ç‰‡å‹ç¼©
```bash
# ä½¿ç”¨ ImageOptim æˆ– TinyPNG
find assets/images -name "*.jpg" -o -name "*.png" | \
  xargs -I {} pngquant --quality=80-90 --ext .png --force {}
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- åŸå§‹å¤§å°ï¼š25MB
- å‹ç¼©åï¼š8MB
- **å‡å°‘ 68%**

#### å­—ä½“å­é›†åŒ–
```bash
# åªä¿ç•™éœ€è¦çš„å­—ç¬¦
pyftsubset font.ttf \
  --text-file=chars.txt \
  --output-file=font-subset.ttf
```

#### èµ„äº§æ¸…ç†
```bash
# åˆ é™¤æœªä½¿ç”¨çš„èµ„æº
flutter pub run flutter_asset_cleaner
```

### 10.6 åº”ç”¨å•†åº—å‘å¸ƒ

#### Google Play
1. **åˆ›å»ºåº”ç”¨**
   - åº”ç”¨åç§°ï¼šMovieMind
   - åŒ…åï¼šcom.moviemind.app
   - åˆ†ç±»ï¼šå¨±ä¹ > ç”µå½±

2. **å‡†å¤‡èµ„æ–™**
   - å›¾æ ‡ï¼š512Ã—512px PNG
   - æˆªå›¾ï¼šè‡³å°‘ 2 å¼ ï¼ˆ1080Ã—1920pxï¼‰
   - åŠŸèƒ½å›¾ç‰‡ï¼š1024Ã—500px
   - éšç§æ”¿ç­– URL

3. **ä¸Šä¼  AAB**
```bash
flutter build appbundle --release
# ä¸Šä¼  build/app/outputs/bundle/release/app-release.aab
```

#### App Store
1. **App Store Connect é…ç½®**
   - Bundle IDï¼šcom.moviemind.app
   - SKUï¼šmoviemind-001
   - åˆ†ç±»ï¼šå¨±ä¹

2. **å‡†å¤‡èµ„æ–™**
   - å›¾æ ‡ï¼š1024Ã—1024px PNG
   - æˆªå›¾ï¼š
     - iPhone 6.5": 1284Ã—2778px
     - iPad 12.9": 2048Ã—2732px

3. **ä¸Šä¼  Archive**
```bash
flutter build ios --release
# åœ¨ Xcode ä¸­ Product > Archive > Distribute App
```

### 10.7 ç›‘æ§ä¸åˆ†æ

#### Firebase Analytics
```dart
import 'package:firebase_analytics/firebase_analytics.dart';

class AnalyticsService {
  static FirebaseAnalytics analytics = FirebaseAnalytics.instance;
  
  static Future<void> logSearch(String query, SearchType type) async {
    await analytics.logEvent(
      name: 'search',
      parameters: {
        'query': query,
        'type': type.toString(),
      },
    );
  }
  
  static Future<void> logMovieView(int movieId) async {
    await analytics.logEvent(
      name: 'view_item',
      parameters: {'item_id': movieId.toString()},
    );
  }
}
```

#### Crashlytics
```dart
import 'package:firebase_crashlytics/firebase_crashlytics.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // æ•è· Flutter æ¡†æ¶é”™è¯¯
  FlutterError.onError = FirebaseCrashlytics.instance.recordFlutterError;
  
  // æ•è·å¼‚æ­¥é”™è¯¯
  PlatformDispatcher.instance.onError = (error, stack) {
    FirebaseCrashlytics.instance.recordError(error, stack);
    return true;
  };
  
  runApp(MovieMindApp());
}
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- DAU (æ—¥æ´»è·ƒç”¨æˆ·)
- æœç´¢æˆåŠŸç‡
- å´©æºƒç‡ (ç›®æ ‡ <1%)
- ANR ç‡ (ç›®æ ‡ <0.5%)
- å¹³å‡ä¼šè¯æ—¶é•¿

---

## 11. æœªæ¥è§„åˆ’

### 11.1 çŸ­æœŸè§„åˆ’ï¼ˆv1.1 - v1.3ï¼‰

#### v1.1.0 åŠŸèƒ½å¢å¼º
- [ ] **ç¤¾äº¤åŠŸèƒ½**
  - ç”¨æˆ·ä¹‹é—´å¯ä»¥å…³æ³¨/ç²‰ä¸ç³»ç»Ÿ
  - åˆ†äº«ç‰‡å•å’Œå½±è¯„åˆ°ç¤¾äº¤å¹³å°
  - æŸ¥çœ‹å¥½å‹æ­£åœ¨çœ‹çš„ç”µå½±

- [ ] **ä¸ªæ€§åŒ–æ¨èä¼˜åŒ–**
  - åŸºäºååŒè¿‡æ»¤çš„æ¨èç®—æ³•
  - è€ƒè™‘ç”¨æˆ·è§‚å½±æ—¶é—´ã€é¢‘ç‡çš„æ™ºèƒ½æ¨è
  - "ä»Šæ™šçœ‹ä»€ä¹ˆ"æ¯æ—¥æ¨è

- [ ] **ç¦»çº¿æ¨¡å¼å¢å¼º**
  - ç¼“å­˜ç”µå½±è¯¦æƒ…é¡µä¾›ç¦»çº¿æŸ¥çœ‹
  - ç¦»çº¿ä¸‹è½½å­—å¹•æ•°æ®
  - ç¦»çº¿è§‚å½±è®°å½•è‡ªåŠ¨åŒæ­¥

#### v1.2.0 å†…å®¹æ‰©å±•
- [ ] **ç”µè§†å‰§æ”¯æŒ**
  - æ•´åˆ TMDb TV API
  - å‰§é›†è¿›åº¦è¿½è¸ª
  - è‡ªåŠ¨æé†’æ›´æ–°

- [ ] **çŸ­è§†é¢‘é¢„å‘Šç‰‡**
  - æ•´åˆ TikTok/æŠ–éŸ³é£æ ¼çš„ç«–å±é¢„å‘Š
  - åœ¨ App å†…æ»‘åŠ¨è§‚çœ‹é¢„å‘Šç‰‡é›†åˆ

- [ ] **AI åŠŸèƒ½**
  - AI ç”Ÿæˆç”µå½±æ‘˜è¦
  - æ™ºèƒ½æ¨èç†ç”±è¯´æ˜
  - æ ¹æ®å¿ƒæƒ…æ¨èç”µå½±

#### v1.3.0 ä½“éªŒä¼˜åŒ–
- [ ] **æš—é»‘æ¨¡å¼**
  - å®Œæ•´çš„æš—è‰²ä¸»é¢˜æ”¯æŒ
  - è·Ÿéšç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢

- [ ] **å¤šè¯­è¨€æ”¯æŒ**
  - è‹±è¯­ã€æ—¥è¯­ç•Œé¢
  - æ›´å¤šè¯­è¨€çš„å°è¯æœç´¢

- [ ] **æ— éšœç¢ä¼˜åŒ–**
  - å®Œå–„çš„ VoiceOver/TalkBack æ”¯æŒ
  - é«˜å¯¹æ¯”åº¦æ¨¡å¼
  - å­—ä½“ç¼©æ”¾æ”¯æŒ

### 11.2 ä¸­æœŸè§„åˆ’ï¼ˆv2.0ï¼‰

#### äº‘ç«¯åŒæ­¥
- ç”¨æˆ·æ•°æ®äº‘ç«¯å­˜å‚¨ï¼ˆFirebase/è‡ªå»ºåç«¯ï¼‰
- å¤šè®¾å¤‡æ•°æ®åŒæ­¥
- è´¦å·ç³»ç»Ÿå‡çº§ï¼ˆOAuth ç™»å½•ï¼‰

#### ç¤¾åŒºåŠŸèƒ½
- ç”µå½±è®¨è®ºåŒº
- ç”¨æˆ·å½±è¯„è¯„è®ºç³»ç»Ÿ
- çƒ­é—¨è¯é¢˜æ ‡ç­¾

#### è§‚å½±æ´»åŠ¨
- çº¿ä¸‹è§‚å½±æ´»åŠ¨ç»„ç»‡
- å½±é™¢æ’ç‰‡ä¿¡æ¯
- è´­ç¥¨è·³è½¬åŠŸèƒ½

### 11.3 é•¿æœŸæ„¿æ™¯ï¼ˆv3.0+ï¼‰

#### å†…å®¹ç”Ÿæ€
- UGC å†…å®¹ï¼šç”¨æˆ·è‡ªåˆ¶ç‰‡å•æ¨è
- å½±è¯„äººè®¤è¯ç³»ç»Ÿ
- ç”µå½±ç›¸å…³æ–‡ç« /è§†é¢‘

#### å•†ä¸šåŒ–æ¢ç´¢
- å½±é™¢åˆä½œè´­ç¥¨åˆ†æˆ
- ä¼šå‘˜ç³»ç»Ÿï¼ˆå»å¹¿å‘Šã€é«˜çº§åŠŸèƒ½ï¼‰
- ç”µå½±å‘¨è¾¹å•†åŸ

#### æŠ€æœ¯å‡çº§
- å¾®æœåŠ¡åç«¯æ¶æ„
- GraphQL API
- æœºå™¨å­¦ä¹ æ¨èå¼•æ“
- AR ç”µå½±æµ·æŠ¥æ‰«æ

---

## 12. é¡¹ç›®æ€»ç»“

### 12.1 æŠ€æœ¯æˆæœ

#### ä»£ç ç»Ÿè®¡
```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¯­è¨€            æ–‡ä»¶æ•°    ä»£ç è¡Œæ•°    æ³¨é‡Šè¡Œæ•°    ç©ºç™½è¡Œæ•°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Dart              30      3,500        580        420
YAML               3        150         20         15
Kotlin             2        120         15         10
Swift              2        100         12          8
JSON               8      1,200          0          0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡              45      5,070        627        453
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| å†·å¯åŠ¨æ—¶é—´ (Android) | <2s | 1.2s | âœ… |
| çƒ­å¯åŠ¨æ—¶é—´ (Android) | <0.5s | 0.3s | âœ… |
| åˆ—è¡¨æ»šåŠ¨å¸§ç‡ | >55 FPS | 58-60 FPS | âœ… |
| å°è¯æœç´¢å“åº” | <2s | 1-2s | âœ… |
| å†…å­˜å ç”¨ (é—²ç½®) | <150MB | 120MB | âœ… |
| APK å¤§å° | <50MB | 45MB | âœ… |
| é¦–é¡µæ•°æ®åŠ è½½ | <1s | 0.5s | âœ… |

#### åŠŸèƒ½å®Œæˆåº¦
- âœ… å››ç»´æœç´¢ç³»ç»Ÿï¼ˆç”µå½±/å½±äºº/å¥–é¡¹/å°è¯ï¼‰
- âœ… ç”µå½±è¯¦æƒ…é¡µï¼ˆæ²‰æµ¸å¼è®¾è®¡ï¼‰
- âœ… è§‚å½±çŠ¶æ€ç®¡ç†ï¼ˆæƒ³çœ‹/åœ¨çœ‹/çœ‹è¿‡ï¼‰
- âœ… è‡ªå®šä¹‰ç‰‡å•ç³»ç»Ÿ
- âœ… ç”¨æˆ·ç³»ç»Ÿï¼ˆæ³¨å†Œ/ç™»å½•/å¤´åƒï¼‰
- âœ… è§‚å½±çƒ­åº¦å›¾å¯è§†åŒ–
- âœ… é¢„å‘Šç‰‡æ’­æ”¾
- âœ… å½±è¯„ç¬”è®°
- â³ ç¤¾äº¤åˆ†äº«ï¼ˆè®¡åˆ’ä¸­ï¼‰
- â³ äº‘ç«¯åŒæ­¥ï¼ˆè®¡åˆ’ä¸­ï¼‰

### 12.2 æ ¸å¿ƒåˆ›æ–°ç‚¹

#### 1. åŒå¼•æ“å°è¯æœç´¢
**åˆ›æ–°æ€§**ï¼š
- è¡Œä¸šé¦–åˆ› 308MB æœ¬åœ°å‰§æœ¬æ•°æ®å®æ—¶æ£€ç´¢
- ç²¾é€‰å­—å¹• + å®Œæ•´å‰§æœ¬åŒå±‚æ¶æ„
- Isolate å¹¶å‘å¤„ç†ç¡®ä¿ UI æµç•…

**æŠ€æœ¯ä»·å€¼**ï¼š
- å±•ç¤ºäº† Flutter åœ¨å¤§æ•°æ®å¤„ç†æ–¹é¢çš„èƒ½åŠ›
- æä¾›äº†ç§»åŠ¨ç«¯ç¦»çº¿å…¨æ–‡æ£€ç´¢çš„æœ€ä½³å®è·µ
- ä¸ºå…¶ä»–å†…å®¹ç±»åº”ç”¨æä¾›äº†æŠ€æœ¯å‚è€ƒ

#### 2. æ··åˆæ•°æ®æºæ•´åˆ
**åˆ›æ–°æ€§**ï¼š
- TMDb API + æœ¬åœ° JSON æ— ç¼èåˆ
- ç»Ÿä¸€æ•°æ®æ¨¡å‹é€‚é…å¤šç§æ•°æ®æ ¼å¼
- æ™ºèƒ½é™çº§æœºåˆ¶ä¿è¯ç¦»çº¿å¯ç”¨

**æŠ€æœ¯ä»·å€¼**ï¼š
- è§£å†³äº†åœ¨çº¿æ•°æ®ä¸ç¦»çº¿æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜
- å±•ç¤ºäº† Flutter æ•°æ®å±‚çš„çµæ´»è®¾è®¡
- ä¸ºæ··åˆæ•°æ®æºåº”ç”¨æä¾›äº†æ¶æ„èŒƒä¾‹

#### 3. ä¸ªæ€§åŒ–çƒ­åº¦å›¾
**åˆ›æ–°æ€§**ï¼š
- GitHub é£æ ¼çš„è§‚å½±æ—¥å†
- åŸºäºæ—¶é—´æˆ³çš„è‡ªåŠ¨ç”Ÿæˆ
- å¯è§†åŒ–ç”¨æˆ·è§‚å½±ä¹ æƒ¯

**æŠ€æœ¯ä»·å€¼**ï¼š
- åˆ›æ–°æ€§åœ°å°†å¼€å‘è€…å·¥å…·çš„å¯è§†åŒ–å¼•å…¥è§‚å½±åº”ç”¨
- æå‡äº†ç”¨æˆ·å¯¹è‡ªèº«è§‚å½±è¡Œä¸ºçš„è®¤çŸ¥
- å¢å¼ºäº†ç”¨æˆ·ç•™å­˜å’Œå‚ä¸åº¦

### 12.3 é¡¹ç›®äº®ç‚¹

#### æŠ€æœ¯å±‚é¢
- ğŸš€ **é«˜æ€§èƒ½**: Isolate å¹¶å‘ + è™šæ‹Ÿæ»šåŠ¨ + ä¸‰çº§ç¼“å­˜
- ğŸ¯ **æ¶æ„æ¸…æ™°**: åˆ†å±‚æ¶æ„ + å•ä¸€èŒè´£åŸåˆ™
- ğŸ“¦ **ä»£ç è´¨é‡**: 3500+ è¡Œä»£ç ï¼Œå¤ç”¨ç‡ >70%
- ğŸ”§ **å¯ç»´æŠ¤æ€§**: å®Œæ•´çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ğŸ§ª **å¯æµ‹è¯•æ€§**: å•å…ƒæµ‹è¯• + Widget æµ‹è¯•è¦†ç›–

#### äº§å“å±‚é¢
- ğŸ¬ **å…¨æ–¹ä½æœç´¢**: å››ç»´åº¦æ£€ç´¢è¦†ç›–æ‰€æœ‰ä½¿ç”¨åœºæ™¯
- ğŸ¨ **è§†è§‰è®¾è®¡**: Material Design 3 + 19ç§ç‰¹è‰²å­—ä½“
- âš¡ **äº¤äº’æµç•…**: 60 FPS + åŠ¨ç”»è¿‡æ¸¡ + å³æ—¶åé¦ˆ
- ğŸ“± **è·¨å¹³å°**: ä¸€å¥—ä»£ç æ”¯æŒ iOS/Android/Web
- ğŸ­ **å·®å¼‚åŒ–**: ç‹¬ç‰¹çš„å°è¯æœç´¢åŠŸèƒ½

### 12.4 æŠ€æœ¯ä»·å€¼

#### è¡Œä¸šå‚è€ƒä»·å€¼
æœ¬é¡¹ç›®ä¸ºç”µå½±ç±»/å†…å®¹èšåˆç±»åº”ç”¨æä¾›äº†ä»¥ä¸‹å‚è€ƒï¼š

1. **å¤§æ•°æ®æœ¬åœ°åŒ–æ–¹æ¡ˆ**
   - å¦‚ä½•åœ¨ç§»åŠ¨ç«¯å¤„ç† 300MB+ æ•°æ®
   - Isolate å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ
   - å†…å­˜ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥

2. **æ··åˆæ•°æ®æ¶æ„**
   - åœ¨çº¿ API + æœ¬åœ°æ•°æ®çš„æ•´åˆæ–¹æ¡ˆ
   - æ•°æ®é™çº§å’Œå®¹é”™æœºåˆ¶
   - ç¼“å­˜ç­–ç•¥å’ŒåŒæ­¥é€»è¾‘

3. **Flutter æœ€ä½³å®è·µ**
   - åˆ†å±‚æ¶æ„è®¾è®¡
   - çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ
   - æ€§èƒ½ä¼˜åŒ–æŠ€å·§
   - UI/UX è®¾è®¡æ¨¡å¼

#### å­¦ä¹ ä»·å€¼
å¯¹äº Flutter å­¦ä¹ è€…å’Œå¼€å‘è€…ï¼š

- âœ… å®Œæ•´çš„å•†ä¸šçº§åº”ç”¨æ¡ˆä¾‹
- âœ… æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ³¨é‡Š
- âœ… æ¶µç›–ç½‘ç»œã€å­˜å‚¨ã€å¹¶å‘ã€UI ç­‰æ ¸å¿ƒæŠ€æœ¯
- âœ… å®æˆ˜ä¸­çš„æ€§èƒ½ä¼˜åŒ–ç»éªŒ
- âœ… å¯ç›´æ¥è¿è¡Œå’Œè°ƒè¯•çš„å®Œæ•´é¡¹ç›®

### 12.5 ç»éªŒæ€»ç»“

#### æˆåŠŸç»éªŒ
1. **æ—©æœŸæ¶æ„è®¾è®¡**ï¼šæ¸…æ™°çš„åˆ†å±‚æ¶æ„ä¸ºåæœŸæ‰©å±•æä¾›äº†ä¾¿åˆ©
2. **æ€§èƒ½ä¼˜å…ˆ**ï¼šä»ä¸€å¼€å§‹å°±è€ƒè™‘æ€§èƒ½ï¼Œé¿å…äº†åæœŸå¤§è§„æ¨¡é‡æ„
3. **ç”¨æˆ·ä½“éªŒ**ï¼šæ³¨é‡ç»†èŠ‚ï¼Œå¦‚åŠ¨ç”»ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯æç¤º
4. **æŠ€æœ¯é€‰å‹**ï¼šFlutter + TMDb API çš„ç»„åˆéå¸¸é€‚åˆæœ¬é¡¹ç›®

#### é‡åˆ°çš„æŒ‘æˆ˜
1. **å¤§æ–‡ä»¶å¤„ç†**ï¼š308MB å‰§æœ¬æ•°æ®çš„æ£€ç´¢æ€§èƒ½é—®é¢˜
   - è§£å†³ï¼šIsolate å¹¶å‘ + åŒå¼•æ“æ¶æ„
2. **æ··åˆæ•°æ®æº**ï¼šåœ¨çº¿ API ä¸æœ¬åœ°æ•°æ®çš„å­—æ®µä¸ä¸€è‡´
   - è§£å†³ï¼šç»Ÿä¸€æ•°æ®æ¨¡å‹ + å¤šå·¥å‚æ–¹æ³•
3. **UI å¡é¡¿**ï¼šå¤§é‡å›¾ç‰‡åŠ è½½å¯¼è‡´çš„æ€§èƒ½é—®é¢˜
   - è§£å†³ï¼šä¸‰çº§ç¼“å­˜ + è™šæ‹Ÿæ»šåŠ¨ + å›¾ç‰‡å‹ç¼©

#### å¯æ”¹è¿›ä¹‹å¤„
1. **æµ‹è¯•è¦†ç›–**ï¼šå½“å‰æµ‹è¯•è¦†ç›–ç‡çº¦ 40%ï¼Œç›®æ ‡ >80%
2. **ä»£ç å¤ç”¨**ï¼šéƒ¨åˆ† UI ç»„ä»¶å¯ä»¥è¿›ä¸€æ­¥æŠ½è±¡å¤ç”¨
3. **é”™è¯¯å¤„ç†**ï¼šå¯ä»¥æ›´å®Œå–„çš„é”™è¯¯è¿½è¸ªå’Œä¸ŠæŠ¥æœºåˆ¶
4. **æ–‡æ¡£å®Œå–„**ï¼šéœ€è¦è¡¥å…… API æ–‡æ¡£å’Œå¼€å‘è€…æŒ‡å—

### 12.6 è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’ŒæœåŠ¡ï¼š
- **Flutter**: Google æä¾›çš„ä¼˜ç§€è·¨å¹³å°æ¡†æ¶
- **TMDb**: æä¾›å…è´¹ç”µå½±æ•°æ® API
- **GitHub**: ä»£ç æ‰˜ç®¡å’Œåä½œå¹³å°
- **Stack Overflow**: æŠ€æœ¯é—®é¢˜è§£å†³ç¤¾åŒº

---

## é™„å½•

### A. å…³é”®ä¾èµ–ç‰ˆæœ¬
```yaml
dependencies:
  flutter: sdk: flutter
  dio: ^5.3.0
  cached_network_image: ^3.3.0
  shared_preferences: ^2.2.2
  google_fonts: ^6.1.0
  carousel_slider: ^5.0.0
  flutter_rating_bar: ^4.0.1
  video_player: ^2.10.1
  chewie: ^1.13.0
  youtube_player_iframe: ^5.2.2
  intl: ^0.19.0
  image_picker: ^1.0.7
```

### B. å¼€å‘ç¯å¢ƒ
- **Flutter SDK**: 3.16.0
- **Dart SDK**: 3.2.0
- **Android Studio**: 2023.1.1
- **Xcode**: 15.0
- **æœ€ä½ Android ç‰ˆæœ¬**: Android 5.0 (API 21)
- **æœ€ä½ iOS ç‰ˆæœ¬**: iOS 12.0

### C. å¤–éƒ¨æœåŠ¡
- **TMDb API**: v3
- **YouTube Data API**: v3
- **Font CDN**: Google Fonts
- **Image CDN**: TMDb Image Server

### D. é¡¹ç›®é“¾æ¥
- **GitHub**: https://github.com/yourusername/moviemind (ç¤ºä¾‹)
- **è®¾è®¡ç¨¿**: Figma Design Link (ç¤ºä¾‹)
- **API æ–‡æ¡£**: https://developers.themoviedb.org/3
- **æŠ€æœ¯åšå®¢**: å¾…å‘å¸ƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2026-01-05  
**ç»´æŠ¤å›¢é˜Ÿ**: å®‹è‰¾è½©ã€å¼ ä½³å½¤  
**è”ç³»æ–¹å¼**: moviemind@example.com (ç¤ºä¾‹)

**å£°æ˜**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’ŒæŠ€æœ¯äº¤æµï¼Œç”µå½±æ•°æ®æ¥æºäº TMDb APIï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚
# MovieMind é¡¹ç›®æŠ€æœ¯æŠ¥å‘Š

**é¡¹ç›®åç§°**ï¼šMovieMind - æ™ºèƒ½ç”µå½±æ¢ç´¢ä¸ç®¡ç†å¹³å°  
**å¼€å‘æ¡†æ¶**ï¼šFlutter 3.x (Dart)  
**æŠ¥å‘Šæ—¥æœŸ**ï¼š2026-01-05  
**å½“å‰ç‰ˆæœ¬**ï¼š1.0.0+1  
**ç»´æŠ¤å›¢é˜Ÿ**ï¼šå®‹è‰¾è½©ã€å¼ ä½³å½¤  
**æŠ¥å‘Šæäº¤æ—¶é—´**ï¼š2026.1.5

---

## 1. é¡¹ç›®æ¦‚è¿° (Overview)

### 1.1 é¡¹ç›®èƒŒæ™¯ä¸å®šä½

**MovieMind** æ˜¯ä¸€æ¬¾é¢å‘ç”µå½±çˆ±å¥½è€…çš„è·¨å¹³å°ç§»åŠ¨åº”ç”¨ï¼Œå®šä½äºæ‰“é€ ä¸€ä¸ªé›†æˆåŒ–çš„ç”µå½±ä¿¡æ¯æ£€ç´¢ä¸ä¸ªäººè§‚å½±ç®¡ç†ç”Ÿæ€ç³»ç»Ÿã€‚åœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œç”¨æˆ·é¢ä¸´ç€æµ·é‡ç”µå½±èµ„æºå´éš¾ä»¥é«˜æ•ˆæ£€ç´¢ã€ç®¡ç†è§‚å½±è®°å½•åˆ†æ•£ï¼Œæ•´åˆæ€§ä¸å¼ºã€å¯¹äºæƒ³çœ‹çš„ç”µå½±éœ€è¦åˆ‡æ¢å¤šå¹³å°äº†è§£ç­‰ç—›ç‚¹ã€‚MovieMind é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›è§£å†³è¿™äº›é—®é¢˜ï¼š

- ğŸ¬ **å››ç»´åº¦æ™ºèƒ½æœç´¢**ï¼šç”µå½±ã€å½±äººã€å¥–é¡¹ã€å°è¯å…¨æ–¹ä½æ£€ç´¢å’Œæ¨¡å—åŒ–é€‰é¡¹ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„æŸ¥è¯¢éœ€æ±‚å¹¶å¸®åŠ©ç”¨æˆ·æ‹“å±•å…´è¶£
- ğŸ“Š **å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šä»æƒ³çœ‹ã€åœ¨çœ‹åˆ°çœ‹è¿‡ï¼Œå®Œæ•´è®°å½•ç”¨æˆ·è§‚å½±å†ç¨‹ï¼Œå¹¶ç”Ÿæˆç›¸å…³çš„UIè®¾è®¡åœ¨ç”¨æˆ·ä¸»é¡µï¼Œå¯ä»¥æŸ¥çœ‹å¯¼å‡º
- ğŸ¯ **åŸºäºåå¥½çš„æ¨è**ï¼šæ ¹æ®ç”¨æˆ·è§‚å½±ä¹ æƒ¯å’Œç±»å‹åå¥½æä¾›ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ç”¨æˆ·æ‹“å±•å…´è¶£
- ğŸ† **æƒå¨å¥–é¡¹æ•°æ®åº“**ï¼šé›†æˆå…­å¤§ç”µå½±èŠ‚è·å¥–æ•°æ®ï¼Œå¸®åŠ©ç”¨æˆ·å‘ç°é«˜è´¨é‡ä½œå“
- ğŸ’¬ **å°è¯æ£€ç´¢å¼•æ“**ï¼šç‹¬åˆ›çš„å‰§æœ¬çº§å°è¯æœç´¢ï¼Œè®©ç”¨æˆ·é€šè¿‡åªè¨€ç‰‡è¯­æ‰¾åˆ°å¿ƒä»ªç”µå½±

### 1.2 æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

#### 1.2.1 å››ç±»ä¸»è¦åŠŸèƒ½çš„æœç´¢ç³»ç»Ÿ
- **ç”µå½±æœç´¢**ï¼šæ”¯æŒæŒ‰ç›¸å…³åº¦ã€è¯„åˆ†ã€ä¸Šæ˜ æ—¶é—´æ’åºï¼Œå¿«é€Ÿå®æ—¶å±•ç¤º TMDb æ•°æ®åº“æ•°ç™¾ä¸‡éƒ¨ç”µå½±
- **å½±äººæœç´¢**ï¼šæ¼”å‘˜ã€å¯¼æ¼”ä¿¡æ¯æŸ¥è¯¢ï¼Œå…³è”ä½œå“å±•ç¤º
- **å¥–é¡¹æœç´¢**ï¼šæ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼ˆå¦‚"ç¬¬95å±Šå¥¥æ–¯å¡"ã€"2024æŸæ—ç”µå½±èŠ‚"ï¼‰ï¼ŒåŒæ—¶æä¾›æ¨¡å—åŒ–çš„ç”µå½±å¥–é¡¹é€‰æ‹©ï¼Œåˆ—ä¸¾äºŒåå¹´å›½å†…å¤–çŸ¥åç”µå½±å¥–é¡¹çš„è·å¥–åŠæåä½œå“
- **å°è¯æœç´¢**ï¼šåŒå¼•æ“æ¶æ„ï¼Œç²¾é€‰å­—å¹• + å®Œæ•´å‰§æœ¬ï¼Œæ”¯æŒä¸­è‹±æ–‡æ£€ç´¢

#### 1.2.2 è§‚å½±ç®¡ç†
- **ä¸‰æ€çŠ¶æ€ç®¡ç†**ï¼šæƒ³çœ‹(Wishlist)ã€åœ¨çœ‹(Watching)ã€çœ‹è¿‡(Watched)
- **è§‚çœ‹è¿›åº¦è¿½è¸ª**ï¼šåœ¨çœ‹çŠ¶æ€ä¸‹æ”¯æŒæ»‘åŠ¨æ¡è®°å½•ç™¾åˆ†æ¯”è¿›åº¦
- **æ”¶è—ç³»ç»Ÿ**ï¼šä¸€é”®æ”¶è—å–œçˆ±ç”µå½±ï¼Œæœ¬åœ°æŒä¹…åŒ–å­˜å‚¨
- **è‡ªå®šä¹‰ç‰‡å•**ï¼šç”¨æˆ·å¯åˆ›å»ºå¤šä¸ªä¸»é¢˜ç‰‡å•ï¼Œå¦‚"å¥¥æ–¯å¡æœ€ä½³"ã€"å‘¨æœ«å¿…çœ‹"ç­‰
- **å½±è¯„ç¬”è®°**ï¼šä¸ºæ¯éƒ¨ç”µå½±æ’°å†™ä¸ªäººè§‚åæ„Ÿï¼Œæ”¯æŒé•¿æ–‡æœ¬å­˜å‚¨

#### 1.2.3 ä¸ªæ€§åŒ–ä½“éªŒ
- **è§‚å½±çƒ­åº¦å›¾**ï¼šGitHub é£æ ¼çš„å¹´åº¦è§‚å½±æ—¥å†ï¼Œå¯è§†åŒ–å±•ç¤ºè§‚å½±é¢‘ç‡
- **ç±»å‹åå¥½åˆ†æ**ï¼šåŸºäºç”¨æˆ·è§‚å½±å†å²æ¨èåŒç±»å‹é«˜åˆ†ç”µå½±
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šæ³¨å†Œ/ç™»å½•ï¼Œæ•°æ®äº‘ç«¯åŒæ­¥ï¼ˆå½“å‰ç‰ˆæœ¬ä¸ºæœ¬åœ°å­˜å‚¨ï¼‰
- **ä¸»é¢˜å®šåˆ¶**ï¼šå¤šç§ç”µå½±ç±»å‹é…å¤‡ç‹¬ç‰¹å­—ä½“å’ŒèƒŒæ™¯å›¾

### 1.3 æŠ€æœ¯åˆ›æ–°ç‚¹

1. **é«˜æ€§èƒ½å¤§æ–‡ä»¶æ£€ç´¢**
   - é‡‡ç”¨ Flutter Isolate æŠ€æœ¯ï¼Œå°†å¤§é‡å®Œæ•´å‰§æœ¬æ•°æ®çš„æœç´¢ä»»åŠ¡æ”¾å…¥åå°çº¿ç¨‹
   - åŒå¼•æ“æœç´¢ç­–ç•¥ï¼šä¼˜å…ˆå¿«é€Ÿæ£€ç´¢ç²¾é€‰æ•°æ®ï¼Œå†æ·±åº¦æœç´¢å®Œæ•´æ•°æ®
   - å®ç°ä¸»çº¿ç¨‹ 60fps æµç•…è¿è¡Œï¼Œæ£€ç´¢å»¶è¿Ÿ < 2s

2. **æ²‰æµ¸å¼ UI è®¾è®¡**
   - åŠ¨æ€ AppBar é€æ˜åº¦ï¼šæ ¹æ®æ»šåŠ¨ä½ç½®å®æ—¶è®¡ç®—é€æ˜åº¦ `(offset/200).clamp(0.0, 1.0)`
   - æ¯›ç»ç’ƒæ•ˆæœ(Backdrop Filter)ï¼šåº•éƒ¨å¯¼èˆªæ å’Œè¯¦æƒ…é¡µé‡‡ç”¨æ¨¡ç³Šæ•ˆæœ
   - Hero åŠ¨ç”»ï¼šé¡µé¢åˆ‡æ¢æ—¶æµ·æŠ¥å¹³æ»‘è¿‡æ¸¡
   - å…³é”®è¯é«˜äº®ç®—æ³•ï¼šå°è¯æœç´¢ç»“æœè‡ªåŠ¨æ ‡çº¢åŒ¹é…å…³é”®è¯

3. **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**
   - å›¾ç‰‡ä¸‰çº§ç¼“å­˜ï¼šå†…å­˜(Memory Cache) â†’ ç£ç›˜(Disk Cache) â†’ ç½‘ç»œ(Network)
   - ç”µå½±ä¿¡æ¯ç¼“å­˜æ± ï¼šæœ¬åœ°ç»´æŠ¤å·²è®¿é—®ç”µå½±çš„å®Œæ•´ä¿¡æ¯ï¼Œå‡å°‘é‡å¤è¯·æ±‚
   - é¢„åŠ è½½æœºåˆ¶ï¼šé¦–é¡µæ¨èæ•°æ®å¹¶è¡ŒåŠ è½½ï¼Œä½¿ç”¨ `Future.wait()` ä¼˜åŒ–

4. **è·¨å¹³å°ä¸€è‡´æ€§**
   - ç»Ÿä¸€ Material Design 3 è®¾è®¡è¯­è¨€
   - San Francisco ç³»ç»Ÿå­—ä½“é€‚é…
   - å“åº”å¼å¸ƒå±€ï¼šæ”¯æŒä¸åŒå±å¹•å°ºå¯¸è‡ªé€‚åº”è¿‘

---

## 2. æŠ€æœ¯æ ˆæ¶æ„ (Tech Stack)

### 2.1 æ ¸å¿ƒæ¡†æ¶
- **Flutter & Dart**: é‡‡ç”¨ Google çš„ Flutter æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œå®ç°ä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼ˆiOS, Android, Web, Desktopï¼‰ã€‚
- **æ¶æ„æ¨¡å¼**: é‡‡ç”¨åˆ†å±‚æ¶æ„ (Layered Architecture)ï¼Œä¸»è¦åˆ†ç¦»ä¸ºï¼š
  - **UI Layer (Presentation)**: é¡µé¢ (`pages/`) ä¸é€šç”¨ç»„ä»¶ (`widgets/`)ã€‚
  - **Service Layer (Business Logic)**: ä¸šåŠ¡é€»è¾‘å¤„ç† (`services/`)ã€‚
  - **Model Layer (Data)**: æ•°æ®å®ä½“å®šä¹‰ (`models/`)ã€‚

### 2.2 å…³é”®ä¾èµ–åº“è¯¦è§£ (Dependencies)

#### ç½‘ç»œä¸æ•°æ®å±‚
| ä¾èµ–åº“ | ç‰ˆæœ¬ | ç”¨é€” | æ ¸å¿ƒåŠŸèƒ½ |
|--------|------|------|----------|
| `dio` | ^5.3.0 | HTTP å®¢æˆ·ç«¯ | ç»Ÿä¸€ API è¯·æ±‚ç®¡ç†ã€æ‹¦æˆªå™¨ã€é”™è¯¯å¤„ç† |
| `cached_network_image` | ^3.3.0 | å›¾ç‰‡ç¼“å­˜ | ä¸‰çº§ç¼“å­˜ã€æ¸è¿›å¼åŠ è½½ã€å ä½ç¬¦ |
| `shared_preferences` | ^2.2.2 | æœ¬åœ°é”®å€¼å­˜å‚¨ | ç”¨æˆ·æ•°æ®ã€è§‚å½±çŠ¶æ€ã€æ”¶è—è®°å½•æŒä¹…åŒ– |
| `intl` | ^0.19.0 | å›½é™…åŒ– | æ—¥æœŸæ ¼å¼åŒ–ã€å¤šè¯­è¨€æ”¯æŒ |

**Dio é…ç½®è¯¦è§£**ï¼š
```dart
TMDbService() {
  _dio = Dio(BaseOptions(
    baseUrl: 'https://api.themoviedb.org/3',
    connectTimeout: const Duration(seconds: 5),
    receiveTimeout: const Duration(seconds: 5),
    queryParameters: {
      'api_key': apiKey,
      'language': 'zh-CN',
    },
  ));
  _dio.interceptors.add(LogInterceptor(
    request: true, 
    responseBody: false, 
    error: true
  ));
}
```
- **å…¨å±€é…ç½®**ï¼šæ‰€æœ‰è¯·æ±‚è‡ªåŠ¨æºå¸¦ API Key å’Œè¯­è¨€å‚æ•°
- **è¶…æ—¶æ§åˆ¶**ï¼š5ç§’è¶…æ—¶é¿å…é•¿æ—¶é—´ç­‰å¾…ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **æ—¥å¿—æ‹¦æˆª**ï¼šå¼€å‘ç¯å¢ƒä¸‹è®°å½•è¯·æ±‚è¯¦æƒ…ï¼Œä¾¿äºè°ƒè¯•
- **é”™è¯¯é™çº§**ï¼šç½‘ç»œå¼‚å¸¸æ—¶è¿”å› Mock Dataï¼Œä¿è¯åº”ç”¨å¯ç”¨æ€§

#### UI ç»„ä»¶ä¸äº¤äº’
| ä¾èµ–åº“ | ç‰ˆæœ¬ | ç”¨é€” | åº”ç”¨åœºæ™¯ |
|--------|------|------|----------|
| `carousel_slider` | ^5.0.0 | è½®æ’­å›¾ | é¦–é¡µçƒ­é—¨ç”µå½± Banner |
| `flutter_rating_bar` | ^4.0.1 | è¯„åˆ†ç»„ä»¶ | ç”µå½±è¯„åˆ†å¯è§†åŒ–å±•ç¤º |
| `google_fonts` | ^6.1.0 | å­—ä½“åº“ | 19ç§ç”µå½±ç±»å‹ç‰¹è‰²å­—ä½“ã€å¤šè¯­è¨€å°è¯å±•ç¤º |
| `cupertino_icons` | ^1.0.2 | iOS å›¾æ ‡ | ä¿æŒè·¨å¹³å°è§†è§‰ä¸€è‡´æ€§ |

**Google Fonts åˆ›æ–°åº”ç”¨**ï¼š
```dart
// Logo æ··æ­è®¾è®¡
Text.rich(TextSpan(children: [
  TextSpan(text: 'Movie', style: GoogleFonts.fascinate(fontSize: 28)),
  TextSpan(text: 'Mind', style: GoogleFonts.peralta(fontSize: 28)),
]))

// ç”µå½±ç±»å‹ç‰¹è‰²å­—ä½“æ˜ å°„
final genreFonts = {
  28: GoogleFonts.blackOpsOne(),    // åŠ¨ä½œç‰‡
  27: GoogleFonts.rubikGlitch(),    // ææ€–ç‰‡
  878: GoogleFonts.orbitron(),      // ç§‘å¹»ç‰‡
  10749: GoogleFonts.greatVibes(),  // çˆ±æƒ…ç‰‡
  // ... å…±19ç§ç±»å‹
};
```

#### å¤šåª’ä½“æ’­æ”¾
| ä¾èµ–åº“ | ç‰ˆæœ¬ | ç”¨é€” | æŠ€æœ¯ç‰¹ç‚¹ |
|--------|------|------|----------|
| `video_player` | ^2.10.1 | è§†é¢‘æ’­æ”¾å¼•æ“ | åŸç”Ÿæ€§èƒ½ã€ä½å»¶è¿Ÿ |
| `chewie` | ^1.13.0 | æ’­æ”¾å™¨ UI | å°è£…å®Œæ•´æ§åˆ¶ç•Œé¢ |
| `youtube_player_iframe` | ^5.2.2 | YouTube æ’­æ”¾ | åµŒå…¥å¼æ’­æ”¾ã€API é›†æˆ |
| `image_picker` | ^1.0.7 | å›¾ç‰‡é€‰æ‹© | ç”¨æˆ·å¤´åƒä¸Šä¼  |

**YouTube æœåŠ¡é›†æˆ**ï¼š
```dart
class YouTubeService {
  static const String apiKey = 'AIzaSy...';
  
  Future<String?> searchVideo(String query) async {
    final response = await _dio.get('$baseUrl/search', 
      queryParameters: {
        'part': 'snippet',
        'q': query,
        'type': 'video',
        'maxResults': 1,
        'key': apiKey,
      },
    );
    return response.data['items'][0]['id']['videoId'];
  }
}
```
ç”¨æˆ·å¯ç›´è¿åˆ°YouTubeç½‘ç«™ï¼Œæ’­æ”¾è¯¥éƒ¨ç”µå½±æˆ–ä¸ä¹‹ç›¸å…³çš„è§†é¢‘ï¼Œæ¯”å¦‚é¢„å‘Šç‰‡ã€å½±è¯„ã€äºŒåˆ›ç­‰è§†é¢‘ã€‚å‡å°‘ç”¨æˆ·çš„è·¨å¹³å°çš„ç—›ç‚¹é—®é¢˜ã€‚

#### å¼‚æ­¥è®¡ç®—ä¸å¹¶å‘
- **Flutter Isolate**ï¼šåå°çº¿ç¨‹å¤„ç†ï¼Œä¸é˜»å¡ UI
- **Compute å‡½æ•°**ï¼šç®€åŒ– Isolate ä½¿ç”¨ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
- **RootIsolateToken**ï¼šç¡®ä¿ Isolate ä¸­èƒ½è®¿é—® Flutter èµ„æºï¼ˆå¦‚ AssetBundleï¼‰

```dart
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final token = RootIsolateToken.instance;
  return await compute(_parseAndSearchScripts, {
    'query': query, 
    'token': token
  });
}

// åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œ
static Future<List<QuoteMatch>> _parseAndSearchScripts(
  Map<String, dynamic> params
) async {
  final token = params['token'] as RootIsolateToken?;
  if (token != null) {
    BackgroundIsolateBinaryMessenger.ensureInitialized(token);
  }
  
  // åŠ è½½å¹¶è§£æ 308MB æ•°æ®
  final String jsonString = await rootBundle.loadString(
    'assets/scripts/movie_scripts_with_tmdb.json'
  );
  final List<dynamic> data = jsonDecode(jsonString);
  // æ‰§è¡Œæœç´¢...
}
```

### 2.3 æ•°æ®æºä¸ API æ¶æ„

#### 2.3.1 TMDb API é›†æˆ

**åŸºç¡€ä¿¡æ¯**ï¼š
- **å®˜æ–¹æ–‡æ¡£**ï¼šhttps://developers.themoviedb.org/3
- **API ç‰ˆæœ¬**ï¼šv3
- **è®¤è¯æ–¹å¼**ï¼šAPI Key (Query Parameter)
- **è¯·æ±‚é™åˆ¶**ï¼š40 è¯·æ±‚/10ç§’
- **æ•°æ®è¦†ç›–**ï¼š87ä¸‡+ ç”µå½±ï¼Œ200ä¸‡+ å½±äºº

**ä¸»è¦ç«¯ç‚¹åˆ†ç±»**ï¼š

1. **ç”µå½±åˆ—è¡¨ç±»**
   ```
   GET /movie/popular         # çƒ­é—¨ç”µå½±ï¼ˆåŸºäºè§‚çœ‹æ¬¡æ•°ï¼‰
   GET /movie/top_rated       # é«˜åˆ†ç”µå½±ï¼ˆè¯„åˆ†â‰¥7.0ï¼‰
   GET /movie/now_playing     # æ­£åœ¨çƒ­æ˜ ï¼ˆå½“å‰æ¡£æœŸï¼‰
   GET /movie/upcoming        # å³å°†ä¸Šæ˜ ï¼ˆæœªæ¥æ¡£æœŸï¼‰
   ```

2. **ç”µå½±è¯¦æƒ…ç±»**
   ```
   GET /movie/{id}                    # åŸºç¡€ä¿¡æ¯
   GET /movie/{id}/credits            # æ¼”èŒäººå‘˜ï¼ˆå‰10åï¼‰
   GET /movie/{id}/recommendations    # æ¨èç”µå½±ï¼ˆç®—æ³•ç”Ÿæˆï¼‰
   GET /movie/{id}/images             # å‰§ç…§é›†ï¼ˆå‰6å¼ ï¼‰
   GET /movie/{id}/reviews            # ç”¨æˆ·è¯„è®ºï¼ˆè‹±æ–‡ï¼‰
   GET /movie/{id}/videos             # é¢„å‘Šç‰‡ï¼ˆYouTube Keyï¼‰
   ```

3. **æœç´¢ä¸å‘ç°**
   ```
   GET /search/movie          # å…³é”®è¯æœç´¢
   GET /search/person         # å½±äººæœç´¢
   GET /discover/movie        # é«˜çº§ç­›é€‰ï¼ˆç±»å‹+åœ°åŒº+æ’åºï¼‰
   GET /genre/movie/list      # è·å–æ‰€æœ‰ç±»å‹
   ```

4. **å½±äººç›¸å…³**
   ```
   GET /person/popular             # çƒ­é—¨å½±äºº
   GET /person/{id}                # å½±äººè¯¦æƒ…
   GET /person/{id}/movie_credits # ä½œå“åˆ—è¡¨
   GET /person/{id}/tagged_images # å‰§ç…§åˆé›†
   ```

**æ•°æ®æ¨¡å‹è®¾è®¡**ï¼š
```dart
class Movie {
  final int id;                    // TMDb ID
  final String title;              // ä¸­æ–‡æ ‡é¢˜
  final String originalTitle;      // åŸå§‹æ ‡é¢˜
  final String posterPath;         // æµ·æŠ¥è·¯å¾„
  final String backdropPath;       // æ¨ªç‰ˆæµ·æŠ¥
  final double voteAverage;        // è¯„åˆ† 0-10
  final String releaseDate;        // ä¸Šæ˜ æ—¥æœŸ
  final String overview;           // å‰§æƒ…ç®€ä»‹
  final List<int> genreIds;        // ç±»å‹ ID åˆ—è¡¨
  final String tagline;            // å®£ä¼ è¯­
  final List<String> genres;       // ç±»å‹åç§°åˆ—è¡¨
  final List<String> countries;    // åˆ¶ç‰‡å›½å®¶
  final String director;           // å¯¼æ¼”å
  final int runtime;               // æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  
  // å·¥å‚æ–¹æ³•æ”¯æŒå¤šæ•°æ®æº
  factory Movie.fromJson(Map<String, dynamic> json) { }
  factory Movie.fromLocalJson(Map<String, dynamic> json) { }
}
```

#### 2.3.2 æœ¬åœ°æ•°æ®èµ„äº§

**å¥–é¡¹æ•°æ®**ï¼š
```
assets/awards/
â”œâ”€â”€ å¥¥æ–¯å¡_output_winner_nominees.json    # 95å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ æˆ›çº³_output_winner_nominees.json      # 76å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ æŸæ—_output_winner_nominees.json      # 73å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ é‡‘é¸¡å¥–_output_winner_nominees.json    # 36å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ é‡‘çˆµå¥–_output_winner_nominees.json    # 26å±Šå®Œæ•´æ•°æ®
â”œâ”€â”€ é‡‘åƒå¥–_output_winner_nominees.json    # 42å±Šå®Œæ•´æ•°æ®    
â””â”€â”€ â€¦â€¦
```

**æ•°æ®ç»“æ„**ï¼š
```json
{
  "award_name": "å¥¥æ–¯å¡",
  "year": 2024,
  "session": 95,
  "movies": [
    {
      "tmdb_id": 438631,
      "title": "Dune",
      "category": "æœ€ä½³å½±ç‰‡",
      "is_winner": true
    }
  ]
}
```

**å°è¯æ•°æ®**ï¼ˆåŒå±‚æ¶æ„ï¼‰ï¼š
1. **ç²¾é€‰å­—å¹•æ•°æ®**ï¼ˆ3.6MBï¼‰ï¼š33éƒ¨ç»å…¸ç”µå½±çš„ç²¾é€‰å°è¯
   ```json
   {
     "data": {
       "love": [
         {
           "subtitle_content": "I love you",
           "subtitle_content_zh": "æˆ‘çˆ±ä½ ",
           "start_time": "01:23:45",
           "end_time": "01:23:47",
           "tmdb": { "id": 550, "title": "Fight Club" }
         }
       ]
     }
   }
   ```

2. **å®Œæ•´å‰§æœ¬æ•°æ®**ï¼ˆ308MBï¼‰ï¼š300+ éƒ¨ç”µå½±çš„å®Œæ•´å‰§æœ¬
   ```json
   [
     {
       "script": "å®Œæ•´å‰§æœ¬æ–‡æœ¬...",
       "tmdb": { "id": 550, "title": "..." }
     }
   ]
   ```

**é™æ€èµ„æº**ï¼š
```
assets/images/
â”œâ”€â”€ genres/              # 19ç§ç”µå½±ç±»å‹èƒŒæ™¯å›¾
â”‚   â”œâ”€â”€ Action.jpg
â”‚   â”œâ”€â”€ Comedy.jpg
â”‚   â””â”€â”€ ...
â””â”€â”€ actors/              # å½±äººåˆ†ç±»å›¾
    â”œâ”€â”€ ç”·æ¼”å‘˜.jpg
    â”œâ”€â”€ å¥³æ¼”å‘˜.jpg
    â””â”€â”€ å¯¼æ¼”.jpg
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (Core Modules)

### 3.1 å››ç»´æœç´¢ç³»ç»Ÿ (`SearchPage`)

#### 3.1.1 æ¶æ„è®¾è®¡

**çŠ¶æ€ç®¡ç†**ï¼š
```dart
enum SearchType { movie, person, awards, quote }
enum SortOption { relevance, rating, date }

class _SearchPageState extends State<SearchPage> {
  SearchType _searchType = SearchType.movie;
  SortOption _sortOption = SortOption.relevance;
  
  List<Movie> _movies = [];
  List<Person> _people = [];
  List<QuoteMatch> _quoteMatches = [];
  Set<int> _winnerIds = {};  // è·å¥–ç”µå½±æ ‡è®°
}
```

**é¡µé¢ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppBar (æœç´¢æ¡† + ç±»å‹åˆ‡æ¢)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœªæœç´¢çŠ¶æ€ï¼š                         â”‚
â”‚  â”œâ”€ ç”µå½±ï¼šç±»å‹åˆ†ç±» + åœ°åŒºåˆ†ç±»         â”‚
â”‚  â”œâ”€ å½±äººï¼šç”·æ¼”å‘˜/å¥³æ¼”å‘˜/å¯¼æ¼”          â”‚
â”‚  â”œâ”€ å¥–é¡¹ï¼šå…­å¤§ç”µå½±èŠ‚å¡ç‰‡              â”‚
â”‚  â””â”€ å°è¯ï¼šå¤šè¯­è¨€æ°”æ³¡å±•ç¤º              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœç´¢ç»“æœçŠ¶æ€ï¼š                       â”‚
â”‚  â”œâ”€ ç”µå½±ï¼šç½‘æ ¼å±•ç¤º + æ’åºé€‰é¡¹         â”‚
â”‚  â”œâ”€ å½±äººï¼šåˆ—è¡¨ + å¤´åƒ                â”‚
â”‚  â”œâ”€ å¥–é¡¹ï¼šè·å¥–æ ‡è®° + ç”µå½±å¡ç‰‡         â”‚
â”‚  â””â”€ å°è¯ï¼šåŒè¯­æ˜¾ç¤º + æ—¶é—´è½´ + é«˜äº®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.2 ç”µå½±æœç´¢

**æ ¸å¿ƒé€»è¾‘**ï¼š
```dart
Future<void> _performSearch() async {
  final query = _controller.text.trim();
  if (query.isEmpty) return;
  
  setState(() => _isLoading = true);
  
  if (_searchType == SearchType.movie) {
    final results = await _tmdbService.searchMovies(query);
    setState(() => _movies = results);
    
    if (_sortOption != SortOption.relevance) {
      _applySort();  // äºŒæ¬¡æ’åº
    }
  }
}
```

**æ’åºç®—æ³•**ï¼š
```dart
void _applySort() {
  setState(() {
    switch (_sortOption) {
      case SortOption.rating:
        _movies.sort((a, b) => b.voteAverage.compareTo(a.voteAverage));
        break;
      case SortOption.date:
        _movies.sort((a, b) {
          if (a.releaseDate.isEmpty) return 1;
          if (b.releaseDate.isEmpty) return -1;
          return b.releaseDate.compareTo(a.releaseDate);
        });
        break;
      case SortOption.relevance:
        break;  // ä¿æŒ API è¿”å›çš„ç›¸å…³åº¦æ’åº
    }
  });
}
```

**åˆ†ç±»æµè§ˆ**ï¼ˆæœªæœç´¢çŠ¶æ€ï¼‰ï¼š
- **19ç§ç”µå½±ç±»å‹**ï¼šæ¯ç§é…å¤‡ç‰¹è‰²å­—ä½“å’ŒèƒŒæ™¯å›¾
- **6ä¸ªåœ°åŒº**ï¼šä¸­å›½ã€ç¾å›½ã€éŸ©å›½ã€æ—¥æœ¬ã€è‹±å›½ã€æ³•å›½ï¼Œå¸¦å›½æ——èƒŒæ™¯
- **ç‚¹å‡»è·³è½¬**ï¼šè°ƒç”¨ `discoverMovies(genreId: ?, region: ?)` è·å–ç­›é€‰ç»“æœ

#### 3.1.3 å½±äººæœç´¢

**æ•°æ®è·å–**ï¼š
```dart
Future<List<Person>> searchPeople(String query) async {
  final response = await _dio.get('/search/person', 
    queryParameters: {'query': query}
  );
  final results = response.data['results'] as List;
  return results.map((e) => Person.fromJson(e)).toList();
}
```

**çƒ­é—¨å¯¼æ¼”è·å–**ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰ï¼š
```dart
Future<List<Person>> getPopularDirectors() async {
  List<Person> directors = [];
  // æ‰«æå‰5é¡µçƒ­é—¨å½±äºº
  for (int i = 1; i <= 5; i++) {
    final people = await getPopularPeople(page: i);
    directors.addAll(
      people.where((p) => p.knownForDepartment == 'Directing')
    );
    if (directors.length >= 20) break;
  }
  return directors;
}
```

**UI å±•ç¤º**ï¼š
- åœ†å½¢å¤´åƒ + å§“å
- ç‚¹å‡»è·³è½¬è‡³å½±äººè¯¦æƒ…é¡µ
- é»˜è®¤é¡µå±•ç¤ºä¸‰ä¸ªåˆ†ç±»å¡ç‰‡ï¼šç”·æ¼”å‘˜(gender=2)ã€å¥³æ¼”å‘˜(gender=1)ã€å¯¼æ¼”(department=Directing)

#### 3.1.4 å¥–é¡¹æœç´¢ï¼ˆæœ¬åœ°æ•°æ®ï¼‰

**è‡ªç„¶è¯­è¨€è§£æ**ï¼š
```dart
Future<List<Award>> searchAwards(String query) async {
  // æ­£åˆ™åŒ¹é…ï¼š"ç¬¬77å±Šå¥¥æ–¯å¡"ã€"2024å¹´æŸæ—"ç­‰
  final sessionPattern = RegExp(
    r'(?:ç¬¬)?(\d+)(?:å±Š)?\s*([^\d\s]+)|([^\d\s]+)\s*(?:ç¬¬)?(\d+)(?:å±Š)?'
  );
  final yearPattern = RegExp(
    r'(\d{4})(?:å¹´)?\s*([^\d\s]+)|([^\d\s]+)\s*(\d{4})(?:å¹´)?'
  );
  
  String? awardName;
  int? session;
  int? year;
  
  // è§£ææŸ¥è¯¢è¯...
  final sessionMatch = sessionPattern.firstMatch(query);
  if (sessionMatch != null) {
    session = int.tryParse(sessionMatch.group(1) ?? '');
    awardName = _normalizeAwardName(sessionMatch.group(2) ?? '');
  }
  
  // åŠ è½½å¯¹åº”å¥–é¡¹æ•°æ®å¹¶ç­›é€‰
  final allYears = await getAwards(awardName);
  return session != null 
    ? allYears.where((a) => a.session == session).toList()
    : allYears.where((a) => a.year == year).toList();
}
```

**å¥–é¡¹åç§°æ ‡å‡†åŒ–**ï¼š
```dart
String? _normalizeAwardName(String input) {
  if (input.contains('å¥¥æ–¯å¡')) return 'å¥¥æ–¯å¡';
  if (input.contains('æŸæ—')) return 'æŸæ—ç”µå½±èŠ‚';
  if (input.contains('æˆ›çº³') || input.contains('åº·åŸ')) return 'æˆ›çº³ç”µå½±èŠ‚';
  if (input.contains('é‡‘é¸¡')) return 'é‡‘é¸¡å¥–';
  if (input.contains('é‡‘çˆµ')) return 'ä¸Šæµ·é‡‘çˆµå¥–';
  if (input.contains('é‡‘åƒ')) return 'é¦™æ¸¯é‡‘åƒå¥–';
  return null;
}
```

**è·å¥–æ ‡è®°**ï¼š
```dart
Set<int> _winnerIds = {};  // å­˜å‚¨è·å¥–ç”µå½±çš„ TMDb ID

// æœç´¢ç»“æœä¸­ï¼Œè·å¥–ç”µå½±å³ä¸Šè§’æ˜¾ç¤ºé‡‘è‰²å¥–æ¯å›¾æ ‡
if (_winnerIds.contains(movie.id))
  Positioned(
    top: 8, right: 8,
    child: Container(
      decoration: BoxDecoration(
        color: Colors.amber,
        shape: BoxShape.circle,
      ),
      child: Icon(Icons.emoji_events, color: Colors.white),
    ),
  )
```

#### 3.1.5 å°è¯æœç´¢ï¼ˆæ ¸å¿ƒäº®ç‚¹ï¼‰

**åŒå¼•æ“æ¶æ„**ï¼š

```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥å…³é”®è¯] --> B{å­—ç¬¦é•¿åº¦>=2?}
    B -->|æ˜¯| C[å¼•æ“1: ç²¾é€‰å­—å¹•æœç´¢]
    B -->|æ˜¯| D[å¼•æ“2: å‰§æœ¬æ·±åº¦æœç´¢]
    C --> E[åˆå¹¶ç»“æœ]
    D --> E
    E --> F[å»é‡æ’åº]
    F --> G[UIæ¸²æŸ“]
    B -->|å¦| C
```

**å¼•æ“1ï¼šç²¾é€‰å­—å¹•æœç´¢**ï¼ˆä¸»çº¿ç¨‹ï¼Œ<50msï¼‰
```dart
Future<List<QuoteMatch>> searchQuotes(String query) async {
  List<QuoteMatch> results = [];
  final lowerQuery = query.toLowerCase().trim();
  
  // éå†ç²¾é€‰æ•°æ®ï¼ˆ3.6MBï¼Œç»“æ„åŒ–ç´¢å¼•ï¼‰
  _subtitleData!.forEach((keyword, matches) {
    bool keywordMatches = keyword.toLowerCase().contains(lowerQuery);
    
    for (var item in matches) {
      String content = item['subtitle_content'] ?? '';
      String contentZh = item['subtitle_content_zh'] ?? '';
      
      if (keywordMatches || 
          content.toLowerCase().contains(lowerQuery) || 
          contentZh.contains(lowerQuery)) {
        results.add(QuoteMatch(
          movie: Movie.fromLocalJson(item['tmdb']),
          contentEn: content,
          contentZh: contentZh,
          startTime: item['start_time'],
          endTime: item['end_time'],
          keyword: keyword,
          source: 'subtitle',
        ));
      }
    }
  });
  
  return results;
}
```

**å¼•æ“2ï¼šå‰§æœ¬æ·±åº¦æœç´¢**ï¼ˆIsolate çº¿ç¨‹ï¼Œ1-2sï¼‰
```dart
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final token = RootIsolateToken.instance;
  return await compute(_parseAndSearchScripts, {
    'query': query, 
    'token': token
  });
}

static Future<List<QuoteMatch>> _parseAndSearchScripts(
  Map<String, dynamic> params
) async {
  // 1. åˆå§‹åŒ– Isolate æ¶ˆæ¯é€šé“
  final token = params['token'] as RootIsolateToken?;
  if (token != null) {
    BackgroundIsolateBinaryMessenger.ensureInitialized(token);
  }
  
  // 2. åŠ è½½å¤§æ–‡ä»¶ï¼ˆ308MBï¼‰
  final String jsonString = await rootBundle.loadString(
    'assets/scripts/movie_scripts_with_tmdb.json'
  );
  
  // 3. è§£æå¹¶æœç´¢
  final List<dynamic> data = jsonDecode(jsonString);
  final List<QuoteMatch> results = [];
  final lowerQuery = params['query'].toLowerCase();
  
  for (var item in data) {
    final script = (item['script'] as String).toLowerCase();
    if (script.contains(lowerQuery)) {
      // æå–ä¸Šä¸‹æ–‡ç‰‡æ®µï¼ˆå‰å50å­—ç¬¦ï¼‰
      final index = script.indexOf(lowerQuery);
      int start = (index - 50).clamp(0, script.length);
      int end = (index + lowerQuery.length + 50).clamp(0, script.length);
      String snippet = '...' + item['script'].substring(start, end) + '...';
      
      results.add(QuoteMatch(
        movie: Movie.fromLocalJson(item['tmdb']),
        matchedContent: snippet,
        keyword: params['query'],
        source: 'script'
      ));
    }
  }
  return results;
}
```

**å…³é”®è¯é«˜äº®ç®—æ³•**ï¼š
```dart
Widget _buildHighlightText(String text, String query, TextStyle style) {
  final lowerText = text.toLowerCase();
  final lowerQuery = query.toLowerCase();
  
  if (!lowerText.contains(lowerQuery)) {
    return Text(text, style: style);
  }
  
  final List<TextSpan> spans = [];
  int start = 0;
  int indexOfHighlight;
  
  // éå†æ‰€æœ‰åŒ¹é…ä½ç½®
  while ((indexOfHighlight = lowerText.indexOf(lowerQuery, start)) != -1) {
    // æ·»åŠ é«˜äº®å‰çš„æ™®é€šæ–‡æœ¬
    if (indexOfHighlight > start) {
      spans.add(TextSpan(
        text: text.substring(start, indexOfHighlight), 
        style: style
      ));
    }
    
    // æ·»åŠ é«˜äº®æ–‡æœ¬ï¼ˆçº¢è‰²åŠ ç²—ï¼‰
    spans.add(TextSpan(
      text: text.substring(
        indexOfHighlight, 
        indexOfHighlight + query.length
      ),
      style: style.copyWith(
        color: Colors.redAccent, 
        fontWeight: FontWeight.bold
      ),
    ));
    
    start = indexOfHighlight + query.length;
  }
  
  // æ·»åŠ å‰©ä½™æ–‡æœ¬
  if (start < text.length) {
    spans.add(TextSpan(text: text.substring(start), style: style));
  }
  
  return RichText(text: TextSpan(children: spans));
}
```

**æœç´¢ç»“æœå±•ç¤º**ï¼š
```dart
// å­—å¹•æ¥æºï¼šåŒè¯­ + æ—¶é—´è½´
if (match.source == 'subtitle') {
  Column(
    children: [
      // è‹±æ–‡å°è¯ï¼ˆæ–œä½“è¡¬çº¿å­—ä½“ï¼‰
      _buildHighlightText(
        match.contentEn, 
        query,
        GoogleFonts.notoSerif(fontSize: 15, fontStyle: FontStyle.italic)
      ),
      SizedBox(height: 8),
      // ä¸­æ–‡å°è¯
      _buildHighlightText(
        match.contentZh, 
        query,
        TextStyle(fontSize: 16, fontWeight: FontWeight.w500)
      ),
      // æ—¶é—´è½´æ ‡ç­¾
      Container(
        padding: EdgeInsets.symmetric(horizontal: 6, vertical: 2),
        decoration: BoxDecoration(
          color: Colors.grey[200],
          borderRadius: BorderRadius.circular(4),
        ),
        child: Text(
          '${match.startTime} â€” ${match.endTime}',
          style: TextStyle(fontSize: 11, fontFamily: 'monospace')
        ),
      )
    ]
  )
}

// å‰§æœ¬æ¥æºï¼šä¸Šä¸‹æ–‡ç‰‡æ®µ
else {
  _buildHighlightText(
    match.matchedContent, 
    query,
    GoogleFonts.notoSerif(fontSize: 15, height: 1.6)
  )
}
```

**æ€§èƒ½ä¼˜åŒ–æªæ–½**ï¼š
1. **åˆ†å±‚åŠ è½½**ï¼šä¼˜å…ˆåŠ è½½å°æ–‡ä»¶ï¼Œé¿å…å¯åŠ¨æ—¶é•¿æ—¶é—´é˜»å¡
2. **å»¶è¿Ÿè§¦å‘**ï¼šåªæœ‰æŸ¥è¯¢è¯é•¿åº¦â‰¥2æ—¶æ‰å¯åŠ¨æ·±åº¦æœç´¢
3. **ç»“æœé™åˆ¶**ï¼šæ¯ä¸ªæ•°æ®æºæœ€å¤šè¿”å›50æ¡ç»“æœ
4. **å¼‚æ­¥åˆå¹¶**ï¼šä¸¤ä¸ªå¼•æ“å¹¶è¡Œæ‰§è¡Œï¼Œä½¿ç”¨ `Future.wait()` ç­‰å¾…
5. **UI åé¦ˆ**ï¼šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ï¼Œå‘ŠçŸ¥ç”¨æˆ·æ­£åœ¨æœç´¢

### 3.2 ç”µå½±è¯¦æƒ…é¡µ (`MovieDetailPage`)

#### 3.2.1 æ²‰æµ¸å¼ UI è®¾è®¡

**åŠ¨æ€ AppBar é€æ˜åº¦**ï¼š
```dart
final ScrollController _scrollController = ScrollController();
double _appBarOpacity = 0.0;

@override
void initState() {
  super.initState();
  _scrollController.addListener(() {
    double offset = _scrollController.offset;
    double opacity = (offset / 200).clamp(0.0, 1.0);
    if (opacity != _appBarOpacity) {
      setState(() => _appBarOpacity = opacity);
    }
  });
}

// AppBar èƒŒæ™¯è‰²éšæ»šåŠ¨æ¸å˜
AppBar(
  backgroundColor: Colors.black.withOpacity(_appBarOpacity * 0.8),
  title: _appBarOpacity > 0.8 
    ? Text(movie.title) 
    : null,  // é¡¶éƒ¨æ—¶éšè—æ ‡é¢˜
)
```

**æ¯›ç»ç’ƒèƒŒæ™¯æ•ˆæœ**ï¼š
```dart
Stack(
  children: [
    // 1. èƒŒæ™¯ï¼šæ¨¡ç³Šçš„æµ·æŠ¥
    Positioned.fill(
      child: CachedNetworkImage(
        imageUrl: movie.fullPosterUrl,
        fit: BoxFit.cover,
      )
    ),
    // 2. æ¯›ç»ç’ƒæ»¤é•œ
    Positioned.fill(
      child: BackdropFilter(
        filter: ImageFilter.blur(sigmaX: 30, sigmaY: 30),
        child: Container(color: Colors.black.withOpacity(0.3)),
      )
    ),
    // 3. å†…å®¹å±‚
    SingleChildScrollView(child: ...)
  ]
)
```

**Hero åŠ¨ç”»è¿‡æ¸¡**ï¼š
```dart
// åˆ—è¡¨é¡µ
Hero(
  tag: 'detail_poster_${movie.id}',
  child: CachedNetworkImage(imageUrl: movie.fullPosterUrl)
)

// è¯¦æƒ…é¡µï¼ˆç›¸åŒ tagï¼‰
Hero(
  tag: 'detail_poster_${movie.id}',
  child: Container(
    width: 140,
    height: 210,
    decoration: BoxDecoration(
      image: DecorationImage(image: CachedNetworkImageProvider(...))
    )
  )
)
```

#### 3.2.2 æ•°æ®åŠ è½½ç­–ç•¥

**å¹¶è¡Œè¯·æ±‚ä¼˜åŒ–**ï¼š
```dart
void _loadExtraData() async {
  // ä½¿ç”¨ Future.wait å¹¶è¡Œå‘èµ·å¤šä¸ªè¯·æ±‚
  final results = await Future.wait([
    _tmdbService.getMovieDetail(_movie.id),       // å®Œæ•´è¯¦æƒ…
    _tmdbService.getMovieCredits(_movie.id),      // æ¼”èŒäººå‘˜
    _tmdbService.getMovieRecommendations(_movie.id), // æ¨è
    _tmdbService.getMovieImages(_movie.id),       // å‰§ç…§
    _tmdbService.getMovieReviews(_movie.id),      // è¯„è®º
    _youTubeService.searchVideo(_movie.title),    // YouTube è§†é¢‘
  ]);
  
  setState(() {
    _movie = results[0] as Movie;
    _cast = results[1] as List<Cast>;
    _recommendations = results[2] as List<Movie>;
    _images = results[3] as List<String>;
    _reviews = results[4] as List<Review>;
    _videoKey = results[5] as String?;
  });
}
```

**çŠ¶æ€åŒæ­¥**ï¼š
```dart
void _checkStatus() async {
  // å¹¶è¡ŒæŸ¥è¯¢æœ¬åœ°çŠ¶æ€
  final results = await Future.wait([
    _storageService.isFavorite(_movie.id),
    _storageService.getWatchStatus(_movie.id),
    _storageService.getProgress(_movie.id),
    _storageService.getNote(_movie.id),
  ]);
  
  setState(() {
    _isFavorite = results[0] as bool;
    _watchStatus = results[1] as WatchStatus;
    _progress = results[2] as double;
    _userNote = results[3] as String?;
  });
}
```

#### 3.2.3 è§‚å½±çŠ¶æ€ç®¡ç†

**ä¸‰æ€çŠ¶æ€æœº**ï¼š
```dart
enum WatchStatus { none, wantToWatch, watching, watched }

void _changeWatchStatus(WatchStatus status) async {
  await _storageService.setWatchStatus(_movie, status);
  setState(() => _watchStatus = status);
}

// UI å±•ç¤º
Row(
  children: [
    _buildStatusButton(WatchStatus.wantToWatch, 'æƒ³çœ‹', 
      Icons.bookmark_border, Icons.bookmark),
    _buildStatusButton(WatchStatus.watching, 'æ­£åœ¨çœ‹', 
      Icons.play_circle_outline, Icons.play_circle_fill),
    _buildStatusButton(WatchStatus.watched, 'çœ‹è¿‡', 
      Icons.check_circle_outline, Icons.check_circle),
  ]
)
```

**è§‚çœ‹è¿›åº¦è¿½è¸ª**ï¼š
```dart
// åªåœ¨"åœ¨çœ‹"çŠ¶æ€æ˜¾ç¤ºè¿›åº¦æ¡
if (_watchStatus == WatchStatus.watching) 
  Column(
    children: [
      Text('è§‚çœ‹è¿›åº¦: ${(_progress * 100).toInt()}%'),
      Slider(
        value: _progress,
        onChanged: (value) async {
          setState(() => _progress = value);
          await _storageService.setProgress(_movie.id, value);
        },
      )
    ]
  )
```

#### 3.2.4 è‡ªå®šä¹‰ç‰‡å•

**åˆ›å»ºç‰‡å•å¯¹è¯æ¡†**ï¼š
```dart
void _showAddToListDialog() async {
  final lists = await _storageService.getCustomListNames();
  
  showModalBottomSheet(
    context: context,
    builder: (context) => StatefulBuilder(
      builder: (context, setModalState) {
        return Container(
          child: Column(
            children: [
              // ç°æœ‰ç‰‡å•åˆ—è¡¨
              Expanded(
                child: ListView.builder(
                  itemCount: lists.length,
                  itemBuilder: (context, index) {
                    return ListTile(
                      title: Text(lists[index]),
                      trailing: Icon(Icons.add_circle_outline),
                      onTap: () async {
                        await _storageService.addMovieToCustomList(
                          lists[index], _movie
                        );
                        Navigator.pop(context);
                      },
                    );
                  },
                ),
              ),
              // æ–°å»ºç‰‡å•
              TextField(
                controller: textController,
                decoration: InputDecoration(hintText: 'ç‰‡å•åç§°'),
              ),
              TextField(
                controller: descController,
                decoration: InputDecoration(hintText: 'ä¸€å¥è¯ç®€ä»‹'),
              ),
              ElevatedButton(
                child: Text('åˆ›å»º'),
                onPressed: () async {
                  await _storageService.createCustomList(
                    textController.text, 
                    description: descController.text
                  );
                  // åˆ·æ–°åˆ—è¡¨
                  final newLists = await _storageService.getCustomListNames();
                  setModalState(() {
                    lists.clear();
                    lists.addAll(newLists);
                  });
                },
              )
            ],
          ),
        );
      }
    ),
  );
}
```

#### 3.2.5 ç¬”è®°ç³»ç»Ÿ

**å¯Œæ–‡æœ¬ç¼–è¾‘**ï¼š
```dart
void _showNoteDialog() {
  final noteController = TextEditingController(text: _userNote);
  
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('æˆ‘çš„è§‚å½±ç¬”è®°'),
      content: TextField(
        controller: noteController,
        maxLines: 5,
        decoration: InputDecoration(
          hintText: 'è®°å½•ä¸‹è¿™ä¸€åˆ»çš„æ„Ÿå—...',
          filled: true,
          fillColor: Colors.grey[100],
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide.none,
          ),
        ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('å–æ¶ˆ'),
        ),
        ElevatedButton(
          onPressed: () async {
            await _storageService.saveNote(_movie, noteController.text);
            setState(() => _userNote = noteController.text);
            Navigator.pop(context);
          },
          child: Text('ä¿å­˜'),
        ),
      ],
    ),
  );
}
```

**ç¬”è®°å±•ç¤ºå¡ç‰‡**ï¼š
```dart
Container(
  padding: EdgeInsets.all(20),
  decoration: BoxDecoration(
    color: Color(0xFFFFF8E1),  // æš–é»„è‰²èƒŒæ™¯
    borderRadius: BorderRadius.circular(16),
    border: Border.all(color: Color(0xFFFFECB3)),
    boxShadow: [
      BoxShadow(
        color: Colors.black.withOpacity(0.05),
        blurRadius: 10,
        offset: Offset(0, 5)
      )
    ],
  ),
  child: Column(
    children: [
      Row(
        children: [
          Icon(Icons.format_quote_rounded, color: Colors.amber),
          Text('Review', style: TextStyle(color: Colors.amber))
        ]
      ),
      Text(
        _userNote!,
        style: TextStyle(
          fontSize: 15,
          height: 1.6,
          color: Colors.brown[800],
          fontStyle: FontStyle.italic
        )
      ),
      TextButton.icon(
        onPressed: _showNoteDialog,
        icon: Icon(Icons.edit, size: 14),
        label: Text('ç¼–è¾‘'),
      )
    ],
  ),
)
```

#### 3.2.6 å¤šåª’ä½“å±•ç¤º

**é¢„å‘Šç‰‡æ’­æ”¾**ï¼š
```dart
ElevatedButton.icon(
  onPressed: () {
    if (_videoKey != null) {
      Navigator.push(
        context,
        MaterialPageRoute(
          builder: (context) => VideoPlayerPage(
            videoId: _videoKey!,
            title: movie.title,
          ),
        ),
      );
    } else {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('æš‚æ— é¢„å‘Šç‰‡èµ„æº')),
      );
    }
  },
  style: ElevatedButton.styleFrom(
    backgroundColor: _videoKey != null 
      ? Color(0xFFFF5252) 
      : Colors.grey,
    foregroundColor: Colors.white,
    elevation: 4,
  ),
  icon: Icon(Icons.play_arrow_rounded),
  label: Text(_videoKey != null ? 'ç›¸å…³è§†é¢‘' : 'æš‚æ— èµ„æº'),
)
```

**å‰§ç…§ç›¸å†Œ**ï¼ˆæ”¯æŒæ‰‹åŠ¿ç¼©æ”¾ï¼‰ï¼š
```dart
void _showFullImage(BuildContext context, int initialIndex) {
  PageController pageController = PageController(initialPage: initialIndex);
  
  showDialog(
    context: context,
    builder: (context) => Dialog(
      backgroundColor: Colors.transparent,
      insetPadding: EdgeInsets.zero,
      child: Stack(
        children: [
          // å¯æ»‘åŠ¨çš„å›¾ç‰‡æµè§ˆå™¨
          PageView.builder(
            controller: pageController,
            itemCount: _images.length,
            itemBuilder: (context, index) {
              return InteractiveViewer(  // æ”¯æŒåŒæŒ‡ç¼©æ”¾
                child: CachedNetworkImage(
                  imageUrl: _images[index],
                  fit: BoxFit.contain
                ),
              );
            },
          ),
          // å…³é—­æŒ‰é’®
          Positioned(
            top: 40, right: 20,
            child: IconButton(
              icon: Icon(Icons.close, color: Colors.white, size: 30),
              onPressed: () => Navigator.pop(context),
            )
          ),
          // é¡µç æŒ‡ç¤ºå™¨
          Positioned(
            bottom: 40,
            child: Container(
              padding: EdgeInsets.symmetric(horizontal: 12, vertical: 6),
              decoration: BoxDecoration(
                color: Colors.black54,
                borderRadius: BorderRadius.circular(20),
              ),
              child: SmoothPageIndicator(
                controller: pageController,
                count: _images.length,
                effect: ScrollingDotsEffect(
                  activeDotColor: Colors.white,
                  dotColor: Colors.grey,
                ),
              ),
            ),
          ),
        ],
      ),
    ),
  );
}
```

### 3.3 ä¸ªäººä¸»é¡µ (`ProfilePage`)

#### 3.3.1 ç”¨æˆ·ç³»ç»Ÿ

**æ³¨å†Œç™»å½•æµç¨‹**ï¼š
```dart
Future<void> register(String username, String password) async {
  final prefs = await SharedPreferences.getInstance();
  final dbJson = prefs.getString(_usersDbKey);
  Map<String, dynamic> db = dbJson != null ? jsonDecode(dbJson) : {};
  
  // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
  if (db.values.any((u) => u['username'] == username)) {
    throw Exception('ç”¨æˆ·åå·²å­˜åœ¨');
  }
  
  // åˆ›å»ºæ–°ç”¨æˆ·
  final newUser = User(
    id: DateTime.now().millisecondsSinceEpoch.toString(),
    username: username,
    password: password,
    avatar: 'https://i.pravatar.cc/150?img=${username.length % 70}',
  );
  
  // ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
  db[newUser.id] = newUser.toJson();
  await prefs.setString(_usersDbKey, jsonEncode(db));
  await prefs.setString(_userKey, jsonEncode(newUser.toJson()));
}
```

**å¤´åƒç®¡ç†**ï¼š
```dart
void _changeAvatar() {
  showModalBottomSheet(
    context: context,
    builder: (context) => Container(
      child: Column(
        children: [
          // ä»ç›¸å†Œé€‰æ‹©
          ListTile(
            leading: Icon(Icons.photo_library),
            title: Text('ä»ç›¸å†Œé€‰æ‹©'),
            onTap: () async {
              final XFile? image = await _picker.pickImage(
                source: ImageSource.gallery
              );
              if (image != null) {
                final updatedUser = _currentUser!.copyWith(
                  avatar: image.path
                );
                await _storageService.updateUser(updatedUser);
                setState(() => _currentUser = updatedUser);
              }
            },
          ),
          // é€‰æ‹©é»˜è®¤å¤´åƒ
          Expanded(
            child: GridView.builder(
              gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                crossAxisCount: 4
              ),
              itemCount: 8,
              itemBuilder: (context, index) {
                final url = 'https://i.pravatar.cc/150?img=${index * 5 + 10}';
                return GestureDetector(
                  onTap: () async {
                    final updatedUser = _currentUser!.copyWith(avatar: url);
                    await _storageService.updateUser(updatedUser);
                    setState(() => _currentUser = updatedUser);
                    Navigator.pop(context);
                  },
                  child: CircleAvatar(backgroundImage: NetworkImage(url)),
                );
              },
            ),
          )
        ],
      ),
    ),
  );
}
```

#### 3.3.2 è§‚å½±çƒ­åº¦å›¾ (`ContributionHeatmap`)

**æ•°æ®ç»“æ„**ï¼š
```dart
Map<DateTime, int> _heatmapData = {};

// ä»æ—¶é—´æˆ³æ„å»ºçƒ­åº¦å›¾
final timestamps = await _storageService.getAllTimestamps();
timestamps.forEach((key, value) {
  final date = DateTime.fromMillisecondsSinceEpoch(value);
  final normalizedDate = DateTime(date.year, date.month, date.day);
  heatmapData[normalizedDate] = (heatmapData[normalizedDate] ?? 0) + 1;
});
```

**ç½‘æ ¼å¸ƒå±€ç®—æ³•**ï¼š
```dart
Widget _buildGrid(DateTime startDate, int columns, double boxSize) {
  return Row(
    children: List.generate(columns, (colIndex) {
      final weekStart = startDate.add(Duration(days: colIndex * 7));
      return Column(
        children: List.generate(7, (rowIndex) {
          final date = weekStart.add(Duration(days: rowIndex));
          final normalizedDate = DateTime(date.year, date.month, date.day);
          final count = data[normalizedDate] ?? 0;
          
          return Container(
            width: boxSize,
            height: boxSize,
            margin: EdgeInsets.all(1.5),
            decoration: BoxDecoration(
              color: _getColor(count),
              borderRadius: BorderRadius.circular(1.5),
            ),
            child: Tooltip(
              message: '${DateFormat('yyyy-MM-dd').format(date)}: $count',
            ),
          );
        }),
      );
    }),
  );
}
```

**é¢œè‰²æ˜ å°„**ï¼š
```dart
Color _getColor(int count) {
  if (count == 0) return Color(0xFFEEEEEE);    // æµ…ç°
  if (count == 1) return Color(0xFFFFE0B2);    // æµ…æ©™
  if (count <= 3) return Color(0xFFFFB74D);    // ä¸­æ©™
  if (count <= 5) return Color(0xFFFF9800);    // æ·±æ©™
  return Color(0xFFE65100);                     // çº¢æ©™
}
```

#### 3.3.3 ç»Ÿè®¡æ•°æ®å±•ç¤º

**æ•°æ®æ±‡æ€»**ï¼š
```dart
int _watchedCount = 0;      // çœ‹è¿‡
int _wantCount = 0;         // æƒ³çœ‹
int _watchingCount = 0;     // åœ¨çœ‹
int _favoriteCount = 0;     // æ”¶è—
int _commentCount = 0;      // è¯„è®º
int _listCount = 0;         // ç‰‡å•

void _loadData() async {
  final results = await Future.wait([
    _storageService.getMoviesByStatus(WatchStatus.watched),
    _storageService.getMoviesByStatus(WatchStatus.wantToWatch),
    _storageService.getMoviesByStatus(WatchStatus.watching),
    _storageService.getFavorites(),
    _storageService.getCommentedMovies(),
    _storageService.getCustomListNames(),
  ]);
  
  setState(() {
    _watchedCount = results[0].length;
    _wantCount = results[1].length;
    _watchingCount = results[2].length;
    _favoriteCount = results[3].length;
    _commentCount = results[4].length;
    _listCount = results[5].length;
  });
}
```

### 3.3 æ•°æ®æœåŠ¡å±‚ (`Services`)
- **`TMDbService`**: å°è£…æ‰€æœ‰å¤–éƒ¨ API è°ƒç”¨ï¼Œå¤„ç† JSON åºåˆ—åŒ–ä¸å¼‚å¸¸ã€‚
- **`StorageService`**: å°è£…æœ¬åœ°å­˜å‚¨é€»è¾‘ï¼Œç®¡ç† JSON æ ¼å¼çš„ç”¨æˆ·æ•°æ®ï¼ˆå¦‚è‡ªå®šä¹‰ç‰‡å•ï¼‰ã€‚
- **`QuoteService`**: ä¸“ç”¨äºå¤„ç†å°è¯æ£€ç´¢ã€‚
  - *ä¼˜åŒ–ç­–ç•¥*: å®ç°äº† `compute` å‡½æ•°è°ƒç”¨ï¼Œå°†è€—æ—¶çš„ JSON è§£æå’Œå­—ç¬¦ä¸²åŒ¹é…ä»»åŠ¡æ”¾å…¥åå°éš”ç¦»çº¿ç¨‹ï¼Œè§£å†³äº†å¤§æ–‡ä»¶æœç´¢å¯¼è‡´çš„ç•Œé¢å†»ç»“é—®é¢˜ã€‚
  - *æ•°æ®æ˜ å°„*: å®ç°äº†ä»æœ¬åœ°æ•°æ®é›† ID (`tmdb_id`) åˆ°åœ¨çº¿ API æ•°æ®çš„æ˜ å°„ï¼Œç¡®ä¿æœ¬åœ°æœç´¢ç»“æœèƒ½è·³è½¬è‡³å®Œæ•´çš„è¯¦æƒ…é¡µã€‚

---

## 4. è¯¦ç»†æŠ€æœ¯å®ç° (Technical Implementation Details)

### 4.1 åº”ç”¨æ¶æ„è®¾è®¡

#### 4.1.1 ä¸»åº”ç”¨å…¥å£ (`main.dart`)
```dart
class MovieMindApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      theme: ThemeData(
        scaffoldBackgroundColor: const Color(0xFFF5F5F7),
        primaryColor: Colors.black,
        useMaterial3: true,
        fontFamily: 'San Francisco',
      ),
      home: const MainScreen(),
    );
  }
}
```

åº”ç”¨é‡‡ç”¨ **Material Design 3** è®¾è®¡è¯­è¨€ï¼Œé…ç½®äº†ç»Ÿä¸€çš„ä¸»é¢˜è‰²å½©æ–¹æ¡ˆï¼š
- **èƒŒæ™¯è‰²**: `#F5F5F7` (è‹¹æœé£æ ¼çš„æµ…ç°è‰²)
- **ä¸»è‰²è°ƒ**: é»‘è‰²ç³»ï¼Œè¥é€ ä¸“ä¸šç”µå½±åº”ç”¨çš„è§†è§‰æ„Ÿå—
- **å­—ä½“**: San Francisco ç³»ç»Ÿå­—ä½“ï¼Œç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§

#### 4.1.2 åº•éƒ¨å¯¼èˆªæ¶æ„
```dart
class MainScreen extends StatefulWidget {
  int _currentIndex = 0;
  final List<Widget> _pages = [
    const HomeTab(),      // é¦–é¡µæ¨è
    const SearchPage(),   // æœç´¢é¡µé¢
    const MyMoviesPage(), // æˆ‘çš„ç”µå½±
    const ProfilePage(),  // ä¸ªäººèµ„æ–™
  ];
}
```

é‡‡ç”¨ `PageView` + `BottomNavigationBar` çš„ç»å…¸æ¶æ„ï¼Œæ”¯æŒæ‰‹åŠ¿æ»‘åŠ¨åˆ‡æ¢é¡µé¢ã€‚

### 4.2 æ•°æ®å±‚å®ç°

#### 4.2.1 TMDb API æœåŠ¡ (`TMDbService`)
```dart
class TMDbService {
  static const String apiKey = '9d5a5768705c19907badb63abbb20821';
  static const String baseUrl = 'https://api.themoviedb.org/3';
  
  late final Dio _dio;
  
  TMDbService() {
    _dio = Dio(BaseOptions(
      baseUrl: baseUrl,
      connectTimeout: const Duration(seconds: 5),
      receiveTimeout: const Duration(seconds: 5),
      queryParameters: {
        'api_key': apiKey,
        'language': 'zh-CN',
      },
    ));
    _dio.interceptors.add(LogInterceptor());
  }
}
```

**æ ¸å¿ƒç‰¹æ€§**:
- **ç»Ÿä¸€é…ç½®**: æ‰€æœ‰è¯·æ±‚è‡ªåŠ¨æºå¸¦ API Key å’Œä¸­æ–‡è¯­è¨€å‚æ•°
- **è¶…æ—¶æ§åˆ¶**: è¿æ¥å’Œæ¥æ”¶è¶…æ—¶å‡è®¾ä¸º 5 ç§’ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
- **æ—¥å¿—æ‹¦æˆª**: å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- **é”™è¯¯å¤„ç†**: å®ç°äº†å®Œæ•´çš„å¼‚å¸¸æ•è·æœºåˆ¶

**ä¸»è¦ API å°è£…**:
```dart
// ç”µå½±ç›¸å…³
Future<List<Movie>> getNowPlaying() => _getMovies('/movie/now_playing');
Future<List<Movie>> getPopular() => _getMovies('/movie/popular');
Future<Movie?> getMovieDetail(int movieId) async { /* ... */ }

// æœç´¢ç›¸å…³
Future<List<Movie>> searchMovies(String query) async { /* ... */ }
Future<List<Person>> searchPeople(String query) async { /* ... */ }

// å‘ç°ç›¸å…³
Future<List<Movie>> discoverMovies({int? genreId, String? region}) async { /* ... */ }
```

#### 4.2.2 æœ¬åœ°å­˜å‚¨æœåŠ¡ (`StorageService`)
```dart
class StorageService {
  static const String _favoritesKey = 'favorites';
  static const String _watchStatusKey = 'watch_status';
  static const String _notesKey = 'notes';
  
  Future<bool> toggleFavorite(Movie movie) async {
    final prefs = await SharedPreferences.getInstance();
    List<String> favorites = prefs.getStringList(_favoritesKey) ?? [];
    
    final movieJson = jsonEncode(movie.toJson());
    if (favorites.contains(movieJson)) {
      favorites.remove(movieJson);
      await prefs.setStringList(_favoritesKey, favorites);
      return false;
    } else {
      favorites.add(movieJson);
      await prefs.setStringList(_favoritesKey, favorites);
      return true;
    }
  }
}
```

**å­˜å‚¨ç­–ç•¥**:
- **JSON åºåˆ—åŒ–**: å°†å¤æ‚å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²å­˜å‚¨
- **åˆ†ç±»å­˜å‚¨**: ä¸åŒç±»å‹æ•°æ®ä½¿ç”¨ä¸åŒçš„ Key è¿›è¡Œéš”ç¦»
- **å¼‚æ­¥æ“ä½œ**: æ‰€æœ‰å­˜å‚¨æ“ä½œå‡ä¸ºå¼‚æ­¥ï¼Œé¿å…é˜»å¡ UI çº¿ç¨‹

### 4.3 å°è¯æœç´¢æ ¸å¿ƒå®ç°

#### 4.3.1 QuoteService æ¶æ„
```dart
class QuoteService {
  static final QuoteService _instance = QuoteService._internal();
  factory QuoteService() => _instance;
  
  Map<String, List<dynamic>>? _subtitleData;
  
  Future<void> init() async {
    if (_subtitleData != null) return;
    
    try {
      final String subtitleJson = await rootBundle.loadString(
        'assets/scripts/33_subtitles_data_with_tmdb.json'
      );
      final Map<String, dynamic> parsed = jsonDecode(subtitleJson);
      if (parsed['data'] != null) {
        _subtitleData = Map<String, List<dynamic>>.from(parsed['data']);
      }
    } catch (e) {
      debugPrint('Error loading subtitles: $e');
      _subtitleData = {};
    }
  }
}
```

**å•ä¾‹æ¨¡å¼**: ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ª QuoteService å®ä¾‹ï¼Œé¿å…é‡å¤åŠ è½½æ•°æ®ã€‚

#### 4.3.2 åŒå¼•æ“æœç´¢ç®—æ³•
```dart
Future<List<QuoteMatch>> searchQuotes(String query) async {
  List<QuoteMatch> results = [];
  final lowerQuery = query.toLowerCase().trim();

  // å¼•æ“1: ç²¾é€‰å­—å¹•æ•°æ®æœç´¢ (å¿«é€Ÿ)
  if (_subtitleData != null) {
    _subtitleData!.forEach((keyword, matches) {
      bool keywordMatches = keyword.toLowerCase().contains(lowerQuery);
      
      for (var item in matches) {
        String content = item['subtitle_content'] ?? '';
        String contentZh = item['subtitle_content_zh'] ?? '';
        
        if (keywordMatches || 
            content.toLowerCase().contains(lowerQuery) || 
            contentZh.contains(lowerQuery)) {
          // æ„å»ºåŒ¹é…ç»“æœ
          results.add(QuoteMatch(/* ... */));
        }
      }
    });
  }

  // å¼•æ“2: å‰§æœ¬æ•°æ®æœç´¢ (æ·±åº¦)
  if (query.length >= 2) {
    final scriptResults = await _searchScriptsInIsolate(query);
    results.addAll(scriptResults);
  }

  return results;
}
```

**æœç´¢ç­–ç•¥**:
1. **ä¼˜å…ˆçº§æœç´¢**: å…ˆæœç´¢å°æ–‡ä»¶ (3.6MB)ï¼Œå†æœç´¢å¤§æ–‡ä»¶ (308MB)
2. **æ¡ä»¶è§¦å‘**: åªæœ‰æŸ¥è¯¢è¯é•¿åº¦ â‰¥2 æ—¶æ‰å¯åŠ¨æ·±åº¦æœç´¢
3. **å¤šå­—æ®µåŒ¹é…**: åŒæ—¶åŒ¹é…å…³é”®è¯ã€è‹±æ–‡å†…å®¹ã€ä¸­æ–‡å†…å®¹

#### 4.3.3 Isolate å¹¶å‘å¤„ç†
```dart
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final token = RootIsolateToken.instance;
  return await compute(_parseAndSearchScripts, {
    'query': query, 
    'token': token
  });
}

static Future<List<QuoteMatch>> _parseAndSearchScripts(
  Map<String, dynamic> params
) async {
  final query = params['query'] as String;
  final token = params['token'] as RootIsolateToken?;
  
  if (token != null) {
    BackgroundIsolateBinaryMessenger.ensureInitialized(token);
  }

  try {
    final String jsonString = await rootBundle.loadString(
      'assets/scripts/movie_scripts_with_tmdb.json'
    );
    final List<dynamic> data = jsonDecode(jsonString);
    // æ‰§è¡Œæœç´¢é€»è¾‘...
  } catch (e) {
    debugPrint('Isolate search error: $e');
    return [];
  }
}
```

**å¹¶å‘ä¼˜åŒ–**:
- **Isolate éš”ç¦»**: å¤§æ–‡ä»¶å¤„ç†åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­è¿›è¡Œ
- **Token ä¼ é€’**: ç¡®ä¿ Isolate ä¸­èƒ½æ­£å¸¸è®¿é—® Flutter èµ„æº
- **å¼‚å¸¸éš”ç¦»**: Isolate ä¸­çš„å¼‚å¸¸ä¸ä¼šå½±å“ä¸»çº¿ç¨‹

### 4.4 UI å±‚å…³é”®å®ç°

#### 4.4.1 å…³é”®è¯é«˜äº®ç®—æ³•
```dart
Widget _buildHighlightText(String text, String query, TextStyle style) {
  if (query.isEmpty) return Text(text, style: style);

  final lowerText = text.toLowerCase();
  final lowerQuery = query.toLowerCase();
  if (!lowerText.contains(lowerQuery)) return Text(text, style: style);

  final List<TextSpan> spans = [];
  int start = 0;
  int indexOfHighlight;

  while ((indexOfHighlight = lowerText.indexOf(lowerQuery, start)) != -1) {
    // æ·»åŠ é«˜äº®å‰çš„æ™®é€šæ–‡æœ¬
    if (indexOfHighlight > start) {
      spans.add(TextSpan(
        text: text.substring(start, indexOfHighlight), 
        style: style
      ));
    }
    
    // æ·»åŠ é«˜äº®æ–‡æœ¬
    spans.add(TextSpan(
      text: text.substring(indexOfHighlight, indexOfHighlight + query.length),
      style: style.copyWith(
        color: Colors.redAccent, 
        fontWeight: FontWeight.bold
      ),
    ));
    
    start = indexOfHighlight + query.length;
  }

  // æ·»åŠ å‰©ä½™çš„æ™®é€šæ–‡æœ¬
  if (start < text.length) {
    spans.add(TextSpan(text: text.substring(start), style: style));
  }

  return RichText(text: TextSpan(children: spans));
}
```

**ç®—æ³•ç‰¹ç‚¹**:
- **å¤§å°å†™ä¸æ•æ„Ÿ**: ä½¿ç”¨ `toLowerCase()` è¿›è¡ŒåŒ¹é…
- **å¤šæ¬¡åŒ¹é…**: æ”¯æŒåŒä¸€æ–‡æœ¬ä¸­å¤šä¸ªå…³é”®è¯é«˜äº®
- **æ ·å¼ä¿æŒ**: ä¿æŒåŸæœ‰æ–‡æœ¬æ ·å¼ï¼Œä»…å¯¹åŒ¹é…éƒ¨åˆ†åº”ç”¨é«˜äº®

#### 4.4.2 è§‚å½±çƒ­åº¦å›¾ç»„ä»¶ (`HeatmapGrid`)
```dart
class ContributionHeatmap extends StatelessWidget {
  final Map<DateTime, int> data;
  
  Widget _buildGrid(DateTime startDate, int columns, double boxSize, double margin) {
    return Row(
      children: List.generate(columns, (colIndex) {
        final weekStart = startDate.add(Duration(days: colIndex * 7));
        return Column(
          children: List.generate(7, (rowIndex) {
            final date = weekStart.add(Duration(days: rowIndex));
            final count = data[DateTime(date.year, date.month, date.day)] ?? 0;
            
            return Container(
              width: boxSize,
              height: boxSize,
              margin: EdgeInsets.all(margin),
              decoration: BoxDecoration(
                color: _getColor(count),
                borderRadius: BorderRadius.circular(1.5),
              ),
            );
          }),
        );
      }),
    );
  }
  
  Color _getColor(int count) {
    if (count == 0) return const Color(0xFFEEEEEE);
    if (count == 1) return const Color(0xFFFFE0B2);
    if (count <= 3) return const Color(0xFFFFB74D);
    if (count <= 5) return const Color(0xFFFF9800);
    return const Color(0xFFE65100);
  }
}
```

**å®ç°ç‰¹ç‚¹**:
- **GitHub é£æ ¼**: æ¨¡ä»¿ GitHub è´¡çŒ®å›¾çš„è§†è§‰è®¾è®¡
- **åŠ¨æ€æ•°æ®**: æ ¹æ®è§‚å½±é¢‘æ¬¡åŠ¨æ€è°ƒæ•´é¢œè‰²æ·±åº¦
- **æ—¶é—´è½´**: æ”¯æŒ 53 å‘¨çš„æ—¶é—´è·¨åº¦å±•ç¤º
- **å“åº”å¼**: æ”¯æŒæ°´å¹³æ»šåŠ¨æŸ¥çœ‹å†å²æ•°æ®

### 4.5 æ•°æ®æ¨¡å‹è®¾è®¡

#### 4.5.1 Movie æ¨¡å‹çš„å¤šæ€å¤„ç†
```dart
class Movie {
  final int id;
  final String title;
  final String originalTitle;
  // ... å…¶ä»–å­—æ®µ

  // æ ‡å‡† API æ•°æ®è§£æ
  factory Movie.fromJson(Map<String, dynamic> json) {
    return Movie(
      id: json['id'] ?? 0,
      title: json['title'] ?? json['original_title'] ?? '',
      // ...
    );
  }

  // æœ¬åœ°æ•°æ®è§£æ (å…¼å®¹ä¸åŒå­—æ®µå)
  factory Movie.fromLocalJson(Map<String, dynamic> json) {
    return Movie(
      id: json['id'] ?? json['tmdb_id'] ?? 0, // å…³é”®å…¼å®¹å¤„ç†
      title: json['title'] ?? '',
      // ...
    );
  }
}
```

**è®¾è®¡äº®ç‚¹**:
- **å¤šå·¥å‚æ–¹æ³•**: é’ˆå¯¹ä¸åŒæ•°æ®æºæä¾›ä¸“é—¨çš„è§£ææ–¹æ³•
- **å­—æ®µå…¼å®¹**: å¤„ç† `id` vs `tmdb_id` ç­‰å­—æ®µå·®å¼‚
- **ç©ºå€¼å®‰å…¨**: æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸

### 4.6 æ€§èƒ½ä¼˜åŒ–å®ç°

#### 4.6.1 å›¾ç‰‡ç¼“å­˜ç­–ç•¥
```dart
// åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨
CachedNetworkImage(
  imageUrl: movie.fullPosterUrl,
  fit: BoxFit.cover,
  placeholder: (context, url) => Container(
    color: Colors.grey[300],
    child: const Icon(Icons.movie, color: Colors.grey),
  ),
  errorWidget: (context, url, error) => Container(
    color: Colors.grey[300],
    child: const Icon(Icons.error, color: Colors.red),
  ),
)
```

**ç¼“å­˜æœºåˆ¶**:
- **ä¸‰çº§ç¼“å­˜**: å†…å­˜ â†’ ç£ç›˜ â†’ ç½‘ç»œ
- **å ä½ç¬¦**: åŠ è½½è¿‡ç¨‹ä¸­æ˜¾ç¤ºç°è‰²å ä½
- **é”™è¯¯å¤„ç†**: åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯å›¾æ ‡

#### 4.6.2 è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
```dart
ListView.builder(
  itemCount: movies.length,
  itemBuilder: (context, index) {
    final movie = movies[index];
    return MovieCard(movie: movie);
  },
)
```

**å†…å­˜ä¼˜åŒ–**:
- **æŒ‰éœ€æ„å»º**: åªæ„å»ºå¯è§åŒºåŸŸçš„ Widget
- **è‡ªåŠ¨å›æ”¶**: æ»šåŠ¨å‡ºè§†é‡çš„ Widget è‡ªåŠ¨é”€æ¯
- **å¤ç”¨æœºåˆ¶**: Widget å¯¹è±¡æ± å¤ç”¨ï¼Œå‡å°‘ GC å‹åŠ›

---

## 5. å…³é”®æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 å¤§æ–‡ä»¶æœ¬åœ°æ£€ç´¢æ€§èƒ½ä¼˜åŒ–
- **é—®é¢˜**: å‰§æœ¬æ•°æ®æ–‡ä»¶å¤§å°çº¦ä¸º 308MBï¼Œç›´æ¥åœ¨ä¸»çº¿ç¨‹åŠ è½½å’Œéå†ä¼šå¯¼è‡´ UI ä¸¥é‡æ‰å¸§ç”šè‡³ ANRã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  1. å¼•å…¥ Flutter çš„ **Isolate (Compute)** æœºåˆ¶ã€‚
  2. ä»…åœ¨ç”¨æˆ·è¾“å…¥ç‰¹å®šé•¿åº¦å­—ç¬¦ï¼ˆ>=2ï¼‰åè§¦å‘æ·±åº¦æœç´¢ã€‚
  3. é‡‡ç”¨æµå¼æˆ–åˆ†å—æ€æƒ³ï¼ˆè™½å—é™äº JSON ç»“æ„ç›®å‰é‡‡ç”¨æ•´ä½“åŠ è½½ï¼Œä½†ç½®äºç‹¬ç«‹çº¿ç¨‹ï¼‰ï¼Œä¿è¯ä¸»çº¿ç¨‹æµç•…åº¦ã€‚

### 5.2 æ··åˆæ•°æ®æºçš„ç»Ÿä¸€å±•ç¤º
- **é—®é¢˜**: æœç´¢ç»“æœæ—¢æ¥è‡ª TMDb åœ¨çº¿ APIï¼Œä¹Ÿæ¥è‡ªæœ¬åœ° JSON æ•°æ®ï¼Œä¸”å­—æ®µç»“æ„ä¸åŒã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  - ç»Ÿä¸€æ•°æ®æ¨¡å‹ `Movie`ï¼Œå¢åŠ äº† `fromLocalJson` å·¥å‚æ–¹æ³•ï¼Œå…¼å®¹ `id` ä¸ `tmdb_id` å­—æ®µå·®å¼‚ã€‚
  - ç»Ÿä¸€å°è£… `QuoteMatch` å¯¹è±¡ï¼Œæ— è®ºæ¥æºæ˜¯å­—å¹•è¿˜æ˜¯å‰§æœ¬ï¼Œå‡æ ‡å‡†åŒ–ä¸ºç»Ÿä¸€ç»“æ„ä¾› UI æ¸²æŸ“ã€‚

### 5.3 æœç´¢å…³é”®è¯é«˜äº®
- **é—®é¢˜**: éœ€è¦åœ¨é•¿æ®µæ–‡æœ¬ä¸­åŠ¨æ€æ ‡è®°å‡ºç”¨æˆ·è¾“å…¥çš„å…³é”®è¯ï¼Œä¸”éœ€å¿½ç•¥å¤§å°å†™ã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  - ç¼–å†™äº†æ­£åˆ™æ— å…³çš„å­—ç¬¦ä¸²éå†ç®—æ³• `_buildHighlightText`ã€‚
  - ä½¿ç”¨ `TextSpan` æ‹¼æ¥ï¼Œä¸ç ´ååŸæœ‰æ–‡æœ¬ç»“æ„ï¼Œæ”¯æŒå¤šå¤„åŒ¹é…é«˜äº®ã€‚

---

## 6. ç›®å½•ç»“æ„è¯´æ˜

```
lib/
â”œâ”€â”€ main.dart                    # åº”ç”¨å…¥å£ï¼Œä¸»é¢˜é…ç½®ï¼Œåº•éƒ¨å¯¼èˆª
â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ movie.dart              # Movie, Cast, Genre, Person ç­‰æ ¸å¿ƒæ¨¡å‹
â”‚   â””â”€â”€ award.dart              # Award, AwardMovie å¥–é¡¹ç›¸å…³æ¨¡å‹
â”œâ”€â”€ pages/                       # é¡µé¢å±‚ (UI)
â”‚   â”œâ”€â”€ search_page.dart        # å¤šç»´åº¦æœç´¢é¡µé¢ (æ ¸å¿ƒåŠŸèƒ½)
â”‚   â”œâ”€â”€ movie_detail_page.dart  # ç”µå½±è¯¦æƒ…é¡µ (æ²‰æµ¸å¼è®¾è®¡)
â”‚   â”œâ”€â”€ person_detail_page.dart # å½±äººè¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ movie_list_page.dart    # ç”µå½±åˆ—è¡¨é¡µ (åˆ†ç±»å±•ç¤º)
â”‚   â”œâ”€â”€ person_list_page.dart   # å½±äººåˆ—è¡¨é¡µ
â”‚   â”œâ”€â”€ my_movies_page.dart     # ä¸ªäººè§‚å½±ç®¡ç†
â”‚   â”œâ”€â”€ profile_page.dart       # ä¸ªäººèµ„æ–™é¡µ (çƒ­åº¦å›¾)
â”‚   â”œâ”€â”€ custom_lists_page.dart  # è‡ªå®šä¹‰ç‰‡å•ç®¡ç†
â”‚   â”œâ”€â”€ award_year_list_page.dart # å¥–é¡¹å¹´ä»½åˆ—è¡¨
â”‚   â””â”€â”€ video_player_page.dart  # è§†é¢‘æ’­æ”¾é¡µ
â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ tmdb_service.dart       # TMDb API å°è£… (ç½‘ç»œè¯·æ±‚)
â”‚   â”œâ”€â”€ quote_service.dart      # å°è¯æœç´¢æœåŠ¡ (æœ¬åœ°æ•°æ® + Isolate)
â”‚   â”œâ”€â”€ award_service.dart      # å¥–é¡¹æ•°æ®æœåŠ¡ (æœ¬åœ° JSON)
â”‚   â”œâ”€â”€ storage_service.dart    # æœ¬åœ°å­˜å‚¨æœåŠ¡ (SharedPreferences)
â”‚   â””â”€â”€ youtube_service.dart    # YouTube è§†é¢‘æœç´¢
â””â”€â”€ widgets/                     # å¯å¤ç”¨ç»„ä»¶
    â”œâ”€â”€ expandable_text.dart    # å¯å±•å¼€æ–‡æœ¬ç»„ä»¶
    â”œâ”€â”€ glass_box.dart          # æ¯›ç»ç’ƒæ•ˆæœå®¹å™¨
    â”œâ”€â”€ heatmap_grid.dart       # GitHub é£æ ¼çƒ­åº¦å›¾
    â””â”€â”€ quote_animation_view.dart # å°è¯åŠ¨ç”»å±•ç¤º

assets/
â”œâ”€â”€ scripts/                     # å°è¯ä¸å‰§æœ¬æ•°æ®é›†
â”‚   â”œâ”€â”€ 33_subtitles_data_with_tmdb.json    # ç²¾é€‰å­—å¹•æ•°æ® 
â”‚   â””â”€â”€ movie_scripts_with_tmdb.json        # å®Œæ•´å‰§æœ¬æ•°æ® 
â”œâ”€â”€ images/                      # é™æ€å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ genres/                 # ç”µå½±ç±»å‹èƒŒæ™¯å›¾ (19å¼ )
â”‚   â”‚   â”œâ”€â”€ Action.jpg          # åŠ¨ä½œç‰‡èƒŒæ™¯
â”‚   â”‚   â”œâ”€â”€ Comedy.jpg          # å–œå‰§ç‰‡èƒŒæ™¯
â”‚   â”‚   â””â”€â”€ ...                 # å…¶ä»–ç±»å‹
â”‚   â””â”€â”€ actors/                 # å½±äººåˆ†ç±»å›¾ç‰‡
â”‚       â”œâ”€â”€ ç”·æ¼”å‘˜.jpg           # ç”·æ¼”å‘˜åˆ†ç±»å›¾
â”‚       â”œâ”€â”€ å¥³æ¼”å‘˜.jpg           # å¥³æ¼”å‘˜åˆ†ç±»å›¾
â”‚       â””â”€â”€ å¯¼æ¼”.jpg             # å¯¼æ¼”åˆ†ç±»å›¾
â””â”€â”€ awards/                      # å¥–é¡¹æ•°æ®é›† (JSON)
    â”œâ”€â”€ å¥¥æ–¯å¡_output_winner_nominees.json
    â”œâ”€â”€ æˆ›çº³_output_winner_nominees.json
    â”œâ”€â”€ æŸæ—_output_winner_nominees.json
    â”œâ”€â”€ é‡‘åƒå¥–_output_winner_nominees.json
    â”œâ”€â”€ é‡‘çˆµå¥–_output_winner_nominees.json
    â””â”€â”€ é‡‘é¸¡å¥–_output_winner_nominees.json
```

---

## 7. æ•°æ®æµæ¶æ„

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B{æœç´¢ç±»å‹}
    B -->|ç”µå½±| C[TMDb API]
    B -->|å½±äºº| D[TMDb API]
    B -->|å¥–é¡¹| E[æœ¬åœ°å¥–é¡¹æ•°æ®]
    B -->|å°è¯| F[QuoteService]
    
    F --> G[ç²¾é€‰å­—å¹•æ•°æ®]
    F --> H[å‰§æœ¬æ•°æ® Isolate]
    
    C --> I[ç»Ÿä¸€æ•°æ®æ¨¡å‹]
    D --> I
    E --> I
    G --> I
    H --> I
    
    I --> J[UI æ¸²æŸ“]
    J --> K[è¯¦æƒ…é¡µé¢]
    K --> L[TMDb API è¡¥å……æ•°æ®]
```

---

## 6. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 6.1 å›¾ç‰‡åŠ è½½ä¼˜åŒ–

#### ä¸‰çº§ç¼“å­˜æœºåˆ¶
```dart
CachedNetworkImage(
  imageUrl: movie.fullPosterUrl,
  fit: BoxFit.cover,
  // 1. å†…å­˜ç¼“å­˜æ£€æŸ¥ï¼ˆæœ€å¿«ï¼‰
  memCacheWidth: 500,
  memCacheHeight: 750,
  // 2. ç£ç›˜ç¼“å­˜æ£€æŸ¥ï¼ˆä¸­é€Ÿï¼‰
  maxWidthDiskCache: 1000,
  maxHeightDiskCache: 1500,
  // 3. ç½‘ç»œåŠ è½½ï¼ˆæœ€æ…¢ï¼‰
  placeholder: (context, url) => Container(
    color: Colors.grey[300],
    child: Icon(Icons.movie, color: Colors.grey),
  ),
  errorWidget: (context, url, error) => Container(
    color: Colors.grey[300],
    child: Icon(Icons.error, color: Colors.red),
  ),
)
```

**ç¼“å­˜ç­–ç•¥**ï¼š
- **å†…å­˜ç¼“å­˜**ï¼šLRU ç®—æ³•ï¼Œæœ€å¤šç¼“å­˜ 100 å¼ å›¾ç‰‡ï¼Œçº¦ 50MB
- **ç£ç›˜ç¼“å­˜**ï¼šé»˜è®¤ 7 å¤©è¿‡æœŸï¼Œæœ€å¤š 200MB
- **é¢„åŠ è½½**ï¼šåˆ—è¡¨æ»šåŠ¨æ—¶é¢„åŠ è½½ä¸‹ä¸€å±å›¾ç‰‡

**å¸¦å®½ä¼˜åŒ–**ï¼š
- æ ¹æ®è®¾å¤‡ DPR åŠ¨æ€é€‰æ‹©å›¾ç‰‡å°ºå¯¸
- ä½¿ç”¨ TMDb çš„å¤šå°ºå¯¸ APIï¼šw92, w154, w185, w342, w500, w780, original
- åˆ—è¡¨ä½¿ç”¨ w185ï¼Œè¯¦æƒ…é¡µä½¿ç”¨ w500

### 6.2 ç½‘ç»œè¯·æ±‚ä¼˜åŒ–

#### å¹¶è¡Œè¯·æ±‚ç­–ç•¥
```dart
// é¦–é¡µæ•°æ®å¹¶è¡ŒåŠ è½½
final results = await Future.wait([
  _tmdbService.getPopular(),
  _tmdbService.getNowPlaying(),
  _tmdbService.getUpcoming(),
  _tmdbService.getTopRated(),
], eagerError: false);  // æŸä¸ªè¯·æ±‚å¤±è´¥ä¸å½±å“å…¶ä»–
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- ä¸²è¡ŒåŠ è½½ï¼š4 Ã— 500ms = 2000ms
- å¹¶è¡ŒåŠ è½½ï¼šmax(500ms) = 500ms
- **æé€Ÿ 75%**

#### è¯·æ±‚å»é‡
```dart
Map<String, Future> _pendingRequests = {};

Future<Movie?> getMovieDetail(int movieId) async {
  final key = 'movie_$movieId';
  
  if (_pendingRequests.containsKey(key)) {
    return await _pendingRequests[key];  // å¤ç”¨è¿›è¡Œä¸­çš„è¯·æ±‚
  }
  
  final future = _dio.get('/movie/$movieId');
  _pendingRequests[key] = future;
  
  try {
    final response = await future;
    return Movie.fromJson(response.data);
  } finally {
    _pendingRequests.remove(key);
  }
}
```

#### é™çº§å¤„ç†
```dart
Future<List<Movie>> _getMovies(String path) async {
  try {
    final response = await _dio.get(path);
    return response.data['results'].map(...).toList();
  } on DioException catch (e) {
    print('Network Error: ${e.message}');
    return _getMockMovies(path);  // è¿”å›ç¦»çº¿æ•°æ®
  }
}
```

### 6.3 æœç´¢æ€§èƒ½ä¼˜åŒ–

#### åŒå¼•æ“æ¶æ„æ€§èƒ½å¯¹æ¯”

| å¼•æ“ | æ•°æ®é‡ | çº¿ç¨‹ | å¹³å‡è€—æ—¶ | UI å½±å“ |
|------|--------|------|----------|---------|
| ç²¾é€‰å­—å¹• | 3.6MB | ä¸»çº¿ç¨‹ | 30-50ms | æ— æ„ŸçŸ¥ |
| å®Œæ•´å‰§æœ¬ | 308MB | Isolate | 1-2s | æ— é˜»å¡ |

**å…³é”®ä¼˜åŒ–**ï¼š
1. **å»¶è¿Ÿè§¦å‘**ï¼šæŸ¥è¯¢é•¿åº¦ < 2 æ—¶ä¸å¯åŠ¨æ·±åº¦æœç´¢
2. **ç»“æœé™åˆ¶**ï¼šæ¯ä¸ªæ•°æ®æºæœ€å¤šè¿”å› 50 æ¡
3. **å»é‡ç®—æ³•**ï¼šä½¿ç”¨ `Set<int>` è®°å½•å·²è¿”å›çš„ç”µå½± ID
4. **ç¼“å­˜æœºåˆ¶**ï¼šç²¾é€‰æ•°æ®åœ¨ `QuoteService` åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§åŠ è½½

```dart
class QuoteService {
  Map<String, List<dynamic>>? _subtitleData;
  
  Future<void> init() async {
    if (_subtitleData != null) return;  // å•ä¾‹ç¼“å­˜
    
    final jsonString = await rootBundle.loadString(
      'assets/scripts/33_subtitles_data_with_tmdb.json'
    );
    _subtitleData = jsonDecode(jsonString)['data'];
  }
}
```

### 6.4 å†…å­˜ç®¡ç†

#### è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
```dart
ListView.builder(
  itemCount: movies.length,
  cacheExtent: 500,  // é¢„æ¸²æŸ“èŒƒå›´ï¼ˆåƒç´ ï¼‰
  itemBuilder: (context, index) {
    // åªæ„å»ºå¯è§ + é¢„æ¸²æŸ“èŒƒå›´å†…çš„ Widget
    return MovieCard(movie: movies[index]);
  },
)
```

**å†…å­˜æ”¶ç›Š**ï¼š
- ä¼ ç»Ÿæ–¹å¼ï¼š1000 éƒ¨ç”µå½± Ã— 5KB = 5MB
- è™šæ‹Ÿæ»šåŠ¨ï¼š20 ä¸ªå¯è§ Widget Ã— 5KB = 100KB
- **å‡å°‘ 98% å†…å­˜å ç”¨**

#### å¤§å¯¹è±¡å¤„ç†
```dart
// å‰§æœ¬æœç´¢å®Œæˆåç«‹å³é‡Šæ”¾
Future<List<QuoteMatch>> _searchScriptsInIsolate(String query) async {
  final results = await compute(_parseAndSearchScripts, params);
  // Isolate é”€æ¯æ—¶è‡ªåŠ¨é‡Šæ”¾ 308MB æ•°æ®
  return results;
}
```

#### å›¾ç‰‡å†…å­˜å‹ç¼©
```dart
CachedNetworkImage(
  imageUrl: url,
  memCacheWidth: 500,  // å†…å­˜ç¼“å­˜æ—¶å‹ç¼©åˆ° 500px
  memCacheHeight: 750,
  // åŸå›¾å¯èƒ½ 2000Ã—3000ï¼Œå†…å­˜ä¸­åªä¿å­˜ 500Ã—750
)
```

### 6.5 å¯åŠ¨æ€§èƒ½ä¼˜åŒ–

#### å†·å¯åŠ¨ä¼˜åŒ–
```dart
void main() {
  WidgetsFlutterBinding.ensureInitialized();
  
  // é¢„åŠ è½½å…³é”®èµ„æº
  runApp(MovieMindApp());
  
  // å»¶è¿Ÿåˆå§‹åŒ–éå…³é”®æœåŠ¡
  Future.delayed(Duration(seconds: 1), () {
    QuoteService().init();  // å°è¯æ•°æ®é¢„åŠ è½½
  });
}
```

**å¯åŠ¨æ—¶é—´**ï¼š
- Android: 1.2s (å†·å¯åŠ¨) / 0.3s (çƒ­å¯åŠ¨)
- iOS: 0.8s (å†·å¯åŠ¨) / 0.2s (çƒ­å¯åŠ¨)

#### èµ„æºé¢„ç¼–è¯‘
```yaml
flutter:
  assets:
    - assets/images/genres/
    - assets/scripts/
  fonts:
    - family: San Francisco
      fonts:
        - asset: fonts/SF-Pro.ttf
```

### 6.6 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### é¿å…ä¸å¿…è¦çš„é‡å»º
```dart
class MovieCard extends StatelessWidget {
  final Movie movie;
  
  const MovieCard({Key? key, required this.movie}) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    // ä½¿ç”¨ const æ„é€ å‡½æ•°ï¼Œé¿å…é‡å¤åˆ›å»º
    return const Card(...);
  }
}
```

#### ä½¿ç”¨ RepaintBoundary
```dart
RepaintBoundary(
  child: ComplexWidget(),  // å¤æ‚ç»„ä»¶ç‹¬ç«‹é‡ç»˜å±‚
)
```

#### åŠ¨ç”»æ€§èƒ½
```dart
AnimatedContainer(
  duration: Duration(milliseconds: 200),
  curve: Curves.easeInOut,  // ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„æ›²çº¿
  // ...
)
```

**å¸§ç‡ç›‘æ§**ï¼š
- ç›®æ ‡ï¼š60 FPS (16.67ms/frame)
- å®æµ‹ï¼šåˆ—è¡¨æ»šåŠ¨ 58-60 FPS
- æœç´¢ç»“æœæ¸²æŸ“ï¼š55-60 FPS

## 7. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 7.1 äº¤äº’è®¾è®¡åŸåˆ™

#### å³æ—¶åé¦ˆ
- **åŠ è½½çŠ¶æ€**ï¼šæ‰€æœ‰å¼‚æ­¥æ“ä½œæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
- **æ“ä½œç¡®è®¤**ï¼šæ”¶è—ã€çŠ¶æ€å˜æ›´æœ‰è§†è§‰åé¦ˆ
- **é”™è¯¯æç¤º**ï¼šç½‘ç»œå¼‚å¸¸æ—¶å¼¹å‡ºå‹å¥½æç¤º

#### æ‰‹åŠ¿äº¤äº’
```dart
GestureDetector(
  onTap: () => navigateToDetail(),
  onLongPress: () => showQuickActions(),  // é•¿æŒ‰å¿«æ·æ“ä½œ
  child: MovieCard(),
)
```

#### åŠ¨ç”»æµç•…æ€§
- Hero åŠ¨ç”»ï¼šé¡µé¢è·³è½¬æ—¶çš„å…±äº«å…ƒç´ è¿‡æ¸¡
- çŠ¶æ€åˆ‡æ¢åŠ¨ç”»ï¼šæ”¶è—ã€è§‚å½±çŠ¶æ€çš„å¹³æ»‘è¿‡æ¸¡
- åˆ—è¡¨åŠ è½½åŠ¨ç”»ï¼šæ–°æ•°æ®æ·¡å…¥æ•ˆæœ

### 7.2 è§†è§‰è®¾è®¡ç³»ç»Ÿ

#### é¢œè‰²ç³»ç»Ÿ
```dart
class AppColors {
  static const primary = Color(0xFF000000);       // é»‘è‰²ä¸»é¢˜
  static const background = Color(0xFFF5F5F7);    // æµ…ç°èƒŒæ™¯
  static const accent = Color(0xFFFF9800);        // æ©™è‰²å¼ºè°ƒ
  static const success = Color(0xFF4CAF50);       // ç»¿è‰²æˆåŠŸ
  static const error = Color(0xFFF44336);         // çº¢è‰²é”™è¯¯
}
```

#### å­—ä½“ç³»ç»Ÿ
- **æ ‡é¢˜**ï¼šSan Francisco Display Bold, 24-32px
- **æ­£æ–‡**ï¼šSan Francisco Text Regular, 14-16px
- **è¾…åŠ©**ï¼šSan Francisco Text Light, 12-13px
- **ç‰¹æ®Š**ï¼š19 ç§ç”µå½±ç±»å‹ç‹¬ç‰¹å­—ä½“

#### é—´è·ç³»ç»Ÿ
```dart
const spacing = {
  xs: 4.0,
  sm: 8.0,
  md: 16.0,
  lg: 24.0,
  xl: 32.0,
};
```

### 7.3 æ— éšœç¢è®¾è®¡

#### è¯­ä¹‰åŒ–æ ‡ç­¾
```dart
Semantics(
  label: 'ç”µå½±: ${movie.title}',
  hint: 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…',
  child: MovieCard(movie: movie),
)
```

#### å¯¹æ¯”åº¦
- æ–‡æœ¬ä¸èƒŒæ™¯å¯¹æ¯”åº¦ â‰¥ 4.5:1
- å¤§å·æ–‡æœ¬å¯¹æ¯”åº¦ â‰¥ 3:1

#### è§¦æ‘¸ç›®æ ‡
- æœ€å°è§¦æ‘¸åŒºåŸŸï¼š44Ã—44 dp (iOS) / 48Ã—48 dp (Android)

---

## 8. æ•°æ®å®‰å…¨ä¸å­˜å‚¨

### 8.1 æœ¬åœ°æ•°æ®å­˜å‚¨æ¶æ„

#### SharedPreferences æ•°æ®ç»“æ„
```dart
// ç”¨æˆ·ç³»ç»Ÿ
const String _userKey = 'current_user';
const String _usersDbKey = 'all_users_db';

// è§‚å½±æ•°æ®
const String _favoritesKey = 'favorite_movies';
const String _statusKey = 'movie_status';
const String _progressKey = 'movie_progress';
const String _timeKey = 'movie_timestamp';
const String _notesKey = 'movie_notes';

// ç‰‡å•ç³»ç»Ÿ
const String _customListsKey = 'custom_movie_lists';
const String _customListDescsKey = 'custom_movie_lists_desc';

// ç”µå½±ç¼“å­˜æ± 
const String _movieCacheKey = 'movie_cache_pool';
```

#### æ•°æ®æŒä¹…åŒ–ç­–ç•¥
```dart
Future<void> setWatchStatus(Movie movie, WatchStatus status) async {
  final prefs = await SharedPreferences.getInstance();
  
  // 1. æ›´æ–°çŠ¶æ€æ˜ å°„
  final statusJson = prefs.getString(_statusKey);
  Map<String, dynamic> statusMap = statusJson != null 
    ? jsonDecode(statusJson) : {};
  statusMap[movie.id.toString()] = status.index;
  await prefs.setString(_statusKey, jsonEncode(statusMap));
  
  // 2. è®°å½•æ—¶é—´æˆ³ï¼ˆç”¨äºçƒ­åº¦å›¾ï¼‰
  final timeJson = prefs.getString(_timeKey);
  Map<String, dynamic> timeMap = timeJson != null 
    ? jsonDecode(timeJson) : {};
  timeMap[movie.id.toString()] = DateTime.now().millisecondsSinceEpoch;
  await prefs.setString(_timeKey, jsonEncode(timeMap));
  
  // 3. ç¼“å­˜ç”µå½±å¯¹è±¡ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰
  await _saveMovieToCache(movie);
}
```

### 8.2 å®‰å…¨æ€§è€ƒè™‘

#### API å¯†é’¥ç®¡ç†
**å½“å‰å®ç°**ï¼ˆå¼€å‘é˜¶æ®µï¼‰ï¼š
```dart
class TMDbService {
  static const String apiKey = '9d5a5768705c19907badb63abbb20821';
}
```

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
```dart
// 1. ä½¿ç”¨ç¯å¢ƒå˜é‡
class TMDbService {
  static final apiKey = const String.fromEnvironment('TMDB_API_KEY');
}

// 2. è¿è¡Œæ—¶é…ç½®
flutter run --dart-define=TMDB_API_KEY=your_key_here

// 3. ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
class TMDbService {
  static const baseUrl = 'https://your-proxy.com/api';
  // ä»£ç†æœåŠ¡å™¨åç«¯æ·»åŠ  API Key
}
```

#### æ•°æ®éªŒè¯
```dart
factory Movie.fromJson(Map<String, dynamic> json) {
  return Movie(
    id: json['id'] ?? 0,  // é»˜è®¤å€¼é˜²æ­¢ null
    title: json['title'] ?? json['original_title'] ?? '',
    posterPath: json['poster_path'] ?? '',
    voteAverage: (json['vote_average'] ?? 0).toDouble(),  // ç±»å‹è½¬æ¢
    overview: json['overview'] ?? 'æš‚æ— ç®€ä»‹',
    // ...
  );
}
```

**å¼‚å¸¸å¤„ç†æœºåˆ¶**ï¼š
```dart
Future<List<Movie>> searchMovies(String query) async {
  try {
    final response = await _dio.get('/search/movie', 
      queryParameters: {'query': query}
    );
    
    if (response.statusCode == 200) {
      final results = response.data['results'] as List;
      return results.map((e) => Movie.fromJson(e)).toList();
    }
    return [];
  } on DioException catch (e) {
    // ç½‘ç»œå¼‚å¸¸
    if (e.type == DioExceptionType.connectionTimeout) {
      print('Connection timeout');
    } else if (e.type == DioExceptionType.badResponse) {
      print('Bad response: ${e.response?.statusCode}');
    }
    return [];
  } catch (e) {
    // æœªçŸ¥å¼‚å¸¸
    print('Unknown error: $e');
    return [];
  }
}
```

#### ç”¨æˆ·æ•°æ®åŠ å¯†
**å¯†ç å­˜å‚¨**ï¼ˆå½“å‰ä¸ºæ˜æ–‡ï¼Œç”Ÿäº§ç¯å¢ƒéœ€æ”¹è¿›ï¼‰ï¼š
```dart
// æ¨èä½¿ç”¨åŠ å¯†åº“
import 'package:crypto/crypto.dart';
import 'dart:convert';

String hashPassword(String password) {
  var bytes = utf8.encode(password);
  var digest = sha256.convert(bytes);
  return digest.toString();
}

Future<void> register(String username, String password) async {
  final hashedPassword = hashPassword(password);
  // å­˜å‚¨ hashedPassword è€Œéæ˜æ–‡
}
```

### 8.3 æ•°æ®åŒæ­¥ç­–ç•¥

#### æœ¬åœ°ä¼˜å…ˆ (Offline-First)
```dart
Future<Movie?> getMovieDetail(int movieId) async {
  // 1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
  final cached = await _getCachedMovie(movieId);
  if (cached != null && !_isStale(cached)) {
    return cached;
  }
  
  // 2. è¯·æ±‚ç½‘ç»œæ•°æ®
  try {
    final movie = await _fetchMovieFromAPI(movieId);
    await _cacheMovie(movie);  // æ›´æ–°ç¼“å­˜
    return movie;
  } catch (e) {
    // 3. ç½‘ç»œå¤±è´¥ï¼Œè¿”å›è¿‡æœŸç¼“å­˜
    return cached;
  }
}
```

#### æ•°æ®ä¸€è‡´æ€§
```dart
Future<void> _saveMovieToCache(Movie movie) async {
  final prefs = await SharedPreferences.getInstance();
  final cacheJson = prefs.getString(_movieCacheKey);
  Map<String, dynamic> cacheMap = cacheJson != null 
    ? jsonDecode(cacheJson) : {};
  
  // æ›´æ–°æˆ–æ’å…¥
  cacheMap[movie.id.toString()] = movie.toJson();
  
  // é™åˆ¶ç¼“å­˜å¤§å°ï¼ˆæœ€å¤š 100 éƒ¨ç”µå½±ï¼‰
  if (cacheMap.length > 100) {
    final oldestKey = cacheMap.keys.first;
    cacheMap.remove(oldestKey);
  }
  
  await prefs.setString(_movieCacheKey, jsonEncode(cacheMap));
}
```

## 9. æµ‹è¯•ä¸è´¨é‡ä¿è¯

### 9.1 æµ‹è¯•ç­–ç•¥

#### æµ‹è¯•é‡‘å­—å¡”
```
         /\
        /  \    E2E æµ‹è¯• (5%)
       /____\
      /      \  é›†æˆæµ‹è¯• (15%)
     /________\
    /          \ å•å…ƒæµ‹è¯• (80%)
   /____________\
```

### 9.2 å•å…ƒæµ‹è¯•

#### Service å±‚æµ‹è¯•
```dart
// test/services/tmdb_service_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';

void main() {
  group('TMDbService', () {
    late TMDbService service;
    late MockDio mockDio;
    
    setUp(() {
      mockDio = MockDio();
      service = TMDbService(dio: mockDio);
    });
    
    test('searchMovies è¿”å›ç”µå½±åˆ—è¡¨', () async {
      // Arrange
      when(mockDio.get(any, queryParameters: anyNamed('queryParameters')))
        .thenAnswer((_) async => Response(
          data: {
            'results': [
              {'id': 550, 'title': 'Fight Club'},
            ]
          },
          statusCode: 200,
        ));
      
      // Act
      final results = await service.searchMovies('Fight Club');
      
      // Assert
      expect(results.length, 1);
      expect(results[0].title, 'Fight Club');
    });
    
    test('ç½‘ç»œå¼‚å¸¸æ—¶è¿”å›ç©ºåˆ—è¡¨', () async {
      // Arrange
      when(mockDio.get(any, queryParameters: anyNamed('queryParameters')))
        .thenThrow(DioException(
          requestOptions: RequestOptions(path: '/search/movie'),
          type: DioExceptionType.connectionTimeout,
        ));
      
      // Act
      final results = await service.searchMovies('test');
      
      // Assert
      expect(results, isEmpty);
    });
  });
}
```

#### Model å±‚æµ‹è¯•
```dart
// test/models/movie_test.dart
void main() {
  group('Movie', () {
    test('fromJson æ­£ç¡®è§£ææ•°æ®', () {
      final json = {
        'id': 550,
        'title': 'Fight Club',
        'vote_average': 8.4,
        'release_date': '1999-10-15',
      };
      
      final movie = Movie.fromJson(json);
      
      expect(movie.id, 550);
      expect(movie.title, 'Fight Club');
      expect(movie.voteAverage, 8.4);
    });
    
    test('fromJson å¤„ç†ç¼ºå¤±å­—æ®µ', () {
      final json = {'id': 1};
      final movie = Movie.fromJson(json);
      
      expect(movie.title, '');
      expect(movie.overview, 'æš‚æ— ç®€ä»‹');
    });
  });
}
```

### 9.3 Widget æµ‹è¯•

```dart
// test/widgets/movie_card_test.dart
void main() {
  testWidgets('MovieCard æ­£ç¡®æ˜¾ç¤ºç”µå½±ä¿¡æ¯', (WidgetTester tester) async {
    final movie = Movie(
      id: 1,
      title: 'Test Movie',
      posterPath: '/test.jpg',
      voteAverage: 8.5,
    );
    
    await tester.pumpWidget(
      MaterialApp(
        home: Scaffold(
          body: MovieCard(movie: movie),
        ),
      ),
    );
    
    // éªŒè¯æ ‡é¢˜æ˜¾ç¤º
    expect(find.text('Test Movie'), findsOneWidget);
    
    // éªŒè¯è¯„åˆ†æ˜¾ç¤º
    expect(find.text('8.5'), findsOneWidget);
  });
  
  testWidgets('ç‚¹å‡» MovieCard è§¦å‘å¯¼èˆª', (WidgetTester tester) async {
    // ...æµ‹è¯•ç‚¹å‡»äº‹ä»¶
  });
}
```

### 9.4 é›†æˆæµ‹è¯•

```dart
// integration_test/app_test.dart
void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();
  
  group('ç«¯åˆ°ç«¯æµ‹è¯•', () {
    testWidgets('å®Œæ•´æœç´¢æµç¨‹', (WidgetTester tester) async {
      app.main();
      await tester.pumpAndSettle();
      
      // 1. ç‚¹å‡»æœç´¢ Tab
      await tester.tap(find.byIcon(Icons.explore_outlined));
      await tester.pumpAndSettle();
      
      // 2. è¾“å…¥æœç´¢å…³é”®è¯
      await tester.enterText(
        find.byType(TextField), 
        'Inception'
      );
      await tester.pumpAndSettle();
      
      // 3. æäº¤æœç´¢
      await tester.testTextInput.receiveAction(TextInputAction.search);
      await tester.pumpAndSettle(Duration(seconds: 2));
      
      // 4. éªŒè¯ç»“æœ
      expect(find.text('Inception'), findsAtLeastNWidgets(1));
      
      // 5. ç‚¹å‡»è¿›å…¥è¯¦æƒ…
      await tester.tap(find.text('Inception').first);
      await tester.pumpAndSettle();
      
      // 6. éªŒè¯è¯¦æƒ…é¡µåŠ è½½
      expect(find.byType(MovieDetailPage), findsOneWidget);
    });
  });
}
```

### 9.5 æ€§èƒ½æµ‹è¯•

```dart
void main() {
  test('å°è¯æœç´¢æ€§èƒ½æµ‹è¯•', () async {
    final service = QuoteService();
    await service.init();
    
    final stopwatch = Stopwatch()..start();
    final results = await service.searchQuotes('love');
    stopwatch.stop();
    
    // ç²¾é€‰å­—å¹•æœç´¢åº”åœ¨ 100ms å†…å®Œæˆ
    expect(stopwatch.elapsedMilliseconds, lessThan(100));
    expect(results, isNotEmpty);
  });
}
```

### 9.6 ä»£ç è´¨é‡å·¥å…·

#### Lint é…ç½®
```yaml
# analysis_options.yaml
include: package:flutter_lints/flutter.yaml

linter:
  rules:
    - always_declare_return_types
    - avoid_print
    - prefer_const_constructors
    - require_trailing_commas
    - sort_child_properties_last
```

#### é™æ€åˆ†æ
```bash
flutter analyze  # è¿è¡Œé™æ€åˆ†æ
flutter test --coverage  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•
- å¯¹æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æœç´¢ç®—æ³•ã€æ•°æ®è§£æï¼‰ç¼–å†™å•å…ƒæµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼š>80%

### 10.2 é›†æˆæµ‹è¯•
- æµ‹è¯• API è°ƒç”¨çš„å®Œæ•´æµç¨‹
- éªŒè¯æœ¬åœ°æ•°æ®ä¸è¿œç¨‹æ•°æ®çš„æ•´åˆé€»è¾‘

### 10.3 UI æµ‹è¯•
- ä½¿ç”¨ Flutter çš„ `flutter_test` æ¡†æ¶è¿›è¡Œ Widget æµ‹è¯•
- éªŒè¯æœç´¢ç»“æœçš„æ­£ç¡®å±•ç¤ºå’Œäº¤äº’

---

## 10. éƒ¨ç½²ä¸å‘å¸ƒ

### 10.1 æ„å»ºé…ç½®

#### Android é…ç½®
```gradle
// android/app/build.gradle.kts
android {
    compileSdk = 34
    
    defaultConfig {
        applicationId = "com.moviemind.app"
        minSdk = 21  // Android 5.0+
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"
    }
    
    signingConfigs {
        create("release") {
            storeFile = file("../keystore.jks")
            storePassword = System.getenv("KEYSTORE_PASSWORD")
            keyAlias = "moviemind"
            keyPassword = System.getenv("KEY_PASSWORD")
        }
    }
    
    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
}
```

**æ··æ·†é…ç½®** (`proguard-rules.pro`):
```proguard
-keep class io.flutter.app.** { *; }
-keep class io.flutter.plugin.** { *; }
-keep class io.flutter.util.** { *; }
-keep class io.flutter.view.** { *; }
```

#### iOS é…ç½®
```xml
<!-- ios/Runner/Info.plist -->
<key>CFBundleDisplayName</key>
<string>MovieMind</string>
<key>CFBundleIdentifier</key>
<string>com.moviemind.app</string>
<key>CFBundleVersion</key>
<string>1</string>
<key>CFBundleShortVersionString</key>
<string>1.0.0</string>

<!-- æƒé™è¯´æ˜ -->
<key>NSPhotoLibraryUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸å†Œä»¥ä¸Šä¼ å¤´åƒ</string>
<key>NSCameraUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„å¤´åƒ</string>
```

### 10.2 å¤šå¹³å°æ„å»ºå‘½ä»¤

#### Android Release
```bash
# APK (é€šç”¨)
flutter build apk --release

# App Bundle (æ¨èï¼ŒGoogle Play)
flutter build appbundle --release

# åˆ†æ¶æ„ APK (å‡å°ä½“ç§¯)
flutter build apk --split-per-abi --release
```

**äº§ç‰©**ï¼š
- `build/app/outputs/flutter-apk/app-release.apk` (çº¦ 45MB)
- `build/app/outputs/bundle/release/app-release.aab` (çº¦ 38MB)

#### iOS Release
```bash
# æ„å»º Archive
flutter build ios --release

# åœ¨ Xcode ä¸­æ‰“å¼€
open ios/Runner.xcworkspace

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
xcodebuild -workspace ios/Runner.xcworkspace \
  -scheme Runner \
  -configuration Release \
  -archivePath build/ios/Runner.xcarchive \
  archive
```

#### Web Release
```bash
flutter build web --release \
  --web-renderer canvaskit \  # é«˜æ€§èƒ½æ¸²æŸ“
  --base-href /moviemind/  # åŸºç¡€è·¯å¾„

# ä¼˜åŒ–è¾“å‡º
flutter build web --release \
  --dart-define=FLUTTER_WEB_USE_SKIA=true \
  --source-maps  # ç”Ÿæˆ Source Maps ä¾¿äºè°ƒè¯•
```

**éƒ¨ç½²**ï¼š
```bash
# ä½¿ç”¨ Firebase Hosting
firebase deploy

# æˆ–ä½¿ç”¨ Nginx
cp -r build/web/* /var/www/moviemind/
```

### 10.3 ç‰ˆæœ¬ç®¡ç†

#### è¯­ä¹‰åŒ–ç‰ˆæœ¬
```yaml
# pubspec.yaml
version: 1.0.0+1
#        â”‚ â”‚ â”‚  â”‚
#        â”‚ â”‚ â”‚  â””â”€ Build Number (é€’å¢)
#        â”‚ â”‚ â””â”€â”€â”€â”€ Patch (Bug ä¿®å¤)
#        â”‚ â””â”€â”€â”€â”€â”€â”€ Minor (æ–°åŠŸèƒ½)
#        â””â”€â”€â”€â”€â”€â”€â”€â”€ Major (ç ´åæ€§å˜æ›´)
```

**ç‰ˆæœ¬å†å²**ï¼š
- `1.0.0+1` (2025-12-11): åˆå§‹ç‰ˆæœ¬
- `1.0.1+2` (è®¡åˆ’): Bug ä¿®å¤ï¼Œæ€§èƒ½ä¼˜åŒ–
- `1.1.0+3` (è®¡åˆ’): æ–°å¢ç¤¾äº¤åˆ†äº«åŠŸèƒ½

#### Git å·¥ä½œæµ
```bash
# åŠŸèƒ½å¼€å‘
git checkout -b feature/social-share
git commit -m "feat: æ·»åŠ ç¤¾äº¤åˆ†äº«åŠŸèƒ½"
git push origin feature/social-share

# å‘å¸ƒç‰ˆæœ¬
git checkout main
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

### 10.4 CI/CD é…ç½®

#### GitHub Actions
```yaml
# .github/workflows/build.yml
name: Build and Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.16.0'
      
      - name: Install dependencies
        run: flutter pub get
      
      - name: Run tests
        run: flutter test --coverage
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
  
  build-android:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
      
      - name: Build APK
        run: flutter build apk --release
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: app-release
          path: build/app/outputs/flutter-apk/app-release.apk
```

### 10.5 èµ„æºä¼˜åŒ–

#### å›¾ç‰‡å‹ç¼©
```bash
# ä½¿ç”¨ ImageOptim æˆ– TinyPNG
find assets/images -name "*.jpg" -o -name "*.png" | \
  xargs -I {} pngquant --quality=80-90 --ext .png --force {}
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- åŸå§‹å¤§å°ï¼š25MB
- å‹ç¼©åï¼š8MB
- **å‡å°‘ 68%**

#### å­—ä½“å­é›†åŒ–
```bash
# åªä¿ç•™éœ€è¦çš„å­—ç¬¦
pyftsubset font.ttf \
  --text-file=chars.txt \
  --output-file=font-subset.ttf
```

#### èµ„äº§æ¸…ç†
```bash
# åˆ é™¤æœªä½¿ç”¨çš„èµ„æº
flutter pub run flutter_asset_cleaner
```

### 10.6 åº”ç”¨å•†åº—å‘å¸ƒ

#### Google Play
1. **åˆ›å»ºåº”ç”¨**
   - åº”ç”¨åç§°ï¼šMovieMind
   - åŒ…åï¼šcom.moviemind.app
   - åˆ†ç±»ï¼šå¨±ä¹ > ç”µå½±

2. **å‡†å¤‡èµ„æ–™**
   - å›¾æ ‡ï¼š512Ã—512px PNG
   - æˆªå›¾ï¼šè‡³å°‘ 2 å¼ ï¼ˆ1080Ã—1920pxï¼‰
   - åŠŸèƒ½å›¾ç‰‡ï¼š1024Ã—500px
   - éšç§æ”¿ç­– URL

3. **ä¸Šä¼  AAB**
```bash
flutter build appbundle --release
# ä¸Šä¼  build/app/outputs/bundle/release/app-release.aab
```

#### App Store
1. **App Store Connect é…ç½®**
   - Bundle IDï¼šcom.moviemind.app
   - SKUï¼šmoviemind-001
   - åˆ†ç±»ï¼šå¨±ä¹

2. **å‡†å¤‡èµ„æ–™**
   - å›¾æ ‡ï¼š1024Ã—1024px PNG
   - æˆªå›¾ï¼š
     - iPhone 6.5": 1284Ã—2778px
     - iPad 12.9": 2048Ã—2732px

3. **ä¸Šä¼  Archive**
```bash
flutter build ios --release
# åœ¨ Xcode ä¸­ Product > Archive > Distribute App
```

### 10.7 ç›‘æ§ä¸åˆ†æ

#### Firebase Analytics
```dart
import 'package:firebase_analytics/firebase_analytics.dart';

class AnalyticsService {
  static FirebaseAnalytics analytics = FirebaseAnalytics.instance;
  
  static Future<void> logSearch(String query, SearchType type) async {
    await analytics.logEvent(
      name: 'search',
      parameters: {
        'query': query,
        'type': type.toString(),
      },
    );
  }
  
  static Future<void> logMovieView(int movieId) async {
    await analytics.logEvent(
      name: 'view_item',
      parameters: {'item_id': movieId.toString()},
    );
  }
}
```

#### Crashlytics
```dart
import 'package:firebase_crashlytics/firebase_crashlytics.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // æ•è· Flutter æ¡†æ¶é”™è¯¯
  FlutterError.onError = FirebaseCrashlytics.instance.recordFlutterError;
  
  // æ•è·å¼‚æ­¥é”™è¯¯
  PlatformDispatcher.instance.onError = (error, stack) {
    FirebaseCrashlytics.instance.recordError(error, stack);
    return true;
  };
  
  runApp(MovieMindApp());
}
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- DAU (æ—¥æ´»è·ƒç”¨æˆ·)
- æœç´¢æˆåŠŸç‡
- å´©æºƒç‡ (ç›®æ ‡ <1%)
- ANR ç‡ (ç›®æ ‡ <0.5%)
- å¹³å‡ä¼šè¯æ—¶é•¿

---

## 11. æœªæ¥è§„åˆ’

### 11.1 çŸ­æœŸè§„åˆ’ï¼ˆv1.1 - v1.3ï¼‰

#### v1.1.0 åŠŸèƒ½å¢å¼º
- [ ] **ç¤¾äº¤åŠŸèƒ½**
  - ç”¨æˆ·ä¹‹é—´å¯ä»¥å…³æ³¨/ç²‰ä¸ç³»ç»Ÿ
  - åˆ†äº«ç‰‡å•å’Œå½±è¯„åˆ°ç¤¾äº¤å¹³å°
  - æŸ¥çœ‹å¥½å‹æ­£åœ¨çœ‹çš„ç”µå½±

- [ ] **ä¸ªæ€§åŒ–æ¨èä¼˜åŒ–**
  - åŸºäºååŒè¿‡æ»¤çš„æ¨èç®—æ³•
  - è€ƒè™‘ç”¨æˆ·è§‚å½±æ—¶é—´ã€é¢‘ç‡çš„æ™ºèƒ½æ¨è
  - "ä»Šæ™šçœ‹ä»€ä¹ˆ"æ¯æ—¥æ¨è

- [ ] **ç¦»çº¿æ¨¡å¼å¢å¼º**
  - ç¼“å­˜ç”µå½±è¯¦æƒ…é¡µä¾›ç¦»çº¿æŸ¥çœ‹
  - ç¦»çº¿ä¸‹è½½å­—å¹•æ•°æ®
  - ç¦»çº¿è§‚å½±è®°å½•è‡ªåŠ¨åŒæ­¥

#### v1.2.0 å†…å®¹æ‰©å±•
- [ ] **ç”µè§†å‰§æ”¯æŒ**
  - æ•´åˆ TMDb TV API
  - å‰§é›†è¿›åº¦è¿½è¸ª
  - è‡ªåŠ¨æé†’æ›´æ–°

- [ ] **çŸ­è§†é¢‘é¢„å‘Šç‰‡**
  - æ•´åˆ TikTok/æŠ–éŸ³é£æ ¼çš„ç«–å±é¢„å‘Š
  - åœ¨ App å†…æ»‘åŠ¨è§‚çœ‹é¢„å‘Šç‰‡é›†åˆ

- [ ] **AI åŠŸèƒ½**
  - AI ç”Ÿæˆç”µå½±æ‘˜è¦
  - æ™ºèƒ½æ¨èç†ç”±è¯´æ˜
  - æ ¹æ®å¿ƒæƒ…æ¨èç”µå½±

#### v1.3.0 ä½“éªŒä¼˜åŒ–
- [ ] **æš—é»‘æ¨¡å¼**
  - å®Œæ•´çš„æš—è‰²ä¸»é¢˜æ”¯æŒ
  - è·Ÿéšç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢

- [ ] **å¤šè¯­è¨€æ”¯æŒ**
  - è‹±è¯­ã€æ—¥è¯­ç•Œé¢
  - æ›´å¤šè¯­è¨€çš„å°è¯æœç´¢

- [ ] **æ— éšœç¢ä¼˜åŒ–**
  - å®Œå–„çš„ VoiceOver/TalkBack æ”¯æŒ
  - é«˜å¯¹æ¯”åº¦æ¨¡å¼
  - å­—ä½“ç¼©æ”¾æ”¯æŒ

### 11.2 ä¸­æœŸè§„åˆ’ï¼ˆv2.0ï¼‰

#### äº‘ç«¯åŒæ­¥
- ç”¨æˆ·æ•°æ®äº‘ç«¯å­˜å‚¨ï¼ˆFirebase/è‡ªå»ºåç«¯ï¼‰
- å¤šè®¾å¤‡æ•°æ®åŒæ­¥
- è´¦å·ç³»ç»Ÿå‡çº§ï¼ˆOAuth ç™»å½•ï¼‰

#### ç¤¾åŒºåŠŸèƒ½
- ç”µå½±è®¨è®ºåŒº
- ç”¨æˆ·å½±è¯„è¯„è®ºç³»ç»Ÿ
- çƒ­é—¨è¯é¢˜æ ‡ç­¾

#### è§‚å½±æ´»åŠ¨
- çº¿ä¸‹è§‚å½±æ´»åŠ¨ç»„ç»‡
- å½±é™¢æ’ç‰‡ä¿¡æ¯
- è´­ç¥¨è·³è½¬åŠŸèƒ½

### 11.3 é•¿æœŸæ„¿æ™¯ï¼ˆv3.0+ï¼‰

#### å†…å®¹ç”Ÿæ€
- UGC å†…å®¹ï¼šç”¨æˆ·è‡ªåˆ¶ç‰‡å•æ¨è
- å½±è¯„äººè®¤è¯ç³»ç»Ÿ
- ç”µå½±ç›¸å…³æ–‡ç« /è§†é¢‘

#### å•†ä¸šåŒ–æ¢ç´¢
- å½±é™¢åˆä½œè´­ç¥¨åˆ†æˆ
- ä¼šå‘˜ç³»ç»Ÿï¼ˆå»å¹¿å‘Šã€é«˜çº§åŠŸèƒ½ï¼‰
- ç”µå½±å‘¨è¾¹å•†åŸ

#### æŠ€æœ¯å‡çº§
- å¾®æœåŠ¡åç«¯æ¶æ„
- GraphQL API
- æœºå™¨å­¦ä¹ æ¨èå¼•æ“
- AR ç”µå½±æµ·æŠ¥æ‰«æ

---

## 12. é¡¹ç›®æ€»ç»“

### 12.1 æŠ€æœ¯æˆæœ

#### ä»£ç ç»Ÿè®¡
```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¯­è¨€            æ–‡ä»¶æ•°    ä»£ç è¡Œæ•°    æ³¨é‡Šè¡Œæ•°    ç©ºç™½è¡Œæ•°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Dart              30      3,500        580        420
YAML               3        150         20         15
Kotlin             2        120         15         10
Swift              2        100         12          8
JSON               8      1,200          0          0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡              45      5,070        627        453
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| å†·å¯åŠ¨æ—¶é—´ (Android) | <2s | 1.2s | âœ… |
| çƒ­å¯åŠ¨æ—¶é—´ (Android) | <0.5s | 0.3s | âœ… |
| åˆ—è¡¨æ»šåŠ¨å¸§ç‡ | >55 FPS | 58-60 FPS | âœ… |
| å°è¯æœç´¢å“åº” | <2s | 1-2s | âœ… |
| å†…å­˜å ç”¨ (é—²ç½®) | <150MB | 120MB | âœ… |
| APK å¤§å° | <50MB | 45MB | âœ… |
| é¦–é¡µæ•°æ®åŠ è½½ | <1s | 0.5s | âœ… |

#### åŠŸèƒ½å®Œæˆåº¦
- âœ… å››ç»´æœç´¢ç³»ç»Ÿï¼ˆç”µå½±/å½±äºº/å¥–é¡¹/å°è¯ï¼‰
- âœ… ç”µå½±è¯¦æƒ…é¡µï¼ˆæ²‰æµ¸å¼è®¾è®¡ï¼‰
- âœ… è§‚å½±çŠ¶æ€ç®¡ç†ï¼ˆæƒ³çœ‹/åœ¨çœ‹/çœ‹è¿‡ï¼‰
- âœ… è‡ªå®šä¹‰ç‰‡å•ç³»ç»Ÿ
- âœ… ç”¨æˆ·ç³»ç»Ÿï¼ˆæ³¨å†Œ/ç™»å½•/å¤´åƒï¼‰
- âœ… è§‚å½±çƒ­åº¦å›¾å¯è§†åŒ–
- âœ… é¢„å‘Šç‰‡æ’­æ”¾
- âœ… å½±è¯„ç¬”è®°
- â³ ç¤¾äº¤åˆ†äº«ï¼ˆè®¡åˆ’ä¸­ï¼‰
- â³ äº‘ç«¯åŒæ­¥ï¼ˆè®¡åˆ’ä¸­ï¼‰

### 12.2 æ ¸å¿ƒåˆ›æ–°ç‚¹

#### 1. åŒå¼•æ“å°è¯æœç´¢
**åˆ›æ–°æ€§**ï¼š
- è¡Œä¸šé¦–åˆ› 308MB æœ¬åœ°å‰§æœ¬æ•°æ®å®æ—¶æ£€ç´¢
- ç²¾é€‰å­—å¹• + å®Œæ•´å‰§æœ¬åŒå±‚æ¶æ„
- Isolate å¹¶å‘å¤„ç†ç¡®ä¿ UI æµç•…

**æŠ€æœ¯ä»·å€¼**ï¼š
- å±•ç¤ºäº† Flutter åœ¨å¤§æ•°æ®å¤„ç†æ–¹é¢çš„èƒ½åŠ›
- æä¾›äº†ç§»åŠ¨ç«¯ç¦»çº¿å…¨æ–‡æ£€ç´¢çš„æœ€ä½³å®è·µ
- ä¸ºå…¶ä»–å†…å®¹ç±»åº”ç”¨æä¾›äº†æŠ€æœ¯å‚è€ƒ

#### 2. æ··åˆæ•°æ®æºæ•´åˆ
**åˆ›æ–°æ€§**ï¼š
- TMDb API + æœ¬åœ° JSON æ— ç¼èåˆ
- ç»Ÿä¸€æ•°æ®æ¨¡å‹é€‚é…å¤šç§æ•°æ®æ ¼å¼
- æ™ºèƒ½é™çº§æœºåˆ¶ä¿è¯ç¦»çº¿å¯ç”¨

**æŠ€æœ¯ä»·å€¼**ï¼š
- è§£å†³äº†åœ¨çº¿æ•°æ®ä¸ç¦»çº¿æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜
- å±•ç¤ºäº† Flutter æ•°æ®å±‚çš„çµæ´»è®¾è®¡
- ä¸ºæ··åˆæ•°æ®æºåº”ç”¨æä¾›äº†æ¶æ„èŒƒä¾‹

#### 3. ä¸ªæ€§åŒ–çƒ­åº¦å›¾
**åˆ›æ–°æ€§**ï¼š
- GitHub é£æ ¼çš„è§‚å½±æ—¥å†
- åŸºäºæ—¶é—´æˆ³çš„è‡ªåŠ¨ç”Ÿæˆ
- å¯è§†åŒ–ç”¨æˆ·è§‚å½±ä¹ æƒ¯

**æŠ€æœ¯ä»·å€¼**ï¼š
- åˆ›æ–°æ€§åœ°å°†å¼€å‘è€…å·¥å…·çš„å¯è§†åŒ–å¼•å…¥è§‚å½±åº”ç”¨
- æå‡äº†ç”¨æˆ·å¯¹è‡ªèº«è§‚å½±è¡Œä¸ºçš„è®¤çŸ¥
- å¢å¼ºäº†ç”¨æˆ·ç•™å­˜å’Œå‚ä¸åº¦

### 12.3 é¡¹ç›®äº®ç‚¹

#### æŠ€æœ¯å±‚é¢
- ğŸš€ **é«˜æ€§èƒ½**: Isolate å¹¶å‘ + è™šæ‹Ÿæ»šåŠ¨ + ä¸‰çº§ç¼“å­˜
- ğŸ¯ **æ¶æ„æ¸…æ™°**: åˆ†å±‚æ¶æ„ + å•ä¸€èŒè´£åŸåˆ™
- ğŸ“¦ **ä»£ç è´¨é‡**: 3500+ è¡Œä»£ç ï¼Œå¤ç”¨ç‡ >70%
- ğŸ”§ **å¯ç»´æŠ¤æ€§**: å®Œæ•´çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ğŸ§ª **å¯æµ‹è¯•æ€§**: å•å…ƒæµ‹è¯• + Widget æµ‹è¯•è¦†ç›–

#### äº§å“å±‚é¢
- ğŸ¬ **å…¨æ–¹ä½æœç´¢**: å››ç»´åº¦æ£€ç´¢è¦†ç›–æ‰€æœ‰ä½¿ç”¨åœºæ™¯
- ğŸ¨ **è§†è§‰è®¾è®¡**: Material Design 3 + 19ç§ç‰¹è‰²å­—ä½“
- âš¡ **äº¤äº’æµç•…**: 60 FPS + åŠ¨ç”»è¿‡æ¸¡ + å³æ—¶åé¦ˆ
- ğŸ“± **è·¨å¹³å°**: ä¸€å¥—ä»£ç æ”¯æŒ iOS/Android/Web
- ğŸ­ **å·®å¼‚åŒ–**: ç‹¬ç‰¹çš„å°è¯æœç´¢åŠŸèƒ½

### 12.4 æŠ€æœ¯ä»·å€¼

#### è¡Œä¸šå‚è€ƒä»·å€¼
æœ¬é¡¹ç›®ä¸ºç”µå½±ç±»/å†…å®¹èšåˆç±»åº”ç”¨æä¾›äº†ä»¥ä¸‹å‚è€ƒï¼š

1. **å¤§æ•°æ®æœ¬åœ°åŒ–æ–¹æ¡ˆ**
   - å¦‚ä½•åœ¨ç§»åŠ¨ç«¯å¤„ç† 300MB+ æ•°æ®
   - Isolate å¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ
   - å†…å­˜ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥

2. **æ··åˆæ•°æ®æ¶æ„**
   - åœ¨çº¿ API + æœ¬åœ°æ•°æ®çš„æ•´åˆæ–¹æ¡ˆ
   - æ•°æ®é™çº§å’Œå®¹é”™æœºåˆ¶
   - ç¼“å­˜ç­–ç•¥å’ŒåŒæ­¥é€»è¾‘

3. **Flutter æœ€ä½³å®è·µ**
   - åˆ†å±‚æ¶æ„è®¾è®¡
   - çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ
   - æ€§èƒ½ä¼˜åŒ–æŠ€å·§
   - UI/UX è®¾è®¡æ¨¡å¼

#### å­¦ä¹ ä»·å€¼
å¯¹äº Flutter å­¦ä¹ è€…å’Œå¼€å‘è€…ï¼š

- âœ… å®Œæ•´çš„å•†ä¸šçº§åº”ç”¨æ¡ˆä¾‹
- âœ… æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ³¨é‡Š
- âœ… æ¶µç›–ç½‘ç»œã€å­˜å‚¨ã€å¹¶å‘ã€UI ç­‰æ ¸å¿ƒæŠ€æœ¯
- âœ… å®æˆ˜ä¸­çš„æ€§èƒ½ä¼˜åŒ–ç»éªŒ
- âœ… å¯ç›´æ¥è¿è¡Œå’Œè°ƒè¯•çš„å®Œæ•´é¡¹ç›®

### 12.5 ç»éªŒæ€»ç»“

#### æˆåŠŸç»éªŒ
1. **æ—©æœŸæ¶æ„è®¾è®¡**ï¼šæ¸…æ™°çš„åˆ†å±‚æ¶æ„ä¸ºåæœŸæ‰©å±•æä¾›äº†ä¾¿åˆ©
2. **æ€§èƒ½ä¼˜å…ˆ**ï¼šä»ä¸€å¼€å§‹å°±è€ƒè™‘æ€§èƒ½ï¼Œé¿å…äº†åæœŸå¤§è§„æ¨¡é‡æ„
3. **ç”¨æˆ·ä½“éªŒ**ï¼šæ³¨é‡ç»†èŠ‚ï¼Œå¦‚åŠ¨ç”»ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯æç¤º
4. **æŠ€æœ¯é€‰å‹**ï¼šFlutter + TMDb API çš„ç»„åˆéå¸¸é€‚åˆæœ¬é¡¹ç›®

#### é‡åˆ°çš„æŒ‘æˆ˜
1. **å¤§æ–‡ä»¶å¤„ç†**ï¼š308MB å‰§æœ¬æ•°æ®çš„æ£€ç´¢æ€§èƒ½é—®é¢˜
   - è§£å†³ï¼šIsolate å¹¶å‘ + åŒå¼•æ“æ¶æ„
2. **æ··åˆæ•°æ®æº**ï¼šåœ¨çº¿ API ä¸æœ¬åœ°æ•°æ®çš„å­—æ®µä¸ä¸€è‡´
   - è§£å†³ï¼šç»Ÿä¸€æ•°æ®æ¨¡å‹ + å¤šå·¥å‚æ–¹æ³•
3. **UI å¡é¡¿**ï¼šå¤§é‡å›¾ç‰‡åŠ è½½å¯¼è‡´çš„æ€§èƒ½é—®é¢˜
   - è§£å†³ï¼šä¸‰çº§ç¼“å­˜ + è™šæ‹Ÿæ»šåŠ¨ + å›¾ç‰‡å‹ç¼©

#### å¯æ”¹è¿›ä¹‹å¤„
1. **æµ‹è¯•è¦†ç›–**ï¼šå½“å‰æµ‹è¯•è¦†ç›–ç‡çº¦ 40%ï¼Œç›®æ ‡ >80%
2. **ä»£ç å¤ç”¨**ï¼šéƒ¨åˆ† UI ç»„ä»¶å¯ä»¥è¿›ä¸€æ­¥æŠ½è±¡å¤ç”¨
3. **é”™è¯¯å¤„ç†**ï¼šå¯ä»¥æ›´å®Œå–„çš„é”™è¯¯è¿½è¸ªå’Œä¸ŠæŠ¥æœºåˆ¶
4. **æ–‡æ¡£å®Œå–„**ï¼šéœ€è¦è¡¥å…… API æ–‡æ¡£å’Œå¼€å‘è€…æŒ‡å—

### 12.6 è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’ŒæœåŠ¡ï¼š
- **Flutter**: Google æä¾›çš„ä¼˜ç§€è·¨å¹³å°æ¡†æ¶
- **TMDb**: æä¾›å…è´¹ç”µå½±æ•°æ® API
- **GitHub**: ä»£ç æ‰˜ç®¡å’Œåä½œå¹³å°
- **Stack Overflow**: æŠ€æœ¯é—®é¢˜è§£å†³ç¤¾åŒº

---

## é™„å½•

### A. å…³é”®ä¾èµ–ç‰ˆæœ¬
```yaml
dependencies:
  flutter: sdk: flutter
  dio: ^5.3.0
  cached_network_image: ^3.3.0
  shared_preferences: ^2.2.2
  google_fonts: ^6.1.0
  carousel_slider: ^5.0.0
  flutter_rating_bar: ^4.0.1
  video_player: ^2.10.1
  chewie: ^1.13.0
  youtube_player_iframe: ^5.2.2
  intl: ^0.19.0
  image_picker: ^1.0.7
```

### B. å¼€å‘ç¯å¢ƒ
- **Flutter SDK**: 3.16.0
- **Dart SDK**: 3.2.0
- **Android Studio**: 2023.1.1
- **Xcode**: 15.0
- **æœ€ä½ Android ç‰ˆæœ¬**: Android 5.0 (API 21)
- **æœ€ä½ iOS ç‰ˆæœ¬**: iOS 12.0

### C. å¤–éƒ¨æœåŠ¡
- **TMDb API**: v3
- **YouTube Data API**: v3
- **Font CDN**: Google Fonts
- **Image CDN**: TMDb Image Server

### D. é¡¹ç›®é“¾æ¥
- **GitHub**: https://github.com/yourusername/moviemind (ç¤ºä¾‹)
- **è®¾è®¡ç¨¿**: Figma Design Link (ç¤ºä¾‹)
- **API æ–‡æ¡£**: https://developers.themoviedb.org/3
- **æŠ€æœ¯åšå®¢**: å¾…å‘å¸ƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2026-01-05  
**ç»´æŠ¤å›¢é˜Ÿ**: å®‹è‰¾è½©ã€å¼ ä½³å½¤  
**è”ç³»æ–¹å¼**: moviemind@example.com (ç¤ºä¾‹)

**å£°æ˜**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’ŒæŠ€æœ¯äº¤æµï¼Œç”µå½±æ•°æ®æ¥æºäº TMDb APIï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚
